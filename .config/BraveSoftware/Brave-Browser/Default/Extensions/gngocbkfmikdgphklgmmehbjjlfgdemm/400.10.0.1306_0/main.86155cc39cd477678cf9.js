(self.webpackChunkext_core=self.webpackChunkext_core||[]).push([["main"],{8255:t=>{function e(t){return Promise.resolve().then(()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}e.keys=()=>[],e.resolve=e,e.id=8255,t.exports=e},36:(t,e,n)=>{"use strict";var i=n(9075),o=n(476),r=n(3092),s=n(1841),a=n(9495),c=n(1164);let l=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-root"]],decls:2,vars:0,consts:[[1,"body"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o._UZ(1,"router-outlet"),o.qZA())},directives:[c.lC],styles:[""]}),t})();var d=n(8583),h=n(4762),u=n(6889),g=n(2739);let p=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[]]}),t})();var m=(()=>(function(t){t[t.DataInsightsResults=0]="DataInsightsResults",t[t.Activate=1]="Activate",t[t.CallBrandServiceFunction=2]="CallBrandServiceFunction",t[t.CloseSettings=3]="CloseSettings",t[t.ConstructActivateString=4]="ConstructActivateString",t[t.ConstructRewardString=5]="ConstructRewardString",t[t.DismissActivation=6]="DismissActivation",t[t.ExecuteCallback=7]="ExecuteCallback",t[t.ExecuteReflect=8]="ExecuteReflect",t[t.ExecuteReflectCmd=9]="ExecuteReflectCmd",t[t.GetAllReflects=10]="GetAllReflects",t[t.GetCdnHost=11]="GetCdnHost",t[t.GetCurrencySymbol=12]="GetCurrencySymbol",t[t.GetFeaturedMerchants=13]="GetFeaturedMerchants",t[t.GetFeaturedOfferPlacement=14]="GetFeaturedOfferPlacement",t[t.GetFilePath=15]="GetFilePath",t[t.GetLocalizedString=16]="GetLocalizedString",t[t.GetPopupData=17]="GetPopupData",t[t.GetSerpMerchantMetasByUrls=18]="GetSerpMerchantMetasByUrls",t[t.GetStorageItem=19]="GetStorageItem",t[t.InjectContent=20]="InjectContent",t[t.Log=21]="Log",t[t.LogCouponResults=22]="LogCouponResults",t[t.LogImpression=23]="LogImpression",t[t.Login=24]="Login",t[t.NavigateToFeaturedMerchant=25]="NavigateToFeaturedMerchant",t[t.NotificationClicked=26]="NotificationClicked",t[t.NotificationRemoveClicked=27]="NotificationRemoveClicked",t[t.OpenGoTab=28]="OpenGoTab",t[t.OpenSettings=29]="OpenSettings",t[t.OpenSiteTab=30]="OpenSiteTab",t[t.RefreshAccountBalance=31]="RefreshAccountBalance",t[t.Register=32]="Register",t[t.ResetCouponCoolDown=33]="ResetCouponCoolDown",t[t.SendDataFromHostToExt=34]="SendDataFromHostToExt",t[t.SendPasswordReminder=35]="SendPasswordReminder",t[t.SetActivationConfirmed=36]="SetActivationConfirmed",t[t.SetActivationInjected=37]="SetActivationInjected",t[t.SetStorageItem=38]="SetStorageItem",t[t.SetTabShopperMarketingInjected=39]="SetTabShopperMarketingInjected",t[t.ShowTutorial=40]="ShowTutorial",t[t.UpdateMemberPrefs=41]="UpdateMemberPrefs",t[t.UserClickedInPage=42]="UserClickedInPage"}(m||(m={})),m))(),f=(()=>(function(t){t[t.Off=0]="Off",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug",t[t.Trace=5]="Trace",t[t.All=6]="All"}(f||(f={})),f))(),v=(()=>(function(t){t[t.Unsupported=0]="Unsupported",t[t.PopupOnly=1]="PopupOnly",t[t.Standard=2]="Standard",t[t.Discover=3]="Discover",t[t.AutoRedirect=7]="AutoRedirect"}(v||(v={})),v))(),b=(()=>(function(t){t[t.OK=0]="OK",t[t.INVALID_HASH=1001]="INVALID_HASH",t[t.REQUIRES_LOGIN=1002]="REQUIRES_LOGIN",t[t.REQUIRES_POST=1003]="REQUIRES_POST",t[t.MEMBER_MISMATCH=1004]="MEMBER_MISMATCH",t[t.FAILED_TO_GENERATE_ID=2001]="FAILED_TO_GENERATE_ID",t[t.FAILED_TO_RECORD_UPDATE=2002]="FAILED_TO_RECORD_UPDATE",t[t.LOGIN_FAILURE=3001]="LOGIN_FAILURE",t[t.REGISTRATION_FAILURE=3002]="REGISTRATION_FAILURE",t[t.REGISTRATION_BLOCKED_IP=3003]="REGISTRATION_BLOCKED_IP",t[t.REGISTRATION_INVALID_MODEL=3004]="REGISTRATION_INVALID_MODEL",t[t.DATABASE_ERROR=4001]="DATABASE_ERROR"}(b||(b={})),b))(),_=(()=>(function(t){t.chrome="chrome",t.firefox="firefox",t.edge="edge"}(_||(_={})),_))(),C=(()=>(function(t){t.Merchant="MERCHANT",t.Checkout="CHECKOUT",t.PostPurchase="POSTPURCHASE",t.Serp="SERP"}(C||(C={})),C))(),y=(()=>(function(t){t[t.sb=22]="sb",t[t.mp=257]="mp",t[t.tada=258]="tada",t[t.ibd=260]="ibd",t[t.upm=263]="upm"}(y||(y={})),y))(),x=(()=>(function(t){t.sb="SwagButton",t.mp="MyPoints Score!",t.tada="Tada Extension",t.ibd="Billy Button",t.upm="Upromise Extension"}(x||(x={})),x))(),M=(()=>(function(t){t[t.SHOP=1]="SHOP",t[t.ANSWER=2]="ANSWER",t[t.ANSWER_LOGGING=4]="ANSWER_LOGGING",t[t.DATA_INSIGHTS=8]="DATA_INSIGHTS",t[t.SHOP_APPLY_COUPONS=16]="SHOP_APPLY_COUPONS",t[t.SHOP_SERP_INJECT=32]="SHOP_SERP_INJECT",t[t.ANSWER_DASHBOARD=64]="ANSWER_DASHBOARD",t[t.MKT_PROMO_CODES=128]="MKT_PROMO_CODES",t[t.MKT_REFERRALS=256]="MKT_REFERRALS",t[t.UX_POPUP_SEARCH=512]="UX_POPUP_SEARCH",t[t.REQUIRE_REG_PWD=1024]="REQUIRE_REG_PWD"}(M||(M={})),M))();class S{constructor(){this.surveys=[],this.preferences=0,this.isTester=!1}}class O{}class P{constructor(t,e){this.type=t,this.value=e}}class w{constructor(t){this.key=t}get(){let t=localStorage.getItem(this.key);var e="undefined"===t?null:JSON.parse(t);return Promise.resolve(e)}set(t){return localStorage.setItem(this.key,JSON.stringify(t)),Promise.resolve()}remove(){return localStorage.removeItem(this.key),Promise.resolve()}}class A{get expired(){return!this.expiration||Date.now()>=this.expiration}deserialize(t){for(var e in t)this[e]=t[e];return this}}class I{static getSeconds(){return Math.floor(Date.now()/1e3)}static getMillisPlus(t,e){let n;switch(t){case"hours":n=36e5;break;case"minutes":n=6e4;break;case"seconds":n=1e3}return Date.now()+e*n}static getStartOfDayMillis(t){return(t=t||new Date).setHours(0,0,0,0)}}class k{constructor(t,e){this.key=null,this.expirationHours=e,this.internalStorageProvider=t}get(){return(0,h.mG)(this,void 0,void 0,function*(){var t=yield this.internalStorageProvider.get();return(new A).deserialize(t)})}set(t){throw"Not implemented. Use setValue instead."}setValue(t){return(0,h.mG)(this,void 0,void 0,function*(){var e=yield this.get();e.value=t,e.expiration=I.getMillisPlus("hours",this.expirationHours),yield this.internalStorageProvider.set(e)})}remove(){return(0,h.mG)(this,void 0,void 0,function*(){yield this.internalStorageProvider.remove()})}}class T{constructor(t){this.key=t.key,this.internalStorageProvider=t}get(){return(0,h.mG)(this,void 0,void 0,function*(){var t=yield this.internalStorageProvider.get();return t?new Map(t):null})}set(t){return(0,h.mG)(this,void 0,void 0,function*(){if(t){var e=Array.from(t);yield this.internalStorageProvider.set(e)}})}remove(){return(0,h.mG)(this,void 0,void 0,function*(){yield this.internalStorageProvider.remove()})}}class E{constructor(t,e){this.overridden=!1,this.key=t.key,this.internalStorageProvider=t,e&&e.subscribe(t=>this.onStorageChanged(t))}onStorageChanged(t){return(0,h.mG)(this,void 0,void 0,function*(){var e=t[this.key];e&&!this.overridden&&void 0!==e.oldValue&&(console.log(`Attempt made to change sticky storage item [${this.key}] from [${e.oldValue}] to [${e.newValue}]. Resetting.`),yield this.set(e.oldValue,!0),this.overridden&&(this.overridden=!1))})}get(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.internalStorageProvider.get()})}set(t,e=!1){return(0,h.mG)(this,void 0,void 0,function*(){var n=yield this.get();if(null!==n&&!e)throw`Attempt made to change sticky storage item [${this.key}] from [${n}] to [${t}]`;e&&(this.overridden=!0),yield this.internalStorageProvider.set(t),this.overridden=!1})}remove(t=!1){return(0,h.mG)(this,void 0,void 0,function*(){if(!t)throw`Attempt made to remove sticky storage item [${this.key}]`;this.overridden=!0,yield this.internalStorageProvider.remove()})}}class R{constructor(t,e){this.key=t,this.browserApi=e}get(){return new Promise(t=>{this.browserApi.storage.local.get(this.key,e=>{t(e[this.key]||null)})})}set(t){return new Promise(e=>{var n={};n[this.key]=t,this.browserApi.storage.local.set(n,()=>{e()})})}remove(){return new Promise(t=>{this.browserApi.storage.local.remove(this.key,()=>{t()})})}}class L{constructor(t,e=!0){this.command=t,this.requiresHash=e}}class G{constructor(t,e){this.isAffiliateRedirect=t,this.isOwnRedirect=e}}class N{}class D{}class F extends class{}{constructor(t,e){super(),this.coupons=[],Object.assign(this,JSON.parse(t)),this.id=e.id,this.loc=e.loc,this.type=e.type,this.reward=e.reward||new D,this.coupons=this.coupons||[],this.isZeroPayout=!this.reward.amount||0===this.reward.amount}}class U{constructor(t,e){this.RequestsFromServerAndClient={client:{},server:{}},this.stack=[],this.userClicked=!1,this.requestId=t,this.initiator=e}}var Z=(()=>(function(t){t[t.NotActive=0]="NotActive",t[t.Activating=1]="Activating",t[t.Activated=2]="Activated",t[t.StandingDown=3]="StandingDown"}(Z||(Z={})),Z))();class q{constructor(){this.activationDismissed=!1,this.activationInjected=!1,this.activationConfirmed=!1,this.shopperMarketingInjected=!1}}class H{constructor(t,e){this.redirectStack=null,this.redirectDetails=null,this.merchantState=null,this.previousMerchantState=null,this.tabId=e,this.windowId=t}}class z{}var j=(()=>(function(t){t[t.surveyAlertOptOut=1]="surveyAlertOptOut",t[t.accountAlertOptIn=2]="accountAlertOptIn",t[t.dataCollectionOptOut=4]="dataCollectionOptOut"}(j||(j={})),j))();class J{constructor(t,e,n){this.name=t,this.alarmInfo=e,this.subscription=n}}class ${static getCashBack(t,e){t/=100;let n=Number.isInteger(t)?t:t.toFixed(2);return e?`${n}%`:`${n}`}static formatCurrencyAmount(t,e){let n;return n="\u20ac"===e?`${t} ${e}`:`${e}${t}`,n}static copyTextToClipboard(t){if(navigator.clipboard)navigator.clipboard.writeText(t);else{const e=document.createElement("textarea");e.value=t,e.style.opacity="0",e.style.position="fixed",e.style.width="0",e.style.height="0",e.style.margin="0",e.style.padding="0",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}}}class B{}B.ONE_HOUR_MS=36e5,B.HTTP_RETRIES=2,B.ACTIVATION_STATE=7,B.TOKEN_COOKIE="__urqm",B.TUTORIAL_KEY="tutorial-viewed",B.DEFAULT_REDIRECT_ENDPOINT="/g/shopredir",B.DISCOVER_CLICK_COMMAND="oh-offer-click",B.FLAGS_STORAGE_KEY="flags",B.LEGACY_ID_NAMES={SBMP:"SSE_TBUID",TADA:"guid"},B.EMAIL_REGEX=new RegExp('^(([^<>()\\[\\]\\\\.,;:\\s@"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@"]+)*)|(".+"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$');class Y{}Y.SEARCH_PAGE_INJECTION_SETTINGS=[{id:"0",domain:"swagbucks.com",rx:new RegExp("swagbucks[.]com/[?](q=|.=.*&q=)"),pattern:"#main div.algo h3 a",matchURL:"ru=",matchTOP:"true"},{id:"1",domain:"mypoints.com",rx:new RegExp("mypoints[.]com/search-and-earn[?](q=|.=.*&q=)"),pattern:"#main div.algo h3 a",matchURL:"ru=",matchTOP:"true"},{id:"2",domain:"search.yahoo.com",rx:new RegExp("/search.*(fr=|hspart=prodege|hspart=mozilla).*"),pattern:"#main div.algo h3 a",matchURL:"RU="},{id:"3",domain:"search.yahoo.com",rx:new RegExp("search.yahoo.com/search;"),pattern:"#main div.algo h3 a",matchURL:"RU="},{id:"4",domain:"www.bing.com",rx:new RegExp("/?search"),pattern:'#b_results li.b_algo, #b_results li, #b_results h2 a, div[class="sb_tlst"] a',manuallyPushUpLevels:1},{id:"5",domain:"google.com",rx:new RegExp("^https?://(?:www.|encrypted.)?google.com/.*(?:(?:[&?#]q=)|(?:(?:search|webhp|sclient|hl|output|newwindow|[?]gws_rd=ssl).*[&?#]q=))"),pattern:"#res #search .g > div > div > div > a",manuallyPushUpLevels:4}];class W{constructor(t,e){this.value=e,this.configuration=t}}var Q=(()=>(function(t){t[t.Flags=0]="Flags",t[t.MerchantHash=1]="MerchantHash",t[t.AffiliateHash=2]="AffiliateHash",t[t.FeaturedMerchants=3]="FeaturedMerchants",t[t.SiteMapHash=4]="SiteMapHash"}(Q||(Q={})),Q))();class V{constructor(){this.merchantActivationHistory=[]}}class K{constructor(t,e,n,i){this.sessionStart=Date.now(),this.logData=new V,this.logData.merchantID=n.id,this.logData.merchantActivationType=n.type,this.logData.merchantActivationHistory=[],this.logData.parentSessionID=i||"",this.logData.merchantSessionID=this.generateSessionId(t,e,n.id)}generateSessionId(t,e,n){return`${t}~${e}~${n}~${Date.now()}`}finalize(){this.logData.sessionDuration=Date.now()-this.sessionStart}tryAddActivationState(t){let e=this.logData.merchantActivationHistory;(0===e.length||e.length&&e[e.length-1]!==t)&&e.push(t)}}var X=(()=>(function(t){t[t.Default=274]="Default",t[t.AutoRedirect=280]="AutoRedirect",t[t.ActivationSliderClick=281]="ActivationSliderClick",t[t.CouponSliderClick=282]="CouponSliderClick",t[t.PopupMerchantClick=283]="PopupMerchantClick",t[t.PopupFeaturedMerchantClick=284]="PopupFeaturedMerchantClick"}(X||(X={})),X))();class tt{constructor(t,e){this.memberID=t,this.timestamp=e}}var et=(()=>(function(t){t.BadHashDetected="BAD_HASH_DETECTED",t.FalsyIdOrHashOnUpdate="FALSY_ID_OR_HASH_ON_UPDATE",t.FalsyIdOrHashOnStartup="FALSY_ID_OR_HASH_ON_STARTUP",t.FalsyIdOrHashBeforeCallback="FALSY_ID_OR_HASH_BEFORE_CALLBACK"}(et||(et={})),et))();class nt{constructor(t){this.merchant=null,this.expiry=null,this.injectionState=new q,this.couponCoolDownExpiry=null,this.merchant=t,this.expiry=I.getMillisPlus("minutes",15)}}class it extends O{constructor(t,e,n,i,o,r,s,a,c,l=!1,d="assets/icons/128.png"){super(),this.id=t,this.ts=n,this.url=a,this.type=e,this.text=s,this.data=o,this.icon=d,this.title=r,this.expires=i,this.linkText=c,this.shouldNotifyVisibly=l}}var ot=(()=>(function(t){t[t.Survey=0]="Survey",t[t.PromoCode=1]="PromoCode"}(ot||(ot={})),ot))();class rt extends F{constructor(t,e,n){super(t,e),this.placement=n}}class st{constructor(t,e=null){this.message=t,this.originalError=e}}var at=(()=>(function(t){t[t.Default=0]="Default",t[t.Background=1]="Background",t[t.CurrentTab=2]="CurrentTab",t[t.SilentTab=3]="SilentTab"}(at||(at={})),at))();class ct{constructor(t){this.identifier=t}check(t){return t.id!==this.identifier}}class lt{constructor(t){this.peerInfo=JSON.stringify(t)}}var dt=(()=>(function(t){t[t.Activation=0]="Activation",t[t.Coupons=1]="Coupons",t[t.SHM=2]="SHM"}(dt||(dt={})),dt))();class ht{constructor(t,e,n){this.name=e,this.callback=n,this.domainIncludes=t}}var ut=(()=>(function(t){t[t.sb=42]="sb",t[t.mp=43]="mp",t[t.tada=44]="tada",t[t.ibd=51]="ibd"}(ut||(ut={})),ut))();class gt{}var pt=(()=>(function(t){t[t.Root=0]="Root",t[t.Exact=1]="Exact",t[t.StartsWith=2]="StartsWith",t[t.EndsWith=3]="EndsWith",t[t.StartsWithEndsWith=4]="StartsWithEndsWith",t[t.Contains=5]="Contains"}(pt||(pt={})),pt))(),mt=(()=>(function(t){t.Root="/",t.Wildcard="*",t.WildcardStart="/*/",t.WildcardEnd="/*",t.WildcardSandwich="/*/"}(mt||(mt={})),mt))();class ft{constructor(t){this.type=t,this.patterns=[]}}class vt{constructor(){this._onChanged=new u.x,this.onChanged=this._onChanged.asObservable(),this._initialized=!1}get version(){return this._version}get initialized(){return this._initialized}deserialize(t){let e=new Map;for(let n of Object.keys(t)){let i=t[n],o=new Map;for(let t of Object.keys(i)){let e=Object.assign(new gt,i[t]);o[t]=e}e[n]=o}return e}get(t){if(!this._initialized||this.isEmpty()||!t)return null;let e=null,n=new g(t);for(let i of[n.hostname(),n.domain()])if(this.keys.includes(i)&&(e=this.matchSiteByHost(i,n),e))break;return e}getMatchSets(t){let e=new ft(pt.Root),n=new ft(pt.Exact),i=new ft(pt.StartsWith),o=new ft(pt.EndsWith),r=new ft(pt.StartsWithEndsWith),s=new ft(pt.Contains);for(let a of t)a.includes(mt.Wildcard)?a.startsWith("/")&&!a.startsWith(mt.WildcardStart)&&a.endsWith(mt.WildcardEnd)?i.patterns.push(a):a.startsWith(mt.WildcardStart)&&!a.endsWith(mt.Wildcard)?o.patterns.push(a):a.includes(mt.WildcardSandwich)&&a.indexOf(mt.WildcardSandwich)>0&&a.indexOf(mt.WildcardSandwich)==a.lastIndexOf(mt.WildcardSandwich)?r.patterns.push(a):a.startsWith(mt.WildcardStart)&&a.endsWith(mt.WildcardEnd)&&s.patterns.push(a):a==mt.Root?e.patterns.push(a):n.patterns.push(a);return[n,i,o,r,s,e]}getPathMatch(t,e){let n=null;for(let i of e)if(i.patterns.length>0){switch(i.type){case pt.Exact:n=i.patterns.find(e=>e==t);break;case pt.StartsWith:n=i.patterns.find(function(e){let n=e.replace(mt.Wildcard,"");return t.startsWith(n)});break;case pt.EndsWith:n=i.patterns.find(function(e){let n=e.replace(mt.Wildcard,"").replace("//","/");return t.endsWith(n)});break;case pt.StartsWithEndsWith:n=i.patterns.find(function(e){let n=e.split(mt.Wildcard),i=n[1];return t.startsWith(n[0])&&t.endsWith(i)});break;case pt.Contains:n=i.patterns.find(function(e){let n=e.split(mt.Wildcard).join("").replace("//","/");return t.includes(n)});break;case pt.Root:n=i.patterns[0]}if(n)break}return n}isEmpty(){return!this.keys||!this.keys.length}load(t,e){t&&e&&e!==this._version&&(this.map=this.deserialize(t),this.keys=Array.from(Object.keys(this.map)),this._version=e,this._initialized=!0,this._onChanged.next())}matchSiteByHost(t,e){let n=this.map[t],i=new gt;if(n){const t=e.pathname(),o=Array.from(Object.keys(n)),r=this.getMatchSets(o),s=this.getPathMatch(t,r);if(s&&(Object.assign(i,n[s]),i.pages)){const e=Array.from(Object.keys(i.pages)),n=this.getMatchSets(e);let o=this.getPathMatch(t,n);if(!o){const e=t.endsWith("/")?t.substring(0,t.length-1):t+"/";o=this.getPathMatch(e,n)}o&&(i.pageMatch=o)}}return i}}var bt=(()=>(function(t){t[t.LogUrls=1]="LogUrls",t[t.LogPrePurchase=2]="LogPrePurchase",t[t.LogPostPurchase=4]="LogPostPurchase",t[t.LogOrderHistory=8]="LogOrderHistory",t[t.StripQueryParams=16]="StripQueryParams"}(bt||(bt={})),bt))();class _t{constructor(t,e){this.guid=this.generateGuid(),this.created=Date.now(),this.datamap=e,this.datatype=t}generateGuid(){for(var t="",e=1;e<=30;e++)t+=(Math.ceil(8*Math.random())+1).toString();return t.length>38?this.generateGuid():t}}class Ct{constructor(t,e,n,i,o){this.data=t,this.memberID=i,this.extensionID=n,this.extensionVersion=e,this.clientID=o}}class yt{constructor(t){this.ts=t.tab.timeStamp,this.url=this.getUrl(t),this.tabID=t.tab.tabId,this.siteID=t.id}getUrl(t){let e=new g(t.tab.url);return t&&t.settings&&(t.settings&bt.StripQueryParams)==bt.StripQueryParams&&e.query(""),e.toString()}}var xt=(()=>(function(t){t[t.Urls=0]="Urls",t[t.PrePurchaseProducts=1]="PrePurchaseProducts",t[t.PostPurchaseProducts=2]="PostPurchaseProducts",t[t.OrderHistoryProducts=3]="OrderHistoryProducts"}(xt||(xt={})),xt))(),Mt=(()=>(function(t){t[t.WebSearch=0]="WebSearch",t[t.ShopSearch=1]="ShopSearch",t[t.Stores=2]="Stores",t[t.AccountSummary=3]="AccountSummary",t[t.RewardsStore=4]="RewardsStore",t[t.Ledger=5]="Ledger",t[t.Referrals=6]="Referrals",t[t.ForgotPassword=7]="ForgotPassword",t[t.Tutorial=8]="Tutorial",t[t.Answer=9]="Answer",t[t.Profile=10]="Profile",t[t.PromoCodeInfo=11]="PromoCodeInfo"}(Mt||(Mt={})),Mt))();class St{constructor(t,e,n,i){this.locationID=t,this.currency=n,this.currencySymbol=e,this.currencyName=i}}var Ot=(()=>(function(t){t[t.US=1]="US",t[t.CA=2]="CA",t[t.UK=4]="UK",t[t.AU=8]="AU",t[t.IE=16]="IE",t[t.IN=32]="IN",t[t.DE=64]="DE",t[t.FR=128]="FR",t[t.ES=256]="ES"}(Ot||(Ot={})),Ot))(),Pt=(()=>(function(t){t[t.SerpInjection=0]="SerpInjection",t[t.Slider=1]="Slider",t[t.ViewCoupons=2]="ViewCoupons",t[t.ApplyCoupons=3]="ApplyCoupons",t[t.CouponWorker=4]="CouponWorker",t[t.Notification=5]="Notification",t[t.ExtInstalledMessenger=6]="ExtInstalledMessenger",t[t.ExtPresentMessenger=7]="ExtPresentMessenger"}(Pt||(Pt={})),Pt))(),wt=n(6768),At=n(1565),It=n(795),kt=n(4162),Tt=n(4091),Et=n(7524),Rt=n.n(Et),Lt=n(91),Gt=n(6280);let Nt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[]]}),t})(),Dt=(()=>{class t{constructor(){this._couponsEnabled=!0,this._couponInjectionEnabled=!0,this._onConfigurationChanged=new u.x,this.onConfigurationChanged=this._onConfigurationChanged.asObservable(),this.flags=0}get couponsEnabled(){return this._couponsEnabled}get couponInjectionEnabled(){return this._couponInjectionEnabled}get client(){return this.clientId}get brand(){return y[this.clientId]}get sourceId(){return ut[this.brand]}get extensionName(){return x[this.brand]}get hasPseudoCurrency(){return[y.sb,y.mp].includes(this.clientId)}get installTutorialUrl(){return this.clientId==y.sb?`${this.hostDomain}/swagbutton-tutorial`:null}getGlobal(t){return window[t]}get clientId(){return this.getGlobal("__clientId")}get rootDomain(){return this.getGlobal("__rootDomain")}get hostDomain(){return this.getGlobal("__hostDomain")}get rootHost(){return this.getGlobal("__rootHost")}get apiHost(){return this.getGlobal("__apiHost")}get cdnHost(){return this.getGlobal("__cdnHost")}get profileUrl(){return this.getGlobal("__profileUrl")}get goferHost(){return this.getGlobal("__goferHost")}get hostGoDomain(){return this.getGlobal("__hostGoDomain")}get isProd(){return this.getGlobal("__isProd")}get browser(){let t=this.getGlobal("__browserName");return _[t]}init(){this.subscribeConfigChange(Q.Flags,t=>{this.configure(t)})}configure(t){this.flags=t}updateConfiguration(t,e){this._onConfigurationChanged.next(new W(t,e))}subscribeConfigChange(t,e){this.onConfigurationChanged.subscribe(n=>{n.configuration===t&&e(n.value)})}getClientCurrency(t){let e;switch(this.client){case y.mp:e="Point"+(t?"s":"");break;case y.sb:e="SB"}return e}formatAccountBalance(t){const e=this.getClientCurrency(t>1);if(this.hasPseudoCurrency)return`${(new Intl.NumberFormat).format(t)} ${e}`;{let e=t/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}}isFlagEnabled(t){return(this.flags&t)===t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class Ft extends class{constructor(t){t.forEach(t=>{this[t]=this[t].bind(this)})}}{constructor(t){super(["info"]),this.configSvc=t,this.cachedLogPile=[],this.shouldCacheLogs=!1,this.defaultLevel=f.Debug}error(t,e){this.log(t,f.Error,e)}warn(t,e){this.log(t,f.Warn,e)}info(t,e){this.log(t,f.Info,e)}debug(t,e){this.log(t,f.Debug,e)}trace(t,e){this.log(t,f.Trace,e)}table(t){this.logTable(t,f.Debug)}setLevel(t){this.logLevel=t}getLevel(){return this.logLevel}initializeLogLevel(){if(!this.logLevel){const t=this.configSvc.isProd?Ft.LOG_LEVEL_PROD:Ft.LOG_LEVEL_DEV;t<Object.keys(f).length&&this.setLevel(t)}}logTable(t,e){this.initializeLogLevel(),e<=(this.logLevel||this.defaultLevel)&&console.table(t)}log(t,e,n){if(this.initializeLogLevel(),e<=(this.logLevel||this.defaultLevel)){const i=(new Error).stack.split("at ");let o="";i.length>3&&i[3].lastIndexOf(" (")>-1&&(o=i[3].substring(0,i[3].lastIndexOf(" (")));const r="eval"!==o&&""!==o;switch(r&&console.group(o),n=n||"",e){case f.Error:console.error(t,n);break;case f.Warn:console.warn(t,n);break;case f.Info:console.info(t,n);break;case f.Debug:console.log(t,n);break;case f.Trace:console.log(t,n),console.trace()}r&&console.groupEnd(),this.shouldCacheLogs&&this.cachedLogPile.push({level:f[e],message:t,extraInfo:n})}}}Ft.LOG_LEVEL_PROD=f.Error,Ft.LOG_LEVEL_DEV=f.Trace,Ft.\u0275fac=function(t){return new(t||Ft)(o.LFG(Dt))},Ft.\u0275prov=o.Yz7({token:Ft,factory:Ft.\u0275fac,providedIn:"root"});class Ut{constructor(){this._api=null}_noop(){}buildEvent(t,e){return{addListener:t||this._noop,removeListener:e||this._noop}}constructApi(){this._api=window.chrome,this._api.management={},this._api.management.onInstalled=this.buildEvent(this.onInstalled,this._noop),this._api.management.onEnabled=this.buildEvent(this._noop,this._noop),this._api.management.onDisabled=this.buildEvent(this._noop,this._noop),this._api.management.onUninstalled=this.buildEvent(this._noop,this._noop),this._api.management.get=this.getExtension,this._api.management.getAll=this.getAllExtensions,this._api.management.getSelf=this.getSelf,this._api.runtime.onSuspendCanceled=this.buildEvent(this._noop,this._noop),this._api.tabs.reload=this.reloadTab,this._api.tabs.onReplaced=this.buildEvent(this._noop,this._noop),this._api.runtime.onSuspend=this.buildEvent(this._noop,this._noop)}onInstalled(t){this._api.runtime.onInstalled.addListener(function(e){if("install"===e.reason||"update"===e.reason){var n={id:this.api.runtime.id,name:this.api.runtime.getManifest().name,version:this.api.runtime.getManifest().version,installType:"normal",enabled:!0};t(n)}})}constructExtension(){return{id:this._api.runtime.id,name:this._api.runtime.getManifest().name,version:this._api.runtime.getManifest().version,installType:"normal",enabled:!0}}getSelf(t){t(this.constructExtension())}getExtension(t,e){this.getSelf(e)}getAllExtensions(t){t([this.constructExtension()])}reloadTab(t,e){this._api.tabs.get(t,function(t){t&&this.api.tabs.update(t.id,{url:t.url})})}}let Zt=(()=>{class t extends Ut{constructor(){super()}get api(){return this._api||this.constructApi(),this._api}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),qt=(()=>{class t extends Ut{constructor(){super()}get api(){return this._api||this.constructApi(),this._api}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Ht=(()=>{class t{constructor(t,e,n,i){this.edge=t,this.firefox=e,this.sanitizer=n,this.consoleSvc=i,this._api=null,this.callbackDecorator=(t,e,n,i)=>{const o=n;return new Promise((r,s)=>{e(...n,(...e)=>{const n=this.api.runtime.lastError;n?(this.consoleSvc.error(`Browser api error: ${t}(${o.join(", ")}):`,n.message),s(n)):i?r(i(...e)):r()})})}}get api(){if(!this._api)switch(this.browser){case _.chrome:this._api=chrome;break;case _.firefox:this._api=this.firefox.api;break;case _.edge:this._api=this.edge.api}return this._api}get name(){return window.__browserName}get browser(){return _[this.name]}getSanitizedLocalizedMessage(t,e){const n=this.getLocalizedMessage(t,e);return this.sanitizer.bypassSecurityTrustHtml(n)}getLocalizedMessage(t,e){let n;try{n=this.api.i18n.getMessage(t,e)}catch(i){this.consoleSvc.error(`getLocalizedMessage failed for ${t} with ${e}`)}return n}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Zt),o.LFG(qt),o.LFG(i.H7),o.LFG(Ft))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),zt=(()=>{class t{constructor(t){this.consoleSvc=t}handleError(t,e=!0){kt.t&&!e?kt.t.track(t.originalError||t):this.consoleSvc.error(t.message,t)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ft))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),jt=(()=>{class t{constructor(t,e,n,i){this.http=t,this.consoleSvc=e,this.configSvc=n,this.exceptionHandler=i}executeRequest(t){return new Promise((e,n)=>{t.pipe((0,It.X)(B.HTTP_RETRIES)).subscribe(t=>{e(t)},t=>{200===t.status?(this.exceptionHandler.handleError(new Error(`HTTP request responded with error, but status = 200: ${t}`),!1),e(null)):(this.exceptionHandler.handleError(new Error(`HTTP request retried and failed: ${JSON.stringify(t)}: ${console.trace()}`),!1),n(t))})})}getText(t){return new Promise((e,n)=>{this.http.get(t,{responseType:"text"}).pipe((0,It.X)(B.HTTP_RETRIES)).subscribe(t=>e(t),t=>{this.exceptionHandler.handleError(t,!1),n(t)})})}get(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeRequest(this.http.get(t))})}post(t,e){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeRequest(this.http.post(t,e,{responseType:"json",headers:(new s.WM).set("Content-Type","application/x-www-form-urlencoded")}))})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(s.eN),o.LFG(Ft),o.LFG(Dt),o.LFG(zt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Jt=(()=>{class t{constructor(t,e){this.browser=t,this.configSvc=e,this.HTTP_URLS="http://*/*",this.HTTPS_URLS="https://*/*",this._onRuntimeInstalled=new u.x,this.onRuntimeInstalled=this._onRuntimeInstalled.asObservable(),this._onRuntimeStartup=new u.x,this.onRuntimeStartup=this._onRuntimeStartup.asObservable(),this._onRuntimeSuspend=new u.x,this.onRuntimeSuspend=this._onRuntimeSuspend.asObservable(),this._onRuntimeSuspendCanceled=new u.x,this.onRuntimeSuspendCanceled=this._onRuntimeSuspendCanceled.asObservable(),this._onRuntimeMessage=new u.x,this.onRuntimeMessage=this._onRuntimeMessage.asObservable(),this._onTabCreated=new u.x,this.onTabCreated=this._onTabCreated.asObservable(),this._onTabRemoved=new u.x,this.onTabRemoved=this._onTabRemoved.asObservable(),this._onTabUpdated=new u.x,this.onTabUpdated=this._onTabUpdated.asObservable(),this._onBeforeWebRedirect=new u.x,this.onBeforeWebRedirect=this._onBeforeWebRedirect.asObservable(),this._onBeforeWebRequest=new u.x,this.onBeforeWebRequest=this._onBeforeWebRequest.asObservable(),this._onWebRequestCompleted=new u.x,this.onWebRequestCompleted=this._onWebRequestCompleted.asObservable(),this._onWebNavigationCommitted=new u.x,this.onWebNavigationCommitted=this._onWebNavigationCommitted.asObservable(),this._onWebNavigationDOMContentLoaded=new u.x,this.onWebNavigationDOMContentLoaded=this._onWebNavigationDOMContentLoaded.asObservable(),this._onStorageChanged=new u.x,this.onStorageChanged=this._onStorageChanged.asObservable(),this._onCookiesChanged=new u.x,this.onCookiesChanged=this._onCookiesChanged.asObservable(),this._onStartSurveyLogging=new u.x,this.onStartSurveyLogging=this._onStartSurveyLogging.asObservable(),this._onEndSurveyLogging=new u.x,this.onEndSurveyLogging=this._onEndSurveyLogging.asObservable(),this._onUpdateSurveyLogging=new u.x,this.onUpdateSurveyLogging=this._onUpdateSurveyLogging.asObservable(),this._onInstallTutorialLoaded=new u.x,this.onInstallTutorialLoaded=this._onInstallTutorialLoaded.asObservable(),this._onNotificationClicked=new u.x,this.onNotificationClicked=this._onNotificationClicked.asObservable()}init(){let t=t=>{this._onRuntimeInstalled.next(t)};this.browser.api.runtime.onInstalled.removeListener(t),this.browser.api.runtime.onInstalled.addListener(t);let e=()=>{this._onRuntimeStartup.next()};this.browser.api.runtime.onStartup.removeListener(e),this.browser.api.runtime.onStartup.addListener(e);let n=()=>{this._onRuntimeSuspend.next()};this.browser.api.runtime.onSuspend.removeListener(n),this.browser.api.runtime.onSuspend.addListener(n);let i=()=>{this._onRuntimeSuspendCanceled.next()};this.browser.api.runtime.onSuspendCanceled.removeListener(i),this.browser.api.runtime.onSuspendCanceled.addListener(i);let o=(t,e,n)=>(this._onRuntimeMessage.next([t,e,n]),!0);this.browser.api.runtime.onMessage.removeListener(o),this.browser.api.runtime.onMessage.addListener(o);let r=t=>{this._onTabCreated.next(t)};this.browser.api.tabs.onCreated.removeListener(r),this.browser.api.tabs.onCreated.addListener(r);let s=t=>{this._onTabRemoved.next(t)};this.browser.api.tabs.onRemoved.removeListener(s),this.browser.api.tabs.onRemoved.addListener(s);let a=(t,e,n)=>{this._onTabUpdated.next({tabId:t,changeInfo:e,tab:n})};this.browser.api.tabs.onUpdated.removeListener(a),this.browser.api.tabs.onUpdated.addListener(a);let c=t=>{this._onBeforeWebRequest.next(t),this._onUpdateSurveyLogging.next({event:"onBeforeRequest",details:t})};this.browser.api.webRequest.onBeforeRequest.removeListener(c),this.browser.api.webRequest.onBeforeRequest.addListener(c,{urls:[this.HTTP_URLS,this.HTTPS_URLS],types:["main_frame"]});let l=(t,e)=>{this._onStorageChanged.next([t,e])};this.browser.api.storage.onChanged.removeListener(l),this.browser.api.storage.onChanged.addListener(l);let d=t=>{this._onCookiesChanged.next(t)};this.browser.api.cookies.onChanged.removeListener(d),this.browser.api.cookies.onChanged.addListener(d);let h=t=>{this._onBeforeWebRedirect.next(t),this._onUpdateSurveyLogging.next({event:"onBeforeRedirect",details:t})};this.browser.api.webRequest.onBeforeRedirect.removeListener(h),this.browser.api.webRequest.onBeforeRedirect.addListener(h,{urls:[this.HTTP_URLS,this.HTTPS_URLS],types:["main_frame"]});let u=t=>{this._onUpdateSurveyLogging.next({event:"onCompleted",details:t}),this._onWebRequestCompleted.next(t)};this.browser.api.webRequest.onCompleted.removeListener(u),this.browser.api.webRequest.onCompleted.addListener(u,{urls:[this.HTTP_URLS,this.HTTPS_URLS],types:["main_frame"]});let g=t=>{this._onUpdateSurveyLogging.next({event:"onErrorOccurred",details:t})};this.browser.api.webRequest.onErrorOccurred.removeListener(g),this.browser.api.webRequest.onErrorOccurred.addListener(g,{urls:[this.HTTP_URLS,this.HTTPS_URLS],types:["main_frame"]});let p=t=>{this._onWebNavigationCommitted.next(t)};this.browser.api.webNavigation.onCommitted.removeListener(p),this.browser.api.webNavigation.onCommitted.addListener(p,{url:[{schemes:["https","http"]}]});let m=t=>{this._onWebNavigationDOMContentLoaded.next(t)};this.browser.api.webNavigation.onDOMContentLoaded.removeListener(m),this.browser.api.webNavigation.onDOMContentLoaded.addListener(m,{url:[{schemes:["https","http"]}]});const f=["main_frame"],v={urls:[`${this.configSvc.hostDomain}/g/survey-click?*`],types:f},b={urls:[`${this.configSvc.hostDomain}/surveys?*`],types:f};let _=t=>{this._onStartSurveyLogging.next(t)};this.browser.api.webRequest.onBeforeRequest.removeListener(_),this.browser.api.webRequest.onBeforeRequest.addListener(_,v);let C=t=>{this._onEndSurveyLogging.next(t)};if(this.browser.api.webRequest.onCompleted.removeListener(C),this.browser.api.webRequest.onCompleted.addListener(C,b),this.configSvc.installTutorialUrl){const t={url:[{urlPrefix:`${this.configSvc.installTutorialUrl}`,queryContains:"isNew=1"}]};let e=t=>{this._onInstallTutorialLoaded.next(t)};this.browser.api.webNavigation.onCompleted.removeListener(e),this.browser.api.webNavigation.onCompleted.addListener(e,t)}if(this.browser.api.notifications){let t=t=>{this._onNotificationClicked.next(t)};this.browser.api.notifications.onClicked.removeListener(t),this.browser.api.notifications.onClicked.addListener(t),this.browser.api.notifications.onButtonClicked.removeListener(t),this.browser.api.notifications.onButtonClicked.addListener(t)}}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ht),o.LFG(Dt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),$t=(()=>{class t{constructor(t,e){this.browser=t,this.browserEvents=e,this.TIMED_EXPIRATION=6,this.STORAGE_AREA_LOCAL="local",this._browserStorageLocalChanged=new u.x,this.browserStorageLocalChanged=this._browserStorageLocalChanged.asObservable(),this._extId=null,this._extHash=null,this.prefs=new w("prefs"),this.flags=new w(B.FLAGS_STORAGE_KEY),this.config=new w("config"),this.campaign=new E(new R("campaign",this.browser.api),this.browserStorageLocalChanged),this.referral=new w("referral"),this.merchants=new T(new w("merchants")),this.identifier=new w("identifier"),this.lastPeerLog=new w("last-peer-log"),this.dataInsights=new k(new w("data-insights"),this.TIMED_EXPIRATION),this.lastCallback=new w("last-callback"),this.lastCallbackTry=new w("last-callback-try"),this.siteMapHash=new w("site-map-hash"),this.merchantHash=new w("merchant-hash"),this.affiliateHash=new w("affiliate-hash"),this.tutorialViewed=new w(B.TUTORIAL_KEY),this.featuredMerchants=new w("featured-merchants"),this.shopBonusLastShown=new w("shop-bonus-last-shown"),this.couponMerchantScripts=new k(new w("coupon-scripts"),this.TIMED_EXPIRATION),this.jsonCouponMerchantScripts=new k(new w("json-coupon-scripts"),this.TIMED_EXPIRATION),this.extensionAlert=new w("extension-alert"),this.token=new w("token"),this.member=new w("member")}get extId(){return this._extId||(this._extId=new E(new R("ext-id",this.browser.api),this.browserStorageLocalChanged)),this._extId}get extHash(){return this._extHash||(this._extHash=new E(new R("ext-hash",this.browser.api),this.browserStorageLocalChanged)),this._extHash}init(){this.browserEvents.onStorageChanged.subscribe(t=>{this.onBrowserStorageChanged.apply(this,t)})}getLocal(t){let e=localStorage.getItem(t);try{return JSON.parse(e)}catch(n){return e}}setLocal(t,e){localStorage.setItem(t,JSON.stringify(e))}removeLocal(t){localStorage.removeItem(t)}onBrowserStorageChanged(t,e){e===this.STORAGE_AREA_LOCAL&&this._browserStorageLocalChanged.next(t)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ht),o.LFG(Jt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Bt=(()=>{class t{constructor(t,e,n,i,o,r){this.browser=t,this.consoleSvc=e,this.configSvc=n,this.networkSvc=i,this.storage=o,this.exceptions=r,this.API_COMMANDS={PONG:new L("ext-pong"),LOGIN:new L("ext-login"),UPDATE:new L("ext-update"),INSTALL:new L("ext-install",!1),CALLBACK:new L("ext-callback"),REGISTER:new L("ext-register"),UNINSTALL:new L("ext-uninstall"),RECONNECT:new L("ext-reconnect"),REISSUE_ID:new L("ext-reissue",!1),CAMPAIGN_DATA:new L("ext-cmp-data"),LOG_COUPONS:new L("ext-log-coupon"),LOG_MERCHANT_SESSION:new L("ext-log-merchant"),LOG_SURVEY_REDIRECTS:new L("ext-log-survey-redirect"),SEND_PASSWORD_REMINDER:new L("sb-pswd-reminder",!1),CHECK_PROMO_CODE:new L("ext-check-code"),REDEEM_PROMO_CODE:new L("ext-redeem-code"),GET_BALANCE:new L("ext-account-balance"),REFERRAL:new L("ext-referral"),CHECK_OFFER_PLACEMENT:new L("oh-ext-placement-available"),GET_FEATURED_OFFER_PLACEMENT:new L("ext-get-offer-placement"),CHECK_SHOPPER_MARKETING_OFFER:new L("ext-get-shm-merchant-offers"),LOG_PEER:new L("ext-log-peer"),UPDATE_MEMBER_PREFS:new L("ext-update-member-prefs"),GET_TOKEN:new L("ext-get-token")},this.SUPPRESS_DEFAULT_ARGS=!0,this.legacyHashes=new N,this._badHashDetected=new u.x,this.badHashDetected=this._badHashDetected.asObservable()}get version(){return this.browser.api.runtime.getManifest().version}get cacheBuster(){let t=Date.now();return t-t%3e5}generateApiCommandUrl(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){let i=new g(`${this.configSvc.apiHost}?cmd=${t.command}`),o=n?{}:yield this.getDefaultArgs();if(o&&i.addQuery(o),e&&i.addQuery(e),t.requiresHash&&(!i.hasQuery("extid")||!i.hasQuery("hash"))&&!n)throw this._badHashDetected.next(),new Error(`ApiCommand ${t.command} missing required args for hash validation.`);return i.toString()})}getDefaultArgs(){return(0,h.mG)(this,void 0,void 0,function*(){let t={},e=yield this.storage.extId.get(),n=yield this.storage.extHash.get(),i=yield this.storage.token.get(),o=yield this.getMemberId(),r=this.version;return e&&(t.extid=e),n&&(t.hash=n),i&&(t.secTkn=i),(o||0===o)&&(t.mid=o),r&&(t.v=r),t})}getFormData(t){return Object.keys(t).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e])).join("&")}checkIfResponseHasBadStatus(t,e){return!e&&1001===t&&(this._badHashDetected.next(),this.consoleSvc.debug("Bad Hash 1001 in response"),!0)}executeApiCommand(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){try{let i=yield this.generateApiCommandUrl(t,e,n);const o=yield this.networkSvc.get(i);if(o&&!this.checkIfResponseHasBadStatus(o.status,n))return o;throw new Error(`No valid response for the command ${t.command}, url: ${i}`)}catch(i){return this.exceptions.handleError(i),null}})}executeTextApiCommand(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){try{let i=yield this.generateApiCommandUrl(t,e,n);return yield this.networkSvc.getText(i)}catch(i){return this.exceptions.handleError(i),null}})}executePostApiCommand(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){try{let i=yield this.generateApiCommandUrl(t,{},this.SUPPRESS_DEFAULT_ARGS),o=n?{}:yield this.getDefaultArgs();if(t.requiresHash&&!(o&&o.extid&&o.hash))throw this._badHashDetected.next(),new Error(`ApiCommand ${t.command} missing required args for hash validation.`);Object.assign(o,e);let r=this.getFormData(o);const s=yield this.networkSvc.post(i,r);if(s&&!this.checkIfResponseHasBadStatus(s.status,n))return s;throw new Error(`No valid response for the command ${t.command}, url: ${i}`)}catch(i){return this.exceptions.handleError(i),null}})}getMemberId(){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.storage.member.get();return t?t.id:null})}sanitize(t){let e={};for(const n of Object.keys(t))null!=t[n]&&(e[n]=t[n]);return e}executeCallback(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.CALLBACK)})}executeInstall(){return(0,h.mG)(this,void 0,void 0,function*(){let t={v:this.version};const e=yield this.storage.token.get();return e&&(t.secTkn=e),yield this.executeApiCommand(this.API_COMMANDS.INSTALL,t,this.SUPPRESS_DEFAULT_ARGS)})}executeLogin(t,e){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executePostApiCommand(this.API_COMMANDS.LOGIN,{emailAddress:t,pswd:e})})}executePong(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.PONG,{msgValue:t.value})})}executeReconnect(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.RECONNECT)})}executeRegister(t,e){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executePostApiCommand(this.API_COMMANDS.REGISTER,{emailAddress:t,password:e})})}executeReissueId(t){return(0,h.mG)(this,void 0,void 0,function*(){const e=yield this.getMemberId(),n=yield this.storage.token.get();let i={v:this.version};n&&(i.secTkn=n),e&&(i.mid=e),t&&(i.tbid=t);let o=yield this.executeApiCommand(this.API_COMMANDS.REISSUE_ID,i,this.SUPPRESS_DEFAULT_ARGS);return yield this.storage.extId.set(o.data.extension.id,!0),yield this.storage.extHash.set(o.data.extension.hashes.extension,!0),o})}executeUpdate(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.UPDATE)})}executeSurveyLog(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executePostApiCommand(this.API_COMMANDS.LOG_SURVEY_REDIRECTS,t)})}constructCdnUrl(t){return`${this.configSvc.cdnHost}/json/extension/${t}.json?v=${this.cacheBuster}`}fetchFromCdn(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=this.constructCdnUrl(t);return yield this.networkSvc.get(e)})}fetchMerchants(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n=this.configSvc.client,i=yield this.fetchFromCdn(`merchant-map/${n}-${e}-${t}`),o=Object.entries(i);return new Map(o)})}fetchCdnJson(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=this.constructCdnUrl(t);return yield this.networkSvc.getText(e)})}fetchMerchantJson(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.fetchCdnJson(`merchant/${t}`)})}fetchDiscoverPlacementJson(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.fetchCdnJson(`offer-placement/${t}`)})}fetchSiteMapJson(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.fetchFromCdn(`site-map/${t}`)})}getUninstallUrl(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.generateApiCommandUrl(this.API_COMMANDS.UNINSTALL)})}sendPasswordReminder(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.executePostApiCommand(this.API_COMMANDS.SEND_PASSWORD_REMINDER,{email:t},this.SUPPRESS_DEFAULT_ARGS)})}fetchAffiliateNetworks(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.fetchFromCdn(`affiliate-list/${t}`)})}postCampaignData(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.executePostApiCommand(this.API_COMMANDS.CAMPAIGN_DATA,this.sanitize(t))})}postReferralData(t){return(0,h.mG)(this,void 0,void 0,function*(){return t.referredID=yield this.getMemberId(),(yield this.executePostApiCommand(this.API_COMMANDS.REFERRAL,t)).status})}postCouponLog(t){return(0,h.mG)(this,void 0,void 0,function*(){this.consoleSvc.debug("Posting Coupon Log. CouponApplyResults:",t);let e=yield this.executePostApiCommand(this.API_COMMANDS.LOG_COUPONS,t);0!==e.status&&this.consoleSvc.debug(`Problem with postCouponLog. Code:${e.status} , couponApplyResults:`,t)})}postMerchantSessionLog(t){return(0,h.mG)(this,void 0,void 0,function*(){this.consoleSvc.debug("Posting Merchant Session Log. MerchantSessionLog:",t),t.merchantActivationHistory=JSON.stringify(t.merchantActivationHistory);let e=yield this.executePostApiCommand(this.API_COMMANDS.LOG_MERCHANT_SESSION,t);0!==e.status&&this.consoleSvc.debug(`Problem with postMerchantSessionLog. Code:${e.status} , merchantSessionLog:`,t)})}postPeerLog(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=yield this.executePostApiCommand(this.API_COMMANDS.LOG_PEER,t);e&&e.status===b.OK||this.exceptions.handleError(new Error(`Failed to post peer log: ${JSON.stringify({log:t,response:e})}`))})}updateMemberPrefs(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.UPDATE_MEMBER_PREFS,{prefs:t})})}checkPromoCode(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.CHECK_PROMO_CODE)})}redeemPromoCode(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.REDEEM_PROMO_CODE,{pcode:t})})}checkOfferPlacement(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.CHECK_OFFER_PLACEMENT,{placementID:t})})}getFeaturedOfferPlacement(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.GET_FEATURED_OFFER_PLACEMENT)})}checkShopperMarketingPlacement(t){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.CHECK_SHOPPER_MARKETING_OFFER,{merchantID:t})})}getAccountBalance(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.GET_BALANCE)})}getToken(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.executeApiCommand(this.API_COMMANDS.GET_TOKEN)})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ht),o.LFG(Ft),o.LFG(Dt),o.LFG(jt),o.LFG($t),o.LFG(zt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Yt=(()=>{class t{constructor(t,e){this.browser=t,this.consoleSvc=e,this.registeredAlarms=new Map,this._beepingAlarmName=new u.x,this.beepingAlarmName=this._beepingAlarmName.asObservable()}init(){return(0,h.mG)(this,void 0,void 0,function*(){yield this.clearAllAlarms(),this.browser.api.alarms.onAlarm.addListener(t=>{const e=this.registeredAlarms.get(t.name);e&&(this.consoleSvc.debug(e.name+" beeping!"),this._beepingAlarmName.next(e.name))})})}registerAlarm(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){yield this.clearAlarm(t);const i=this.beepingAlarmName.subscribe(e=>(0,h.mG)(this,void 0,void 0,function*(){t===e&&(yield n())})),o=new J(t,e,i);this.registeredAlarms.set(o.name,o),this.browser.api.alarms.create(o.name,e)})}clearAlarm(t){return this.browser.callbackDecorator("alarms.clear",this.browser.api.alarms.clear,[t],()=>{this.registeredAlarms.has(t)&&(this.registeredAlarms.get(t).subscription.unsubscribe(),this.registeredAlarms.delete(t))})}clearAllAlarms(){return this.browser.callbackDecorator("alarms.clearAll",this.browser.api.alarms.clearAll,[],()=>{this.registeredAlarms.forEach(t=>{t.subscription.unsubscribe()}),this.registeredAlarms.clear()})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ht),o.LFG(Ft))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Wt=(()=>{class t{constructor(t,e,n,i){this.alarmSvc=t,this.apiSvc=e,this.configSvc=n,this.consoleSvc=i,this.isConnected=!1,this._survey=new u.x,this._promoCode=new u.x,this._onReflect=new u.x,this.survey=this._survey.asObservable(),this.promoCode=this._promoCode.asObservable(),this.onReflect=this._onReflect.asObservable(),this.goferConfig={url:this.configSvc.goferHost,topics:[]},this.lastMessageInterval=12e4,this.minReconnectInterval=500,this.maxReconnectInterval=72e5,this.backoffRate=2,this.currentMinReconnectInterval=this.minReconnectInterval,this.currentMaxReconnectInterval=this.minReconnectInterval*this.backoffRate}routeMessage(t){switch(t.type){case"FLAGS":this.configSvc.updateConfiguration(Q.Flags,t.msg);break;case"SURVEY":this._survey.next(t);break;case"REFLECT":this._onReflect.next(t.msg);break;case"PING_PONG":this.apiSvc.executePong(t);break;case"PROMO_CODE":this._promoCode.next(t);break;case"SITE_MAP":this.configSvc.updateConfiguration(Q.SiteMapHash,t.msg);break;case"MERCHANT_LIST":this.configSvc.updateConfiguration(Q.MerchantHash,t.msg);break;case"AFFILIATE_LIST":this.configSvc.updateConfiguration(Q.AffiliateHash,t.msg);break;case"FEATURED_MERCHANTS":this.configSvc.updateConfiguration(Q.FeaturedMerchants,t.msg);break;default:this.consoleSvc.debug("Invalid Gofer message type:",t.type)}}close(){return(0,h.mG)(this,void 0,void 0,function*(){!this.socket||this.socket.closed?this.isConnected=!1:this.socket.complete()})}connect(){return(0,h.mG)(this,void 0,void 0,function*(){this.lastConnectionAttempt=Date.now(),this.socket=(0,Tt.j)(this.goferConfig.url),this.socket.subscribe(t=>this.publishMessage(t),t=>this.onSocketError(t),()=>this.onSocketComplete())})}hasOpenConnection(){return this.isConnected&&this.socket&&!this.socket.closed&&this.lastMessageReceived&&Date.now()-this.lastMessageReceived<=this.lastMessageInterval}hasValidGoferConfig(){return this.goferConfig&&this.goferConfig.url&&this.goferConfig.topics&&this.goferConfig.topics.length>0}onSocketComplete(){this.consoleSvc.debug("connection closed"),this.isConnected=!1}onSocketError(t){this.consoleSvc.debug("socket error"+JSON.stringify(t)),this.isConnected=!1,this.retryConnection()}publishMessage(t){this.consoleSvc.debug("received a message:"+JSON.stringify(t)),this.lastMessageReceived=Date.now(),this.isConnected||(this.isConnected=!0,this.updateSubscriptions(),this.resetRetryIntervals()),class{static isValid(t){return t.hasOwnProperty("msg")&&t.hasOwnProperty("type")}}.isValid(t)&&this.routeMessage(t)}refreshConnection(){return(0,h.mG)(this,void 0,void 0,function*(){return this.consoleSvc.debug("refresh connection"),yield this.close(),yield this.connect()})}resetRetryIntervals(){this.currentMinReconnectInterval=this.minReconnectInterval,this.currentMaxReconnectInterval=this.minReconnectInterval*this.backoffRate}retryConnection(){if(this.isConnected)this.consoleSvc.debug("already connected, aborting retry connection");else if(this.lastConnectionAttempt+this.currentMinReconnectInterval<Date.now())this.consoleSvc.debug("retrying connection..."),this.currentMinReconnectInterval=this.currentMinReconnectInterval*this.backoffRate,this.currentMaxReconnectInterval=this.currentMaxReconnectInterval*this.backoffRate,this.connect();else{let t=Math.floor(Math.random()*(this.currentMaxReconnectInterval-this.currentMinReconnectInterval))+this.currentMinReconnectInterval;t=t>this.maxReconnectInterval?this.maxReconnectInterval:t,this.consoleSvc.debug("will attempt retry between "+this.currentMinReconnectInterval+" and "+this.currentMaxReconnectInterval+" ("+t+")..."),setTimeout(()=>{this.retryConnection()},t)}}updateGoferConfig(t){t.url&&t.url!=this.goferConfig.url?(this.goferConfig=t,this.refreshConnection()):t.topics!=this.goferConfig.topics&&(this.goferConfig=t,this.updateSubscriptions())}updateSubscriptions(){return(0,h.mG)(this,void 0,void 0,function*(){this.hasOpenConnection()&&this.socket.next(JSON.parse('{"command": "replace", "topics": '+JSON.stringify(this.goferConfig.topics)+"}"))})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Yt),o.LFG(Bt),o.LFG(Dt),o.LFG(Ft))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Qt=(()=>{class t{constructor(t,e){this.storageSvc=t,this.configurationSvc=e,this.legacyIdStorageName="legacyId",this.legacyMemberPreferenceNewStorageName="legacyMemberSettings",this.legacyMemberPreferenceOldStorageName="SE_Settings"}get legacyExtensionStorageName(){return this.configurationSvc.client===y.tada?B.LEGACY_ID_NAMES.TADA:B.LEGACY_ID_NAMES.SBMP}getLegacyMemberPreference(){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.storageSvc.getLocal(this.legacyMemberPreferenceOldStorageName);return t&&(t=JSON.parse(t.replace("obj_",""))),t})}getLegacyId(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.storageSvc.getLocal(this.legacyExtensionStorageName)})}renameLegacyId(){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.storageSvc.getLocal(this.legacyExtensionStorageName);yield this.storageSvc.setLocal(this.legacyIdStorageName,t),yield this.storageSvc.removeLocal(this.legacyExtensionStorageName)})}renameLegacyMemberPreferences(){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.storageSvc.getLocal(this.legacyMemberPreferenceOldStorageName);yield this.storageSvc.setLocal(this.legacyMemberPreferenceNewStorageName,t),yield this.storageSvc.removeLocal(this.legacyMemberPreferenceOldStorageName)})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG($t),o.LFG(Dt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Vt=(()=>{class t{constructor(t,e,n){this.console=t,this.browser=e,this.browserEvents=n,this.subscriptions=[]}init(){this.browserEvents.onCookiesChanged.subscribe(t=>{this.subscriptions.filter(e=>t.cookie.domain.includes(e.domainIncludes)&&t.cookie.name===e.name).forEach(e=>{e.callback(t)})})}subscribe(t){this.subscriptions.push(t)}get(t,e){return(0,h.mG)(this,void 0,void 0,function*(){return new Promise((n,i)=>{this.browser.api.cookies.getAll({name:t,domain:e},t=>{let e=this.browser.api.runtime.lastError;e?(this.console.error("cookies.getAll error:",e),i(e)):n(t)})})})}remove(t,e){return(0,h.mG)(this,void 0,void 0,function*(){return new Promise((n,i)=>{chrome.cookies.remove({name:t,url:e},()=>{let t=this.browser.api.runtime.lastError;t?(this.console.error("cookies.remove error:",t),i(t)):n()})})})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ft),o.LFG(Ht),o.LFG(Jt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Kt=(()=>{class t{constructor(t,e,n,i,o,r,s,a,c,l,d){this.alarmSvc=t,this.apiSvc=e,this.browser=n,this.exceptionHandler=i,this.goferSvc=o,this.consoleSvc=r,this.storage=s,this.legacyExtensionSvc=a,this.config=c,this.browserEvents=l,this.cookies=d,this.isUserAuthenticating=!1,this._onAccountInfoChanged=new u.x,this.onAccountInfoChanged=this._onAccountInfoChanged.asObservable(),this._onInstalled=new u.x,this.onInstalled=this._onInstalled.asObservable(),this._onTokenCookieChanged=new u.x,this.onTokenCookieChanged=this._onTokenCookieChanged.asObservable(),this.isInstallOrStartup=!1,this.getConfigsOnStartAlarmName="getFreshConfigsOnStart",this.getConfigsOnStartDelay=1,this.goferCheckAlarmName="GoferStatusCheck",this.goferCheckIntervalInMinutes=5,this.dailyCallbacksLimit=5,this.dailyCallbackCount=0,this.isReissuing=!1,this.isExecutingCallback=!1,this.onStartUpDelay=4e3}init(){this.browserEvents.onRuntimeStartup.pipe((0,wt.g)(this.onStartUpDelay)).subscribe(()=>{this.onStartup()}),this.browserEvents.onRuntimeInstalled.subscribe(t=>{this.onInstall(t)}),this.cookies.subscribe(new ht(this.config.rootDomain,B.TOKEN_COOKIE,t=>{this.onCookiesChanged(t)})),this.apiSvc.badHashDetected.subscribe(()=>{this.reissue(et.BadHashDetected)}),this.alarmSvc.registerAlarm(this.getConfigsOnStartAlarmName,{delayInMinutes:this.getConfigsOnStartDelay},()=>(0,h.mG)(this,void 0,void 0,function*(){this.isInstallOrStartup||(yield this.loadAndStoreTokenCookie(),yield this.getFreshConfigs(),yield this.goferSvc.refreshConnection())})),this.alarmSvc.registerAlarm(this.goferCheckAlarmName,{periodInMinutes:this.goferCheckIntervalInMinutes},()=>(0,h.mG)(this,void 0,void 0,function*(){yield this.checkGoferConnection()}))}checkGoferConnection(){return(0,h.mG)(this,void 0,void 0,function*(){this.consoleSvc.debug("checking gofer connection..."),this.goferSvc.hasValidGoferConfig()||(this.consoleSvc.debug("invalid configs, get some freshies"),yield this.getFreshConfigs()),this.goferSvc.hasOpenConnection()||(this.consoleSvc.debug("no open connection, refresh it"),yield this.goferSvc.refreshConnection())})}getFreshConfigs(){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.apiSvc.executeReconnect();yield this.processResponse(t)})}loadTokenCookieFromSite(){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.cookies.get(B.TOKEN_COOKIE,this.config.rootDomain);return t.length?t[0]:null})}loadAndStoreTokenCookie(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield this.loadTokenCookieFromSite();t&&t.domain.includes(this.config.rootDomain)&&t.name===B.TOKEN_COOKIE&&t.value&&(yield this.storage.token.set(t.value))})}onCookiesChanged(t){return(0,h.mG)(this,void 0,void 0,function*(){!t.removed&&t.cookie.value&&(yield this.storage.token.set(t.cookie.value),this._onTokenCookieChanged.next(),this.isUserAuthenticating||(yield this.getFreshConfigs()))})}onInstall(t){return(0,h.mG)(this,void 0,void 0,function*(){this.isInstallOrStartup=!0,yield this.loadAndStoreTokenCookie();let e=t.reason;switch(this.consoleSvc.debug("onInstall "+e),e){case"install":this.isReissuing=!0;let t=yield this.apiSvc.executeInstall();yield this.processResponse(t);let e=yield this.storage.campaign.get();e&&(yield this.apiSvc.postCampaignData(e)),yield this.setUninstallUrl(),this._onInstalled.next(t),this.isReissuing=!1;break;case"update":let n=yield this.storage.extId.get(),i=yield this.storage.extHash.get();n&&i||(yield this.reissue(et.FalsyIdOrHashOnUpdate));let o=yield this.apiSvc.executeUpdate();yield this.processResponse(o)}this.goferSvc.hasOpenConnection()||(yield this.goferSvc.refreshConnection())})}onStartup(){return(0,h.mG)(this,void 0,void 0,function*(){this.isInstallOrStartup=!0,this.consoleSvc.debug("onStartup");let t=yield this.storage.extId.get(),e=yield this.storage.extHash.get();yield this.loadAndStoreTokenCookie(),t&&e?yield this.getFreshConfigs():yield this.reissue(et.FalsyIdOrHashOnStartup),this.goferSvc.hasOpenConnection()||(yield this.goferSvc.refreshConnection())})}onSuspend(){return(0,h.mG)(this,void 0,void 0,function*(){this.consoleSvc.debug("onSuspend"),yield this.goferSvc.close()})}onSuspendCanceled(){return(0,h.mG)(this,void 0,void 0,function*(){this.consoleSvc.debug("onSuspendCanceled"),yield this.goferSvc.refreshConnection()})}executeCallback(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield this.storage.extId.get(),e=yield this.storage.extHash.get();if(t&&e){if(!this.isExecutingCallback){this.isExecutingCallback=!0;let t=yield this.storage.member.get(),e=yield this.storage.lastCallback.get(),n=yield this.storage.lastCallbackTry.get();if(!t)return this.consoleSvc.error("member object not found in executeCallback"),yield this.onStartup(),void(this.isExecutingCallback=!1);const i=new Date,o=i.getTime(),r=I.getStartOfDayMillis(i);if(!e||e.memberID!==t.id||e.timestamp<r){if((!n||n.memberID!==t.id||n.timestamp<r)&&(this.dailyCallbackCount=0),this.dailyCallbackCount>this.dailyCallbacksLimit)return this.exceptionHandler.handleError(new Error("executeCallback hits limit")),void(this.isExecutingCallback=!1);yield this.storage.lastCallbackTry.set(new tt(t.id,o)),this.dailyCallbackCount++;let e=yield this.apiSvc.executeCallback();e&&0==e.status?(yield this.storage.lastCallback.set(new tt(t.id,o)),this.consoleSvc.debug("executeCallback ok ",e)):(this.exceptionHandler.handleError(new Error("executeCallback failed: "+JSON.stringify(e))),this.consoleSvc.debug("executeCallback failed ",e))}this.isExecutingCallback=!1}}else yield this.reissue(et.FalsyIdOrHashBeforeCallback)})}verifyConfigs(t){return(0,h.mG)(this,void 0,void 0,function*(){if(t.data&&t.data.extension){let e=(t,e)=>(0,h.mG)(this,void 0,void 0,function*(){let n=(yield this.storage[t].get())!==e;return n&&void 0!==e&&(yield this.storage[t].set(e)),n});yield e("extId",t.data.extension.id),yield e("flags",t.data.extension.configs.flags),yield e("extHash",t.data.extension.hashes.extension),yield e("siteMapHash",t.data.extension.hashes.sitemap),yield e("merchantHash",t.data.extension.hashes.merchant),yield e("affiliateHash",t.data.extension.hashes.affiliate),this.config.updateConfiguration(Q.Flags,t.data.extension.configs.flags),t.data.extension.featuredMerchants&&this.config.updateConfiguration(Q.FeaturedMerchants,t.data.extension.featuredMerchants),this.config.updateConfiguration(Q.SiteMapHash,t.data.extension.hashes.sitemap),this.config.updateConfiguration(Q.MerchantHash,t.data.extension.hashes.merchant),this.config.updateConfiguration(Q.AffiliateHash,t.data.extension.hashes.affiliate),kt.t.configure({sessionId:String(t.data.extension.id)})}})}verifyMember(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=t.data.member;var n=yield this.updateLegacyMemberPreferences();if(n&&(e.preferences=n),e){let t=yield this.storage.member.get(),n=!t;if(t)for(var i in e)if(e[i]!==t[i]){n=!0;break}n&&(this._onAccountInfoChanged.next(e),(yield this.storage.extHash.get())&&(yield this.setUninstallUrl()),kt.t.configure({userId:String(e.id)})),yield this.goferSvc.updateGoferConfig(e.gofer),e.alert?yield this.storage.extensionAlert.set(e.alert):yield this.storage.extensionAlert.remove()}})}updateLegacyMemberPreferences(){return(0,h.mG)(this,void 0,void 0,function*(){let t=0,e=yield this.legacyExtensionSvc.getLegacyMemberPreference();return null!==e&&(t=(e&&e.isBalanceAlert?2:0)|(e&&e.isSurveyAlert?0:1),0!==t&&(yield this.apiSvc.updateMemberPrefs(t)),yield this.legacyExtensionSvc.renameLegacyMemberPreferences()),t})}processResponse(t){return(0,h.mG)(this,void 0,void 0,function*(){this.consoleSvc.debug("API Response:",t),t&&void 0!==t.status&&(t.status>0?this.consoleSvc.error("Error processing response:"+t.status):(yield this.verifyMember(t),yield this.verifyConfigs(t)))})}reissue(t){return(0,h.mG)(this,void 0,void 0,function*(){if(!this.isReissuing){this.isReissuing=!0;let e=yield this.legacyExtensionSvc.getLegacyId();if(null===e){let t=yield this.apiSvc.executeReissueId();yield this.processResponse(t)}else{let n=yield this.apiSvc.executeReissueId(e);n&&0==n.status?yield this.legacyExtensionSvc.renameLegacyId():(this.exceptionHandler.handleError(new Error(`executeReissueId failed when ${t}: ${JSON.stringify(n)}`)),this.consoleSvc.debug("executeReissueId failed ",n)),yield this.processResponse(n)}this.isReissuing=!1}})}setUninstallUrl(){return(0,h.mG)(this,void 0,void 0,function*(){try{let t=yield this.apiSvc.getUninstallUrl();this.browser.api.runtime.setUninstallURL(t)}catch(t){this.exceptionHandler.handleError(t)}finally{return}})}showTutorial(t){let e=screen.width/2-368,n=screen.height/2-285,i=`${this.config.installTutorialUrl}`;i+=`?btnId=${this.config.browser===_.firefox?"":this.browser.api.runtime.id}`,t&&(i+="&isNew=1"),this.browser.api.windows.create({url:i,left:e,top:n,width:736,height:570,type:"popup"})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Yt),o.LFG(Bt),o.LFG(Ht),o.LFG(zt),o.LFG(Wt),o.LFG(Ft),o.LFG($t),o.LFG(Qt),o.LFG(Dt),o.LFG(Jt),o.LFG(Vt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Xt=(()=>{class t{constructor(t,e,n,i,o){this.consoleSvc=t,this.apiSvc=e,this.storage=n,this.configSvc=i,this.lifecycle=o,this._onAffiliateNetworksChanged=new u.x,this._hash=null,this._initialized=!1,this.onAffiliateNetworksChanged=this._onAffiliateNetworksChanged.asObservable()}getHash(){return(0,h.mG)(this,void 0,void 0,function*(){return this._hash||(this._hash=yield this.storage.affiliateHash.get()),this._hash})}get initialized(){return this._initialized}init(){this.configSvc.onConfigurationChanged.subscribe(t=>{t.configuration===Q.AffiliateHash&&this.tryUpdateHash(t.value)}),this.fetch()}tryUpdateHash(t){this._hash!==t&&(this._hash=t,this.fetch())}fetch(){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.getHash();if(t&&""!==t){let e=yield this.apiSvc.fetchAffiliateNetworks(t);if(e)for(let t=e.length-1;t>=0;t--){const n=e[t];if(t>=e.length-2&&n.length>100&&n[0]==n[3]&&["SB","MP","SM"].indexOf(n.substring(1,3))>=0){this.networkMap=this.transformLegacyAffiliateData(n);break}}this._initialized=!0,this._onAffiliateNetworksChanged.next()}else this.consoleSvc.debug("No valid hash when fetch for affiliate service")})}checkForAffiliateRedirect(t){let e=new G(!1,!1);if(!t)return e;if(!this.networkMap)return this.lifecycle.getFreshConfigs(),e;try{e.isOwnRedirect=this.isOwnRedirect(t),this.networkMap&&(e=this.checkForAffiliateRedirectInNetworkMap(t,e))}catch(n){this.consoleSvc.error("Failed to check for affiliate redirect.",n)}return e}checkForAffiliateRedirectInNetworkMap(t,e){for(let n=0;n<t.stack.length;n++){const i=t.stack[n];for(const n in this.networkMap)if(this.networkMap.hasOwnProperty(n)){const o=this.networkMap[n];if(Array.isArray(o))for(const r of o)this.getDetails(t,n,i,r).isAffiliateRedirect&&(e.isAffiliateRedirect=!0);else this.getDetails(t,n,i,o).isAffiliateRedirect&&(e.isAffiliateRedirect=!0)}}return e}isOwnRedirect(t){const e=[this.configSvc.apiHost+B.DEFAULT_REDIRECT_ENDPOINT,this.configSvc.hostGoDomain+B.DEFAULT_REDIRECT_ENDPOINT,`${this.configSvc.apiHost}/?cmd=${B.DISCOVER_CLICK_COMMAND}`];return t.stack.some(t=>e.some(e=>0===t.indexOf(e)))}transformLegacyAffiliateData(t){if((t=t.trim()).length<200)return this.consoleSvc.debug("String is too short"),null;const e=t.split(t[0]),n=e.length;if(n<20)return this.consoleSvc.debug("Array is too short"),null;const i={};let o=null,r=null;const s=n-3;for(let l=2;l<s;l+=3){if(r=o?r:e[l],!r)return this.consoleSvc.debug("No domain for index "+l),null;o&&l--;let t={},n=e[l+1];if(o||"["!=n){if(o&&"]"==n){o=null,l--;continue}if(o&&","==n){if(n=e[1+ ++l],l>=s)break}else o?this.consoleSvc.debug("Bad element ("+n+") in array for index "+l):t=i[r]={}}else if(o=i[r]=[],n=e[1+ ++l],l>=s)break;if(o&&o.push(t),n){n.length>2&&"/"==n[0]&&"/"==n[n.length-1]&&(n=n.substring(1,n.length-1));try{t.regex=new RegExp(n)}catch(a){}}const d=e[l+2];if(d)if(/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/.test(t.host))t.host=d;else try{t.hostURLRegex=new RegExp(d)}catch(c){t.host=d}}return i["bestbuy.com"]&&(i["bestbuy.com"].hostURLRegex="bestbuy[.]com[/]([?]ref=)|([?].+&ref=)",delete i["bestbuy.com"].host),i}getDetails(t,e,n,i){let o=!1,r=n.includes(e)&&(!i.host||n.includes(i.host));return r&&(o=i.regex?n.search(new RegExp(i.regex))>0:this.isOwnRedirect(t),!o&&i.hostURLRegex&&n.search(new RegExp(i.hostURLRegex))<=0&&(r=!1)),new G(r,o)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ft),o.LFG(Bt),o.LFG($t),o.LFG(Dt),o.LFG(Kt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),te=(()=>{class t{constructor(){}getLocation(t){let e=null;switch(t){case Ot.CA:e=new St(t,"&#36;","CAD","dollar");break;case Ot.IE:case Ot.UK:e=new St(t,"&pound;","GBP","pound");break;case Ot.AU:e=new St(t,"&#36;","AUD","dollar");break;case Ot.IN:e=new St(t,"&#8377;","INR","rupee");break;case Ot.DE:case Ot.FR:case Ot.ES:e=new St(t,"&euro;","EUR","euro");break;case Ot.US:default:e=new St(t,"&#36;","USD","dollar")}return e}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ee=(()=>{class t{constructor(t,e,n,i,o,r,s){this.consoleSvc=t,this.apiSvc=e,this.storage=n,this.exceptionHandler=i,this.config=o,this.browser=r,this.locations=s,this.filters=[],this._onMerchantListChanged=new u.x,this._hash=null,this._initialized=!1,this.onMerchantListChanged=this._onMerchantListChanged.asObservable()}getHash(){return(0,h.mG)(this,void 0,void 0,function*(){return this._hash||(this._hash=yield this.storage.merchantHash.get()),this._hash})}get initialized(){return this._initialized}init(){this.config.subscribeConfigChange(Q.MerchantHash,t=>{this.tryUpdateHash(t)}),this.config.subscribeConfigChange(Q.FeaturedMerchants,t=>{this.parseFeaturedMerchants(t)}),this.fetch()}tryUpdateHash(t){this._hash!==t&&(this._hash=t,this.storage.merchantHash.set(t),this.fetch())}fetch(){return(0,h.mG)(this,void 0,void 0,function*(){try{const t=yield this.getHash();if(t&&""!==t){const e=yield this.storage.member.get();this.clearDiscoverOfferFilters(),this.merchantMap=yield this.apiSvc.fetchMerchants(t,e?e.location:Ot.US),this.merchantMapKeys=Array.from(this.merchantMap.keys()),this.merchantMapValues=Array.from(this.merchantMap.values()),this._initialized=!0,this._onMerchantListChanged.next()}else this.consoleSvc.debug("No valid hash when fetch for merchant service")}catch(t){this.exceptionHandler.handleError(t)}})}checkFilters(t){let e=!0;for(let n=0;n<this.filters.length&&(e=this.filters[n].check(t),e);n++);return e}validateMeta(t,e){let n=function(t,e){return e.filter(e=>void 0===t[e])},i=n(t,["id","type"]);return i.length?(this.consoleSvc.debug(`Prop(s) missing from merchant meta for ${e.toString()}:`,i),!1):(i=n(t,["loc","reward"]),i.length&&t.type!==v.Discover&&this.consoleSvc.debug(`Prop(s) missing from merchant meta for ${e.toString()}:`,i),!0)}matchKey(t,e){let n=null,i=this.merchantMap.get(t);if(i){let t=Object.keys(i).filter(t=>t.startsWith("/"));if(t.length)for(let o of t)if(e.path().includes(o)&&this.validateMeta(i[o],e)){n=i[o];break}!n&&this.validateMeta(i,e)&&(n=i)}return n}shouldShowSERP(t){return!(!(t&&t.reward&&t.reward.amount&&0!==t.reward.amount&&0!==t.type)||t.noSERP)}matchMerchantUrl(t){if(!t)return null;if(!this.merchantMap)return this.fetch(),null;let e=null,n=new g(t.toLowerCase());return this.merchantMapKeys.includes(n.hostname())&&(e=this.matchKey(n.hostname(),n)),!e&&this.merchantMapKeys.includes(n.domain())&&(e=this.matchKey(n.domain(),n)),e&&this.consoleSvc.debug("Matched MID:",e.id),e&&this.checkFilters(e)?e:null}fetchMerchantByMeta(t,e){return(0,h.mG)(this,void 0,void 0,function*(){if(t){let e=yield this.apiSvc.fetchMerchantJson(t.id);return new F(e,t)}return this.consoleSvc.debug("No valid merchant meta"),null})}getMerchantMeta(t){return this.merchantMapValues.find(e=>e.id===t)}fetchMerchantById(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n=this.getMerchantMeta(t);return n?yield this.fetchMerchantByMeta(n,e):null})}parseFeaturedMerchants(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=t.split(",").map(t=>parseInt(t));yield this.storage.featuredMerchants.set(e)})}constructRewardString(t){var e;let n="";if(null===(e=null==t?void 0:t.reward)||void 0===e?void 0:e.amount){const e=t.reward,i=`reward_string_${e.isFlat?"flat":"variable"}${e.showUpTo?"_up_to":""}`,o=this.constructRewardStringSubstitutions(t.clientId,t.locationId,e,t.isShort);this.consoleSvc.info("Reward string params:",{messageName:i,substitutions:o}),n=this.browser.getLocalizedMessage(i,o)}return n}constructRewardStringSubstitutions(t,e,n,i){let o=[];const r=this.locations.getLocation(e),s=n.amount.toString(),a=!n.isFlat;switch(t){case y.ibd:case y.tada:case y.upm:n.isFlat&&o.push(r.currencySymbol),o.push(a?n.amount.toString():$.getCashBack(n.amount));break;case y.sb:o.push(s);break;case y.mp:const t=n.amount>1;o.push(s),o.push(n.showUpTo||i?t?"PTS":"PT":t?"Points":"Point"),a&&o.push(n.showUpTo?r.currencySymbol:r.currencyName)}return o}constructActivateString(t){let e,n;const i=this.constructRewardString(t);return i&&(n=t.activated?"somethingActivated":t.reward.showUpTo?"getSomethingWithUpTo":"getSomething",e=this.browser.getLocalizedMessage(n,i)),e}constructStorePageUrl(t){let e=null;switch(this.config.client){case y.mp:case y.upm:e=`${this.config.hostDomain}/shop-by-brand/${t.urlSlug}`;break;case y.tada:e=`${this.config.hostDomain}/${t.urlSlug}-coupons.html`;break;case y.sb:e=`${this.config.hostDomain}/shop/store/${t.id}`}return e}addFilter(t){this.filters.push(t)}clearDiscoverOfferFilters(){this.filters=this.filters.filter(t=>!(t instanceof ct))}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ft),o.LFG(Bt),o.LFG($t),o.LFG(zt),o.LFG(Dt),o.LFG(Ht),o.LFG(te))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ne=(()=>{class t{constructor(t,e,n,i,o,r,s){this.gofer=t,this.config=e,this.apiSvc=n,this.storageSvc=i,this.exceptions=o,this.lifecycleEvents=r,this.merchants=s,this._member=new S,this._surveysAdded=new u.x,this.surveysAdded=this._surveysAdded.asObservable(),this._promoCodeAdded=new u.x,this.promoCodeAdded=this._promoCodeAdded.asObservable(),this.isTester=!1,this.lifecycleEvents.onAccountInfoChanged.subscribe(t=>(0,h.mG)(this,void 0,void 0,function*(){this._member&&t.id===this._member.id||(this.merchants.clearDiscoverOfferFilters(),this._member&&(this._member.surveys=[])),yield this.setAndStoreMember(t),yield this.tryProcessSurveys(t.surveys),yield this.tryProcessPromoCode(t.promoCode),yield this.tryPostReferral()})),this.gofer.survey.subscribe(t=>(0,h.mG)(this,void 0,void 0,function*(){let e=t.msg;yield this.tryProcessSurveys([e])})),this.gofer.promoCode.subscribe(t=>(0,h.mG)(this,void 0,void 0,function*(){let e=t.msg;yield this.tryProcessPromoCode(e)}))}get member(){return this._member}get isLoggedIn(){return!(!this._member||!this._member.id)}tryPostReferral(){return(0,h.mG)(this,void 0,void 0,function*(){if(!this.config.isFlagEnabled(M.MKT_REFERRALS))return;let t=yield this.storageSvc.referral.get();if(t){let e=yield this.apiSvc.postReferralData(t);yield this.storageSvc.referral.remove(),e!==b.OK&&this.exceptions.handleError(new Error(`Unexpected API response for referral post: ${JSON.stringify(t)}`))}})}tryProcessSurveys(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=I.getSeconds();this._member.surveys||(this._member.surveys=[]),this.config.isFlagEnabled(M.ANSWER)&&t&&t.length&&(t.forEach(t=>{t.ts=e,this._member.surveys=this._member.surveys.filter(e=>t.prjId!=e.prjId),this._member.surveys.push(t)}),this._surveysAdded.next(t)),this._member.surveys=this._member.surveys.filter(t=>e<t.ts+t.expires),yield this.storeMember()})}tryProcessPromoCode(t){return(0,h.mG)(this,void 0,void 0,function*(){this.config.isFlagEnabled(M.MKT_PROMO_CODES)&&t&&(t.message||t.url)&&(t.ts=I.getSeconds(),this._member.promoCode=t,yield this.storeMember(),this._promoCodeAdded.next(t))})}init(){return(0,h.mG)(this,void 0,void 0,function*(){this._member=yield this.storageSvc.member.get()})}storeMember(){return(0,h.mG)(this,void 0,void 0,function*(){yield this.storageSvc.member.set(this._member)})}setAndStoreMember(t){return(0,h.mG)(this,void 0,void 0,function*(){this._member=t,yield this.storeMember()})}processAccountResponse(t){return(0,h.mG)(this,void 0,void 0,function*(){t.data&&t.data.member&&(yield this.lifecycleEvents.getFreshConfigs())})}login(t,e){return(0,h.mG)(this,void 0,void 0,function*(){this.lifecycleEvents.isUserAuthenticating=!0;let n=yield this.apiSvc.executeLogin(t,e);return yield this.processAccountResponse(n),this.lifecycleEvents.isUserAuthenticating=!1,n})}register(t,e){return(0,h.mG)(this,void 0,void 0,function*(){this.lifecycleEvents.isUserAuthenticating=!0;let n=yield this.apiSvc.executeRegister(t,e);return yield this.processAccountResponse(n),this.lifecycleEvents.isUserAuthenticating=!1,n})}sendPasswordReminder(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.apiSvc.sendPasswordReminder(t)})}refreshBalance(){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.apiSvc.getAccountBalance();return t.data?(this._member.balance=t.data.balance,this._member.lifetimeEarnings=t.data.lifetimeEarnings,yield this.storeMember()):this.exceptions.handleError(new Error(`Failed to get account balance for member ${this._member.id}`)),t.data||null})}clearMember(){return(0,h.mG)(this,void 0,void 0,function*(){yield this.storageSvc.member.remove(),this._member=null})}updateMemberPref(t){return(0,h.mG)(this,void 0,void 0,function*(){return this.togglePreference(t),yield this.apiSvc.updateMemberPrefs(this._member.preferences)})}getPreference(t){return(this._member.preferences&t)===t}togglePreference(t){this._member.preferences^=t}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Wt),o.LFG(Dt),o.LFG(Bt),o.LFG($t),o.LFG(zt),o.LFG(Kt),o.LFG(ee))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ie=(()=>{class t{constructor(t,e){this.consoleSvc=t,this.configService=e}addToNewRequestStack(t,e){t.stack.push(e)}clientRequestCompleted(t,e){this.setClientRequestByUrl(t,e),this.tryMergeRequests(t,e.url)}serverRequestCompleted(t,e){this.setServerRequestByUrl(t,e),this.tryMergeRequests(t,e.url)}displayStackInTable(t){this.consoleSvc.table(t.stack)}isClientRedirectAndNotUserInitiated(t,e){return e.transitionQualifiers.indexOf("from_address_bar")>-1&&this.consoleSvc.debug("Previous client request from Address Bar redirect.  url:",e.url),e.transitionQualifiers.indexOf("client_redirect")>-1&&!0!==t.userClicked}spliceStackAtPreviousRequest(t){if(void 0!==t.previousClientRequest){const e=t.stack.findIndex(e=>e===t.previousClientRequest.url);t.stack.splice(0,e+1)}}tryMergeRequests(t,e){const n=this.getClientRequestByUrl(t,e),i=this.getServerRequestByUrl(t,e);n&&i&&(-1!==n.transitionQualifiers.indexOf("forward_back")&&(t.userClicked=!0),this.isClientRedirectAndNotUserInitiated(t,n)||this.isHostDomainInitiator(t)||this.spliceStackAtPreviousRequest(t),this.addToNewRequestStack(t,i.url),t.previousClientRequest=n,t.RequestsFromServerAndClient.client=[],t.RequestsFromServerAndClient.server=[],t.userClicked=!1,t.initiator=null)}isHostDomainInitiator(t){return(null==t?void 0:t.initiator)===this.configService.hostDomain}getClientRequestByUrl(t,e){return t.RequestsFromServerAndClient.client[e]||null}getServerRequestByUrl(t,e){return t.RequestsFromServerAndClient.server[e]||null}setClientRequestByUrl(t,e){t.RequestsFromServerAndClient.client[e.url]=e}setServerRequestByUrl(t,e){t.RequestsFromServerAndClient.server[e.url]=e}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ft),o.LFG(Dt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),oe=(()=>{class t{constructor(t,e,n,i,o,r,s,a,c,l,d,h,g,p){this.consoleSvc=t,this.apiSvc=e,this.configSvc=n,this.memberSvc=i,this.browser=o,this.storage=r,this.networkSvc=s,this.merchantSvc=a,this.exceptionHandler=c,this.affiliateNetworkSvc=l,this.lifecycleEvents=d,this.storageSvc=h,this.browserEvents=g,this.redirectStackSvc=p,this.tabs=new Map,this.interruptedRequests=[],this.silentTabMap=new Map,this._tabNavComplete=new u.x,this.tabNavComplete=this._tabNavComplete.asObservable(),this._tabInitialized=new u.x,this.tabInitialized=this._tabInitialized.asObservable()}getTabs(){return Array.from(this.tabs.values())}init(){this.merchantSvc.onMerchantListChanged.subscribe(()=>{this.initializeTabs()}),this.affiliateNetworkSvc.onAffiliateNetworksChanged.subscribe(()=>{this.initializeTabs()}),this.browserEvents.onTabCreated.subscribe(t=>{this.onTabCreated(t)}),this.browserEvents.onTabRemoved.subscribe(t=>{this.onTabRemoved(t)}),this.browserEvents.onTabUpdated.subscribe(({tabId:t,changeInfo:e,tab:n})=>{this.onTabUpdated(t,e,n)}),this.browserEvents.onBeforeWebRequest.subscribe(t=>{this.onBeforeWebRequest(t)}),this.browserEvents.onBeforeWebRedirect.subscribe(t=>{this.onBeforeWebRedirect(t)}),this.browserEvents.onWebRequestCompleted.subscribe(t=>{this.onWebRequestCompleted(t)}),this.browserEvents.onWebNavigationCommitted.subscribe(t=>{this.onWebNavigationCommitted(t)}),this.browserEvents.onWebNavigationDOMContentLoaded.subscribe(t=>{this.onWebNavigationDOMContentLoaded(t)}),this.lifecycleEvents.onAccountInfoChanged.subscribe(()=>(0,h.mG)(this,void 0,void 0,function*(){const t=Array.from(this.tabs);for(let e=0;e<t.length;e++);})),this.lifecycleEvents.onInstalled.subscribe(t=>(0,h.mG)(this,void 0,void 0,function*(){let e=t.data.extension.configs,n=e?e.postInstallUrl:null;n&&this.openGoTab(n),this.configSvc.client!==y.sb||(yield this.storage.tutorialViewed.get())||this.lifecycleEvents.showTutorial(!0)})),this.initializeTabs()}initializeTabs(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield this.getAllTabs();for(let e=0;e<t.length;e++){const n=t[e],i=yield this.addTabState(n);this._tabInitialized.next(i)}this.consoleSvc.info("Tabs:",this.tabs)})}addTabState(t){return(0,h.mG)(this,void 0,void 0,function*(){const e=new H(t.windowId,t.id);if(e.url=t.url||t.pendingUrl,e.url){if(this.tabs.set(t.id,e),this.merchantSvc.initialized){const t=this.merchantSvc.matchMerchantUrl(e.url);t&&t.type>v.Unsupported&&(yield this.checkTabMerchantState(e,t))}if(t.openerTabId){const n=this.tabs.get(t.openerTabId);this.shouldInheritFromOpenerTab(e,n)&&(e.merchantState.activationState=n.merchantState.activationState||Z.NotActive,this.recordMerchantSessionActivationStateChange(e),e.merchantState.session.logData.parentSessionID=n.merchantState.session.logData.merchantSessionID)}return this.consoleSvc.debug("Added tab "+t.id+":",this.tabs),e}})}updateWindow(t,e){return(0,h.mG)(this,void 0,void 0,function*(){yield this.browser.callbackDecorator("windows.update",this.browser.api.windows.update,[t,e])})}updateTab(t,e){return(0,h.mG)(this,void 0,void 0,function*(){yield this.browser.callbackDecorator("tabs.update",this.browser.api.tabs.update,[t,e])})}removeTab(t){this.tabs.delete(t),this.consoleSvc.debug("Removed tab:",this.tabs)}queryTabs(t,e){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.browser.callbackDecorator(t,this.browser.api.tabs.query,e,t=>t)})}getAllTabs(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.queryTabs("tabs.query all",[{}])})}getAllTabStates(){return Array.from(this.tabs.values())}getAllHostTabs(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.queryTabs("tabs.query host",[{url:`${this.configSvc.hostDomain}/*`}])})}getTabById(t){return(0,h.mG)(this,void 0,void 0,function*(){const e=(yield this.getAllTabs()).find(e=>e.id===t);if(!e)throw`No real tab with tabId ${t}`;return e})}getOrAddTabState(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=this.getTabState(t);if(!e)try{const n=yield this.getTabById(t);e=yield this.addTabState(n)}catch(n){this.consoleSvc.debug("Invalid tab id to get:",t)}return e})}getTabState(t){let e=null;return this.tabs.has(t)&&(e=this.tabs.get(t)),e}getActiveTabState(){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.queryTabs("tabs.query active",[{active:!0,lastFocusedWindow:!0,windowType:"normal"}]);if(1===t.length)return this.getTabState(t[0].id);this.consoleSvc.error("Unexpected active tab query results:",t)})}getTabActivationState(t){if(!(t&&t.merchantState&&t.merchantState.merchant&&t.redirectDetails))return null;let e=t.redirectDetails.isAffiliateRedirect,n=t.redirectDetails.isOwnRedirect;return this.shouldStandDown(t.redirectDetails)||this.shouldStandDownCustomEbay(t)?Z.StandingDown:n&&(e||t.merchantState.merchant.type===v.Discover||this.isEbayRedirect(t))?Z.Activated:t.merchantState.activationState||Z.NotActive}setTabActivationDismissed(t){const e=this.getTabState(t);e&&e.merchantState&&e.merchantState.injectionState&&(e.merchantState.injectionState.activationDismissed=!0)}setTabActivationInjected(t){const e=this.getTabState(t);e&&e.merchantState&&e.merchantState.injectionState&&(e.merchantState.injectionState.activationInjected=!0)}setTabActivationConfirmed(t){const e=this.getTabState(t);e&&e.merchantState&&e.merchantState.injectionState&&(e.merchantState.injectionState.activationConfirmed=!0)}setTabShopperMarketingInjected(t){const e=this.getTabState(t);e&&e.merchantState&&e.merchantState.injectionState&&(e.merchantState.injectionState.shopperMarketingInjected=!0)}navigate(t,e){return(0,h.mG)(this,void 0,void 0,function*(){try{yield this.updateTab(e.tabId,{url:t})}catch(n){this.consoleSvc.error("Failed to navigate:",n)}})}openNewTab(t,e){return this.browser.callbackDecorator("tabs.create",this.browser.api.tabs.create,[{url:t,active:e}],t=>this.tabs.get(t.id))}openSiteTab(t){this.openNewTab(`${window.__hostDomain}/${t||""}`,!0)}openGoTab(t){this.openNewTab(`${this.configSvc.hostGoDomain}${t}`,!0)}openProdegeTab(t){this.openNewTab(`https://www.prodege.com/${t||""}`,!0)}closeTab(t){return(0,h.mG)(this,void 0,void 0,function*(){return new Promise(e=>{this.browser.api.tabs.remove(t,()=>{setTimeout(()=>{e()},200)})})})}onTabCreated(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.addTabState(t)})}onTabRemoved(t){let e=this.getTabState(t);e&&(e.previousMerchantState&&(e.merchantState=e.previousMerchantState),e.merchantState&&e.merchantState.session&&e.merchantState.session.logData&&!this.silentTabMap.has(t)&&this.postMerchantSessionLog(e.merchantState.session),this.settingsTab&&this.settingsTab.tab.id===t&&(this.settingsTab=null)),this.removeTab(t)}onTabReplaced(t,e){const n=this.tabs.get(e);this.tabs.set(t,n),this.removeTab(e),this.consoleSvc.debug("Replaced tab:",this.tabs)}resetTabMerchantState(t,e){e&&t.merchantState&&(t.previousMerchantState=Rt()(t.merchantState),t.previousMerchantState.expiry=I.getMillisPlus("seconds",15)),t.merchantState=null}setTabMerchant(t,e){return(0,h.mG)(this,void 0,void 0,function*(){const n=yield this.merchantSvc.fetchMerchantByMeta(e,null);return t.merchantState=new nt(n),n})}setTabMerchantState(t,e){return(0,h.mG)(this,void 0,void 0,function*(){if(!t.isSettingMerchant){if(t.isSettingMerchant=!0,this.shouldRestorePreviousTabState(t,e))this.consoleSvc.debug("Restoring tab merchant state for tab: ",JSON.parse(JSON.stringify(t))),t.merchantState=Rt()(t.previousMerchantState),t.merchantState.expiry=I.getMillisPlus("minutes",15),t.previousMerchantState=null;else{this.consoleSvc.debug("Setting tab merchant state for tab: ",JSON.parse(JSON.stringify(t))),t.previousMerchantState&&t.previousMerchantState.session&&t.previousMerchantState.session.logData&&(yield this.postMerchantSessionLog(t.previousMerchantState.session),t.previousMerchantState=null),t.shouldAnimateIcon=!0,t.merchantState&&t.merchantState.session&&t.merchantState.session.logData&&(yield this.postMerchantSessionLog(t.merchantState.session)),this.resetTabMerchantState(t),e.type===v.Discover?yield this.setTabDiscoverOffer(t,e):yield this.setTabMerchant(t,e);const n=yield this.storage.extId.get();t.merchantState.session=new K(n,this.memberSvc.member.id,e)}t.isSettingMerchant=!1,this.consoleSvc.debug("Finished setting tab merchant state for tab: ",JSON.parse(JSON.stringify(t)))}return t.merchantState.merchant})}postMerchantSessionLog(t){return(0,h.mG)(this,void 0,void 0,function*(){t.logData.merchantActivationType===v.Discover&&t.logData.merchantID>0&&(t.logData.merchantID=-t.logData.merchantID);try{t&&t.finalize&&t.finalize(),yield this.apiSvc.postMerchantSessionLog(t.logData)}catch(e){this.exceptionHandler.handleError(new Error(`Merchant session failed to post: ${t}`))}finally{t=null}})}onBeforeWebRedirect(t){return(0,h.mG)(this,void 0,void 0,function*(){const e=yield this.getOrAddTabState(t.tabId);e&&(e&&!e.redirectStack&&(e.redirectStack=new U(t.requestId,t.initiator)),this.redirectStackSvc.addToNewRequestStack(e.redirectStack,t.url))})}onBeforeWebRequest(t){return(0,h.mG)(this,void 0,void 0,function*(){const e=yield this.getOrAddTabState(t.tabId);if(!e)return;e.url=t.url,e.shouldAnimateIcon=!1,e&&!e.redirectStack?e.redirectStack=new U(t.requestId,t.initiator):e&&t.initiator&&(e.redirectStack.initiator=t.initiator);const n=this.merchantSvc.matchMerchantUrl(e.url);if(n&&n.type==v.AutoRedirect){let i=-1;if(e.merchantState&&e.merchantState.merchant.id&&(i=e.merchantState.merchant.id),yield this.checkTabMerchantState(e,n),!e.merchantState)return;e.merchantState&&e.merchantState.merchant.id&&i&&e.merchantState.merchant.id!==i&&this.redirectStackSvc.spliceStackAtPreviousRequest(e.redirectStack),e.redirectDetails=this.affiliateNetworkSvc.checkForAffiliateRedirect(e.redirectStack),this.shouldStandDown(e.redirectDetails)||this.shouldStandDownCustomEbay(e)?(e.merchantState.activationState=Z.StandingDown,e.shouldAnimateIcon=!1):e.merchantState.activationState=e.redirectDetails&&e.redirectDetails.isOwnRedirect&&e.merchantState.activationState!==Z.Activated?Z.Activating:e.merchantState.activationState||Z.NotActive,this.recordMerchantSessionActivationStateChange(e),this.shouldAutoRedirect(e)&&(this.consoleSvc.debug("Auto-redirecting, ignore completion of requestId: "+t.requestId),this.interruptedRequests.push(t.requestId),this.activate(e,e.merchantState.merchant.id,C.Merchant,X.AutoRedirect,at.CurrentTab))}})}onWebRequestCompleted(t){return(0,h.mG)(this,void 0,void 0,function*(){if(this.interruptedRequests.includes(t.requestId))this.consoleSvc.debug("Ignoring interrupted request: "+t.requestId),this.interruptedRequests.splice(this.interruptedRequests.indexOf(t.requestId),1);else{this.consoleSvc.debug("Evaluating webRequestComplete: ",JSON.parse(JSON.stringify(t)));const e=this.tabs.get(t.tabId);e&&e.redirectStack&&this.redirectStackSvc.serverRequestCompleted(e.redirectStack,t)}})}onWebNavigationCommitted(t){return(0,h.mG)(this,void 0,void 0,function*(){if(this.shouldEvaluateWebNavigationCommitted(t)){this.lifecycleEvents.executeCallback();const e=this.tabs.get(t.tabId);e&&(e.onWebNavigationDOMContentLoadedComplete=!1,e.hasTriedInjection=!1,e.redirectStack&&this.redirectStackSvc.clientRequestCompleted(e.redirectStack,t))}})}onWebNavigationDOMContentLoaded(t){return(0,h.mG)(this,void 0,void 0,function*(){if(0===t.frameId){const e=this.tabs.get(t.tabId);e&&(e.onWebNavigationDOMContentLoadedComplete=!0,e.redirectStack&&this.redirectStackSvc.displayStackInTable(e.redirectStack),yield this.completeTabNav(e,t.url,"onWebNavigationDOMContentLoaded"),this._tabNavComplete.next(e))}})}onTabUpdated(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){if(e.status&&"complete"===e.status){const e=this.tabs.get(t);e&&(!1===e.onWebNavigationDOMContentLoadedComplete&&(e.hasTriedInjection=!1,e.redirectStack&&this.redirectStackSvc.displayStackInTable(e.redirectStack),yield this.completeTabNav(e,n.url,"onTabUpdated"),this._tabNavComplete.next(e)),e.onWebNavigationDOMContentLoadedComplete=!1)}})}setTabDiscoverOffer(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n=yield this.apiSvc.checkOfferPlacement(e.id);if(n&&n.available){let i=yield this.apiSvc.fetchDiscoverPlacementJson(n.placementID),o=new rt(i,e,n);t.merchantState=new nt(o)}else{let n=new ct(e.id);this.merchantSvc.addFilter(n),t.merchantState.activationState=Z.StandingDown}})}checkTabMerchantState(t,e){return(0,h.mG)(this,void 0,void 0,function*(){this.shouldSetTabMerchantState(t,e)&&(this.consoleSvc.debug("setting tab merchantState for tab: "+JSON.stringify(t),t),yield this.setTabMerchantState(t,e)),this.shouldRefreshTabMerchantData(t)&&(this.consoleSvc.debug("refreshing merchant data for tab: "+JSON.stringify(t),t),e.type===v.Discover?yield this.setTabDiscoverOffer(t,e):yield this.setTabMerchant(t,e))})}completeTabNav(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){this.consoleSvc.debug("Completing tabNav to "+e+" from "+n+": ",JSON.parse(JSON.stringify(t))),t.url=e;const i=this.merchantSvc.matchMerchantUrl(t.url);if(i&&i.type>v.Unsupported?(yield this.checkTabMerchantState(t,i),t.redirectDetails=this.affiliateNetworkSvc.checkForAffiliateRedirect(t.redirectStack),t.merchantState.activationState=this.getTabActivationState(t),this.recordMerchantSessionActivationStateChange(t),t.merchantState.activationState!==Z.StandingDown&&i.type!==v.Unsupported||(t.shouldAnimateIcon=!1)):(t.previousMerchantState&&t.previousMerchantState.session&&t.previousMerchantState.session.logData&&(yield this.postMerchantSessionLog(t.previousMerchantState.session),t.previousMerchantState=null),t.shouldAnimateIcon=!1,this.resetTabMerchantState(t,!0)),this.silentTabMap.has(t.tabId)){this.consoleSvc.debug("Found silent tab for tabId:"+t.tabId);const e=this.getTabState(this.silentTabMap.get(t.tabId));this.shouldUpdateOpenerTabState(e,t)&&(this.consoleSvc.debug("Updating opener tab state for silent tab for tabId:"+t.tabId),this.consoleSvc.debug("Opener tab state before:",JSON.parse(JSON.stringify(e))),e.merchantState.activationState=t.merchantState.activationState,this.recordMerchantSessionActivationStateChange(e),this.consoleSvc.debug("Opener tab state after:",JSON.parse(JSON.stringify(e)))),this._tabNavComplete.next(e),this.consoleSvc.debug("_tabNavComplete.next broadcast (from silent tab): ",JSON.parse(JSON.stringify(e))),yield this.closeTab(t.tabId),this.silentTabMap.delete(t.tabId)}})}recordMerchantSessionActivationStateChange(t){t&&t.merchantState&&t.merchantState.session&&t.merchantState.session.logData?t.merchantState.session.tryAddActivationState(t.merchantState.activationState):this.consoleSvc.debug("No merchant session for tab: "+JSON.stringify(t),t)}shouldAutoRedirect(t){return t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.type===v.AutoRedirect&&!this.silentTabMap.has(t.tabId)&&t.merchantState.activationState===Z.NotActive&&(t.merchantState.merchant.deeplinkEnabled||this.urlIsHomePage(t.url))}shouldEvaluateWebNavigationCommitted(t){return"auto_subframe"!=t.transitionType}shouldInheritFromOpenerTab(t,e){return e.merchantState&&t.merchantState&&e.merchantState.merchant.id===t.merchantState.merchant.id}shouldRedirectInBackground(t,e,n){return n===at.Background||t&&t.isZeroPayout&&!t.affiliate&&![at.CurrentTab,at.SilentTab].includes(n)}shouldRedirectInSilentTab(t,e,n,i){if(i===at.SilentTab)return!0;if(!this.memberSvc.isLoggedIn&&this.configSvc.client===y.tada&&e&&e.type===v.AutoRedirect)return!1;let o=!(!e||!t||e.deeplinkEnabled||this.urlIsHomePage(t.url));return e.type!==v.Discover&&(n===C.Checkout||!this.memberSvc.isLoggedIn||t&&e&&(o||!!e&&e.isZeroPayout&&!!e.affiliate)&&![at.CurrentTab,at.Background].includes(i))}shouldRefreshTabMerchantData(t){return t.merchantState&&t.merchantState.merchant&&Date.now()>t.merchantState.expiry&&t.merchantState.activationState!==Z.Activating}shouldRestorePreviousTabState(t,e){return e&&t.previousMerchantState&&t.previousMerchantState.merchant&&t.previousMerchantState.merchant.id===e.id&&t.previousMerchantState.expiry&&Date.now()<t.previousMerchantState.expiry}shouldSetTabMerchantState(t,e){return e&&!t.isSettingMerchant&&(!t.merchantState||!t.merchantState.merchant||t.merchantState.merchant.id!==e.id)}shouldStandDown(t){return t.isAffiliateRedirect&&!t.isOwnRedirect}shouldStandDownCustomEbay(t){return this.isEbayRedirect(t)&&!t.redirectDetails.isOwnRedirect}isEbayRedirect(t){const e=new g(t.url),n=e.domain().startsWith("ebay."),i=e.hasQuery("mkevt")||e.hasQuery("mkcid")||e.hasQuery("campid");return n&&i}shouldUpdateOpenerTabState(t,e){return t&&t.merchantState&&t.merchantState.merchant&&e&&e.merchantState&&e.merchantState.merchant&&t.merchantState.merchant.id===e.merchantState.merchant.id}urlIsHomePage(t){let e=new g(t);return t&&"/"===e.path()}constructDiscoverUrl(t){let e=t.placement;return`${this.configSvc.apiHost}?cmd=${B.DISCOVER_CLICK_COMMAND}&mid=${this.memberSvc.member.id}&trkId=${e.trackingID}&placementID=${e.placementID}&offerID=${e.offerID}`}constructRedirectUrl(t,e,n,i){return(0,h.mG)(this,void 0,void 0,function*(){if(t.type===v.Discover)return this.constructDiscoverUrl(t);{n=n||X.Default;const o=e&&e.merchantState&&e.merchantState.session&&e.merchantState.session.logData&&e.merchantState.session.logData.merchantSessionID||"",r=this.configSvc.client,s=yield this.storage.extId.get(),a=this.browser.api.runtime.getManifest().version,c=t.deeplinkEnabled&&e?e.url:null,l=[y.sb,y.mp].includes(r)&&this.memberSvc.isLoggedIn&&null!==c&&!i&&!(this.configSvc.browser===_.firefox),d=r!==y.sb;let h;return h=d&&l?this.configSvc.hostDomain+"/jumppage":this.configSvc.apiHost+B.DEFAULT_REDIRECT_ENDPOINT,`${h}?merchant=${t.id}&page=${n}&extid=${s}&extv=${a}&msid=${o}`+(l?"&jump=1":"&drctLink=2")+(d&&l?`&brand=${t.urlSlug}`:"")+(c?`&dlink=${encodeURIComponent(c)}`:"")}})}activate(t,e,n,i,o=at.Default){return(0,h.mG)(this,void 0,void 0,function*(){if(!t.merchantState||t.merchantState.activationState===Z.Activating)return;t.merchantState.activationState=Z.Activating,this.recordMerchantSessionActivationStateChange(t);const r=t.merchantState.merchant||(yield this.merchantSvc.fetchMerchantById(e,null)),s=this.shouldRedirectInBackground(r,t.url,o),a=this.shouldRedirectInSilentTab(t,r,n,o),c=s||a,l=yield this.constructRedirectUrl(r,t,i,c);if(s){const e=yield this.networkSvc.getText(l);e&&this.isHTML(e)&&t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.id===r.id&&(t.merchantState.activationState=Z.Activated,this.recordMerchantSessionActivationStateChange(t),this._tabNavComplete.next(t))}else{let e=t;if(a){const n=yield this.openNewTab(void 0,!1);this.silentTabMap.set(n.tabId,t.tabId),e=n}yield this.navigate(l,e)}})}isHTML(t){const e=(new DOMParser).parseFromString(t,"text/html");return Array.from(e.body.childNodes).some(t=>1===t.nodeType)}resetCouponCoolDown(t){this.getTabState(t).merchantState.couponCoolDownExpiry=I.getMillisPlus("seconds",15)}verifyCurrentUrl(t){return(0,h.mG)(this,void 0,void 0,function*(){const e=yield this.getTabById(t.tabId);if(t.url!==e.url&&(this.consoleSvc.info("Current tab has an out of sync url. Update now."),t.url=e.url,this.merchantSvc.initialized)){const n=this.merchantSvc.matchMerchantUrl(e.url);n&&n.type>v.Unsupported&&(yield this.checkTabMerchantState(t,n))}})}updateUserClicked(t,e){const n=this.getTabState(t);n.redirectStack&&(n.redirectStack.userClicked=!0)}checkTabExists(t){return(0,h.mG)(this,void 0,void 0,function*(){return(yield this.queryTabs("checkTabExists",[{url:["http://*/*","https://*/*"]}])).some(e=>e.id===t)})}focusTab(t,e){return(0,h.mG)(this,void 0,void 0,function*(){e&&(yield this.updateWindow(e,{focused:!0})),yield this.updateTab(t,{active:!0})})}openSettings(){return(0,h.mG)(this,void 0,void 0,function*(){let t=!0;if(this.settingsTab)try{yield this.focusTab(this.settingsTab.tab.id,this.settingsTab.tab.windowId),t=!1}catch(e){}if(t){const t=yield this.getActiveTabState(),e=this.browser.api.runtime.getURL("index.html?page=settings"),n=yield this.openNewTab(e,!0);this.settingsTab={tab:{id:n.tabId,windowId:n.windowId},opener:{id:t.tabId,windowId:t.windowId}}}})}closeSettings(){return(0,h.mG)(this,void 0,void 0,function*(){this.settingsTab&&(yield this.closeTab(this.settingsTab.tab.id),yield this.focusTab(this.settingsTab.opener.id,this.settingsTab.opener.windowId),this.settingsTab=null)})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ft),o.LFG(Bt),o.LFG(Dt),o.LFG(ne),o.LFG(Ht),o.LFG($t),o.LFG(jt),o.LFG(ee),o.LFG(zt),o.LFG(Xt),o.LFG(Kt),o.LFG($t),o.LFG(Jt),o.LFG(ie))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),re=(()=>{class t{constructor(t,e){this.http=t,this.exceptionHandler=e}getFileText(t){return new Promise((e,n)=>{this.http.get(t,{responseType:"text"}).pipe((0,It.X)(B.HTTP_RETRIES)).subscribe(t=>e(t),t=>{this.exceptionHandler.handleError(t),n(t)})})}deserializeFileJson(t){return new Promise(e=>{this.getFileText(t).then(t=>{e(JSON.parse(t))})})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(s.eN),o.LFG(zt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),se=(()=>{class t{constructor(t,e,n,i,o,r,s,a,c,l,d,h){this.apiSvc=t,this.consoleSvc=e,this.tabSvc=n,this.configSvc=i,this.memberSvc=o,this.browser=r,this.merchantSvc=s,this.fileSystemSvc=a,this.storageSvc=c,this.browserEvents=l,this.network=d,this.locations=h,this.couponInjectionInitiated=!1,this.couponInjectionForceJSON=!1,this.couponInjectionForceLoadLocal=!1}init(){this.tabSvc.tabNavComplete.subscribe(t=>(0,h.mG)(this,void 0,void 0,function*(){if(t)try{this.tryInjectUserClickedListener(t),this.shouldTryInjectSlider(t)?this.tryInjectSlider(t):this.configSvc.isFlagEnabled(M.SHOP_SERP_INJECT)&&this.tryInjectSearch(t),yield this.dispatchPresentEvent(t)}catch(e){this.consoleSvc.error("Injection error ",e)}})),this.tabSvc.tabInitialized.subscribe(t=>(0,h.mG)(this,void 0,void 0,function*(){yield this.dispatchPresentEvent(t)})),this.browserEvents.onRuntimeInstalled.subscribe(()=>{this.injectInstallationEvent()}),this.browserEvents.onInstallTutorialLoaded.subscribe(t=>{0===t.frameId&&this.dispatchInstalledEvent(t.tabId)})}injectHostMessenger(t,e){return(0,h.mG)(this,void 0,void 0,function*(){const n=new O;n.client=this.configSvc.client,yield this.injectContent(t,e,n)})}dispatchInstalledEvent(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.injectHostMessenger(t,Pt.ExtInstalledMessenger)})}dispatchPresentEvent(t){return(0,h.mG)(this,void 0,void 0,function*(){if(t&&t.url)try{0===t.url.indexOf(this.configSvc.hostDomain)&&(yield this.injectHostMessenger(t.tabId,Pt.ExtPresentMessenger))}catch(e){this.consoleSvc.error("Broadcast extension present with error: ",e)}})}injectScriptFile(t,e,n=!1){return(0,h.mG)(this,void 0,void 0,function*(){yield this.inject(t,{file:e,allFrames:n})})}injectScript(t,e,n=!1){return(0,h.mG)(this,void 0,void 0,function*(){yield this.injectScriptFile(t,"browser-api-content.js"),yield this.inject(t,{code:e,allFrames:n})})}injectInstallationEvent(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield this.tabSvc.getAllHostTabs();if(t)for(let e=0;e<t.length;e++)this.dispatchInstalledEvent(t[e].id);else this.consoleSvc.debug("No host tab found",t)})}inject(t,e){return(0,h.mG)(this,void 0,void 0,function*(){if(yield this.tabSvc.checkTabExists(t))try{yield this.browser.callbackDecorator("tabs.executeScript",this.browser.api.tabs.executeScript,[t,e])}catch(n){this.consoleSvc.info("ContentInjectionSvc failed to inject:",n)}})}getSliderDataJson(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){const i=this.memberSvc.member.id;e.coupons&&e.coupons.forEach(t=>{t.description=t.description.trim()}),e.couponApplyEnabled=e.couponApplyEnabled&&this.configSvc.isFlagEnabled(M.SHOP_APPLY_COUPONS),e.storePageUrl=this.merchantSvc.constructStorePageUrl(e);const o=yield this.storageSvc.extId.get();let r="";t&&t.merchantState&&t.merchantState.session&&t.merchantState.session.logData&&(r=t.merchantState.session.logData.merchantSessionID);const s=yield this.storageSvc.extensionAlert.get(),a=t.merchantState.activationState===Z.Activated,[c,l]=yield this.getShopBonusUrlAndAmountIfShould(),d=this.locations.getLocation(e.loc);return{tabId:t.tabId,memberId:i,merchant:e,merchantSessionID:r,activated:a,activationConfirmed:t.merchantState.injectionState.activationConfirmed,urlType:n,extensionId:o,shopBonusUrl:c,shopBonusAmount:l,client:this.configSvc.client,memberIsTester:this.memberSvc.isTester,consoleLogLevel:this.consoleSvc.getLevel(),alert:s,location:d}})}getShopBonusUrlAndAmountIfShould(){return(0,h.mG)(this,void 0,void 0,function*(){let t=null,e=null,n=null,i=!1,o=!1;if((yield this.storageSvc.shopBonusLastShown.get())>=I.getStartOfDayMillis()&&(o=!0),!o&&this.memberSvc.member.shopPromo&&!this.memberSvc.member.shopPromo.activationRequired&&new Date(this.memberSvc.member.shopPromo.expirationDate).getTime()+864e5>Date.now()){n=this.locations.getLocation(this.memberSvc.member.location||Ot.US).currencySymbol;let o=this.memberSvc.member.shopPromo.bonus;e=o%10==0&&o%100!=0?o/100+"0":""+o/100,this.configSvc.client===y.sb?t=`${this.configSvc.hostDomain}/account/swagup`:this.configSvc.client===y.mp?(1750==o?e=10:(e=`${o} ${this.browser.getLocalizedMessage("points")}`,i=!0),t="https://help.mypoints.com/hc/en-us/articles/210708766-When-will-I-receive-my-10-Gift-Card-"):this.configSvc.client===y.tada&&(t="https://help.shopathome.com/hc/en-us/articles/360035150072")}return i?[t,e]:[t,$.formatCurrencyAmount(e,n)]})}generateInjectionId(t){let e="";const n=Pt[t];for(let i=0;i<n.length;i++){const t=n[i],o=t.toLowerCase();e+=o===t||0===i?o:`-${o}`}return e}injectContent(t,e,n,i){return(0,h.mG)(this,void 0,void 0,function*(){let o="{ extensionRuntimeId: params.extensionRuntimeId, data: params.data";const r=`injections/${this.generateInjectionId(e)}`,s=this.configSvc.client,a=y[s];i&&Object.keys(i).forEach(t=>{o+=`, ${t}: params.${t}`}),o+=" }",yield this.injectScriptFile(t,"vendor/sanitizer.js"),yield this.injectScriptFile(t,`${r}.js`);const c=this.browser.api.runtime.id,l=a.toUpperCase(),d=Pt[e],h=`pdg${l}${d}`,u=`Prdg${l}${d}`,g=`__browserApi.runtime.onMessage.addListener(function(params) {  (function() {    if (params.client === ${s}         && params.extensionRuntimeId === "${c}"         && params.msg === "${h}"         && params.data) {      if (typeof ${u} === 'undefined') {         window['${u}'] = new Prdg.${l}.${d}(${o});      }    }  })();});`,p=i&&!0===i.allFrames;yield this.injectScript(t,g,p);let m={msg:h,data:n,client:s,extensionRuntimeId:c};i&&(m=Object.assign(m,i)),this.browser.api.tabs.sendMessage(t,m)})}injectInteractableContent(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){let i;i=this.configSvc.client===y.upm?"@font-face { font-family: 'Century Gothic Pro'; src: url('/assets/fonts/century-gothic-pro.ttf'); }":yield this.fileSystemSvc.getFileText("/assets/css/open-sans.css"),i=this.parseInjectionFonts(i);let o=this.generateInjectionId(e);const r=`injections/${o}`,s=`${i}\r\n\r\n${yield this.fileSystemSvc.getFileText(`${r}.css`)}`,a=yield this.fileSystemSvc.getFileText(`${r}.html`);o=`${y[this.configSvc.client]}-${o}`,n.id&&(o+=`-${n.id}`);const c={css:s,html:a,injectionId:o};yield this.injectContent(t,e,n,c)})}parseInjectionFonts(t){let e=t.split("url('");for(let n=1;n<e.length;n++){let t=e[n];const i=t.indexOf("')"),o=t.substring(0,i),r=this.browser.api.runtime.getURL(o);e[n]=`url('${t.replace(o,r)}`}return e.join("")}injectSlider(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){const i=t.tabId;t.hasTriedInjection=!0,n.type=e,n.urlType===C.Checkout&&e===dt.Coupons&&n.merchant.hasMerchantScript?yield this.injectContent(i,Pt.CouponWorker,n):yield this.injectInteractableContent(i,Pt.Slider,n)})}injectRequestedContent(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){yield this.injectInteractableContent(e,t,n)})}injectShopperMarketingSlider(t,e){return(0,h.mG)(this,void 0,void 0,function*(){const n="assets/injections",i=`${n}/shm-slider`,o=yield this.fileSystemSvc.getFileText(`${n}/sliders.css`);yield this.injectScriptFile(t.tabId,"vendor/sanitizer.js"),yield this.injectScriptFile(t.tabId,`${i}/slider.js`),yield this.injectScript(t.tabId,`__browserApi.runtime.onMessage.addListener(function(params) {  (function() {    if (params.clientId === ${this.configSvc.client}         && params.extensionRuntimeId === "${this.browser.api.runtime.id}"         && params.msg === "pdgSlider"         && params.html && params.css && params.data) {      pdgSlider = new Prdg.SHMSlider(params.extensionRuntimeId, params.sliderId, params.type, params.html, params.css, params.data)    }  })();});`),this.browser.api.tabs.sendMessage(t.tabId,{clientId:this.configSvc.client,extensionRuntimeId:this.browser.api.runtime.id,msg:"pdgSlider",css:o,data:e,type:dt.SHM,sliderId:"sb-slider-container"})})}injectNotification(t,e){return(0,h.mG)(this,void 0,void 0,function*(){yield this.injectInteractableContent(t,Pt.Notification,e)})}tryInjectUserClickedListener(t){this.injectScript(t.tabId,`\n      var jsTabId = ${t.tabId}\n      var logMessage = { type: 0, value: {message:' logging mesages from tab ' + jsTabId, level:3} };\n      var userClickedMessage =      {type : ${m.UserClickedInPage}, value: {tabId:jsTabId, clientId:${this.configSvc.client}}};\n      var fn = window['__browserApi'].runtime.sendMessage;\n      var cb = function (response) {\n          res(response);\n      };        \n      document.documentElement.addEventListener('click', \n        function () {  \n         fn(userClickedMessage);    \n      });        \n     `)}tryInjectSlider(t){return(0,h.mG)(this,void 0,void 0,function*(){const e=this.getUrlType(t.url,t.merchantState.merchant),n=yield this.getSliderDataJson(t,t.merchantState.merchant,e);if(this.shouldInjectCouponsAtCheckout(t)){const e=yield this.initializeCouponInjectionCode(t.tabId,t.merchantState.merchant);t.merchantState.merchant.hasMerchantScript=!!e,"object"==typeof e&&(n.jsonMerchantDefinition=e),this.injectSlider(t,dt.Coupons,n)}else if(this.shouldInjectShopperMarketingSlider(t)){let e=yield this.apiSvc.checkShopperMarketingPlacement(t.merchantState.merchant.shopperMarketingID);if(!e||e.status!==b.OK||!e.data)return;let i=e.data;i&&i.rewardTotal>0&&i.url&&(n.shmReward=i.rewardTotal,n.shmOfferPage=i.url,this.injectShopperMarketingSlider(t,n))}else if(!this.shouldInjectPostPurchaseContent(t)){if(this.hasConfirmedActivation(t)||this.hasSeenActivationSlider(t)&&!t.merchantState.activationState&&!this.shouldShowActivationAtCheckoutNoCoupons(t))return;if(this.shouldTryActivationConfirmation(t)&&this.injectScript(t.tabId,`document.dispatchEvent(new CustomEvent('rewards-activated', { detail: { client: ${this.configSvc.client} } }))`),this.shouldInjectNonCheckoutCoupons(t))this.injectSlider(t,dt.Coupons,n);else{if(this.shouldNotInjectActivation(t,n))return;this.injectSlider(t,this.memberSvc.isLoggedIn?dt.Activation:dt.Coupons,n)}return}})}getUrlType(t,e,n){return t&&e?e.checkoutUrl&&t.match(new RegExp(e.checkoutUrl))?C.Checkout:e.postPurchaseUrl&&t.match(new RegExp(e.postPurchaseUrl))?C.PostPurchase:C.Merchant:t&&t.includes(n.domain)&&n.rx.test(t)?C.Serp:null}initializeCouponInjectionCode(t,e){return(0,h.mG)(this,void 0,void 0,function*(){if(!this.couponInjectionInitiated){yield this.injectVendorScripts(t),yield this.injectScriptFile(t,"coupon-scripts/coupon-injection.js"),yield this.injectGlobals(t);let n=yield this.fetchScripts("coupon-injection-json.min.json","jsonCouponMerchantScripts");const i=n.shared?n.shared[e.groupID]:null;let o=i?n[i]:n[e.groupID],r=o?JSON.parse(o):null;return r&&(r.enabled||void 0===r.enabled||this.couponInjectionForceJSON)?(["applyCoupon","removeCoupon","preCheckInitialElements","calculateTotal"].forEach(t=>{const e=r[t];"string"==typeof e&&(r[t]=JSON.parse(n.templates[e]))}),r):(n=yield this.fetchScripts("coupon-injection.min.json","couponMerchantScripts"),yield this.injectMerchantScript(n,t,e.groupID))}return!1})}injectVendorScripts(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.injectScriptFile(t,"vendor/jquery.js"),yield this.injectScriptFile(t,"vendor/sanitizer.js")})}fetchScripts(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n=null,i=yield this.storageSvc[e].get(),o=`coupon-scripts/${t}`;if(this.couponInjectionForceLoadLocal)n=yield this.fileSystemSvc.getFileText(o);else if(!i||i.expired)try{let i=`${this.configSvc.cdnHost}/json/extension/${t}?v=${this.apiSvc.cacheBuster}`;n=yield this.network.getText(i),yield this.storageSvc[e].setValue(n)}catch(r){n=i&&i.value?i.value:yield this.fileSystemSvc.getFileText(o)}else n=i.value;return n?JSON.parse(n):null})}injectGlobals(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.injectScript(t,'window["CouponWorkerBase"] = Prdg.CouponInjection.init;window["CouponInjection"] = {WORKER_TYPE_API: Prdg.CouponInjection.CouponWorkerTypes.api,WORKER_TYPE_ASYNC: Prdg.CouponInjection.CouponWorkerTypes.async,WORKER_TYPE_POSTBACK: Prdg.CouponInjection.CouponWorkerTypes.postback,WORKER_TYPE_JSON: Prdg.CouponInjection.CouponWorkerTypes.json};')})}injectMerchantScript(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){let i=t[n];if(!i){const e=t.shared[n];e&&(i=t[e])}return!!i&&(yield this.injectScript(e,i),!0)})}tryInjectSearch(t){return(0,h.mG)(this,void 0,void 0,function*(){for(const e of Y.SEARCH_PAGE_INJECTION_SETTINGS)if(this.getUrlType(t.url,null,e)){e.client=this.configSvc.client;const n="swagbucks.com"===e.domain||"mypoints.com"===e.domain;yield this.injectContent(t.tabId,Pt.SerpInjection,e,{allFrames:n})}})}hasConfirmedActivation(t){return t&&t.merchantState&&t.merchantState.activationState===Z.Activated&&t.merchantState.injectionState&&t.merchantState.injectionState.activationConfirmed}hasMerchantCoupons(t){return t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.coupons&&t.merchantState.merchant.coupons.length>0}hasSeenActivationSlider(t){return t&&t.merchantState&&t.merchantState.injectionState&&(t.merchantState.injectionState.activationDismissed||t.merchantState.injectionState.activationInjected)}hasSeenShopperMarketingSlider(t){return t&&t.merchantState&&t.merchantState.injectionState&&t.merchantState.injectionState.shopperMarketingInjected}isShopperMarketingUrl(t,e){return e&&e.shopperMarketingUrl&&t&&t.match(new RegExp(e.shopperMarketingUrl))}shouldShowActivationAtCheckoutNoCoupons(t){return t.merchantState&&t.merchantState.merchant.checkoutUrl&&t.url&&this.getUrlType(t.url,t.merchantState.merchant)===C.Checkout}shouldInjectCouponsAtCheckout(t){return this.logShouldInjectCouponsAtCheckout(t),t&&this.hasMerchantCoupons(t)&&t.merchantState&&t.merchantState.merchant.checkoutUrl&&t.url&&this.getUrlType(t.url,t.merchantState.merchant)===C.Checkout&&!t.hasTriedInjection&&(!t.merchantState.couponCoolDownExpiry||t.merchantState.couponCoolDownExpiry&&Date.now()>t.merchantState.couponCoolDownExpiry)}logShouldInjectCouponsAtCheckout(t){this.consoleSvc.debug("shouldInjectCouponsAtCheckout() : 0 All 6 must be true."),this.consoleSvc.debug(`shouldInjectCouponsAtCheckout() : 1 this.hasMerchantCoupons(tab): ${this.hasMerchantCoupons(t)}`),this.consoleSvc.debug(`shouldInjectCouponsAtCheckout() : 2 tab.merchantState.merchant.checkoutUrl: ${!!this.hasMerchantCoupons(t)} :`,t.merchantState.merchant.checkoutUrl),this.consoleSvc.debug(`shouldInjectCouponsAtCheckout() : 3 tab.url: ${!!t.url} :`,t.url),this.consoleSvc.debug(`shouldInjectCouponsAtCheckout() : 4 this.getUrlType(tab.url, tab.merchantState.merchant) === UrlTypes.Checkout: ${this.getUrlType(t.url,t.merchantState.merchant)===C.Checkout}`),this.consoleSvc.debug(`shouldInjectCouponsAtCheckout() : 5 !tab.hasTriedInjection: ${!t.hasTriedInjection}`),this.consoleSvc.debug(`shouldInjectCouponsAtCheckout() : 6 coolDownReady: ${!t.merchantState.couponCoolDownExpiry||t.merchantState.couponCoolDownExpiry&&Date.now()>t.merchantState.couponCoolDownExpiry}`)}shouldInjectShopperMarketingSlider(t){return t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.shopperMarketingID&&this.isShopperMarketingUrl(t.url,t.merchantState.merchant)&&!this.hasSeenShopperMarketingSlider(t)&&(this.hasSeenActivationSlider(t)||t.merchantState.merchant.isZeroPayout)}shouldInjectNonCheckoutCoupons(t){let e=t.merchantState.activationState,n=t.merchantState.couponCoolDownExpiry,i=t.merchantState.merchant.isZeroPayout;return t&&this.hasMerchantCoupons(t)&&(e===Z.NotActive||i&&e===Z.Activated)&&(i||!this.memberSvc.isLoggedIn)&&!t.hasTriedInjection&&(!n||n&&Date.now()>n)}shouldInjectPostPurchaseContent(t){return t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.activationState===Z.Activated&&t.merchantState.merchant.postPurchaseUrl&&t.url&&this.getUrlType(t.url,t.merchantState.merchant)===C.PostPurchase&&!t.hasTriedInjection}shouldNotInjectActivation(t,e){return!t||!t.merchantState||!t.merchantState.merchant||t.merchantState.merchant.isZeroPayout&&!this.hasMerchantCoupons(t)||this.configSvc.client===y.ibd&&!this.memberSvc.isLoggedIn&&!e.merchant.coupons.length||this.configSvc.client===y.tada&&!this.memberSvc.isLoggedIn&&!e.merchant.coupons.length||this.configSvc.client===y.upm&&!this.memberSvc.isLoggedIn&&!e.merchant.coupons.length}shouldTryActivationConfirmation(t){return t&&t.merchantState&&t.merchantState.activationState===Z.Activated&&t.merchantState.injectionState&&!t.merchantState.injectionState.activationConfirmed&&t.hasTriedInjection}shouldTryInjectSlider(t){return t&&t.merchantState&&t.merchantState.merchant&&t.merchantState.merchant.type&&t.merchantState.merchant.type>v.PopupOnly&&t.merchantState.activationState!==Z.StandingDown}injectLoginOccurred(t){return(0,h.mG)(this,void 0,void 0,function*(){this.injectScript(t,'document.dispatchEvent(new CustomEvent("login-occurred"));')})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Bt),o.LFG(Ft),o.LFG(oe),o.LFG(Dt),o.LFG(ne),o.LFG(Ht),o.LFG(ee),o.LFG(re),o.LFG($t),o.LFG(Jt),o.LFG(jt),o.LFG(te))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ae=(()=>{class t{constructor(t,e,n,i,o,r,s,a,c){this.tabs=t,this.config=e,this.member=n,this.browser=i,this.console=o,this.exceptions=r,this.browserEvents=s,this.contentInjection=a,this.storage=c,this.VISIBLE_NOTIFICATION_INTERVAL=3e5,this.queue=[],this._notifications=[]}init(){this.member.surveysAdded.subscribe(t=>{for(let e=0;e<t.length;e++)this.addForSurvey(t[e],0===e)}),this.member.promoCodeAdded.subscribe(t=>{this.addForPromoCode(t)}),this.browserEvents.onNotificationClicked.subscribe(t=>{this.notificationClicked(t)}),this.queueProcessor=(0,At.F)(this.VISIBLE_NOTIFICATION_INTERVAL),this.queueProcessor.subscribe(()=>{if(this.queue.length){let t=this.queue.shift();t.type===ot.Survey&&this.member.getPreference(j.surveyAlertOptOut)?this.console.debug("Suppressing notification: ",t):this.createVisibleNotification(t)}})}addForPromoCode(t){let e=new it(t.id.toString(),ot.PromoCode,t.ts,t.expires,t,this.browser.getLocalizedMessage("newPromoCodeAvailable"),this.browser.getLocalizedMessage("clickToView"),t.url,t.message||this.browser.getLocalizedMessage("getStarted"),!1,"assets/images/promo-code-alert.svg");this.createVisibleNotification(e),this.add(e)}remove(t){this.console.debug("Attempting to remove notificationId: "+t);let e=this._notifications.findIndex(e=>e.id===t),n=null;e>-1&&(this.console.debug("Removing notificationId: "+t+" from _notifications"),n=this._notifications[e],this._notifications.splice(e,1));let i=this.queue.findIndex(e=>e.id===t);return i>-1&&(this.console.debug("Removing notificationId: "+t+" from queue"),this.queue.splice(i,1)),n}surveyNotificationClicked(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=this.config.sourceId,n=yield this.storage.extId.get(),i=t.url||`${this.config.apiHost}/g/survey-click/?projectid=${t.prjId}&sourceid=${e}&memberid=${this.member.member.id}`;i+=`${i.includes("?")?"&":"?"}extid=${n}&extv=${this.browser.api.runtime.getManifest().version}`,this.tabs.openNewTab(i,!0)})}promoCodeNotificationClicked(t){t.url?this.tabs.openNewTab(t.url,!0):this.exceptions.handleError(new Error(`PromoCode clicked without URL: ${JSON.stringify(t)}`))}notificationClicked(t){let e=this.remove(t);switch(e.type){case ot.Survey:this.surveyNotificationClicked(e.data);break;case ot.PromoCode:this.promoCodeNotificationClicked(e.data)}}createVisibleNotification(t){return(0,h.mG)(this,void 0,void 0,function*(){t&&t.data&&(yield this.browser.callbackDecorator("permissions.contains",this.browser.api.permissions.contains,[{permissions:["notifications"]}],e=>(0,h.mG)(this,void 0,void 0,function*(){if(e)this.browser.api.notifications.create(t.id,{type:"basic",iconUrl:t.icon,title:t.title,message:t.text,contextMessage:this.config.extensionName,buttons:[{title:"Get Started"}],requireInteraction:!0});else{let e=yield this.tabs.getActiveTabState();e&&e.tabId&&(yield this.contentInjection.injectNotification(e.tabId,t))}})))})}add(t){this.console.debug("Adding notification:",t),this._notifications.push(t),t.shouldNotifyVisibly&&this.queue.push(t)}fetchValid(){let t=I.getSeconds(),e=this._notifications.filter(e=>t>e.ts+e.expires);return e.length&&(this.console.debug("Removing expired notifications:",e),e.forEach(t=>{this.remove(t.id)})),this._notifications}formatSurveyReward(t){let e=null;switch(this.config.client){case y.mp:e=`${t} PT${1===t?"":"S"}`;break;case y.tada:e=`$${t}`;break;case y.sb:e=`${t} SB`;break;case y.ibd:e=`$${(t/100).toFixed(2)}`}return e}addForSurvey(t,e){if(this.remove(t.prjId.toString()),t.expires>0){let n=new it(t.prjId.toString(),ot.Survey,t.ts,t.expires,t,this.browser.getLocalizedMessage("newSurveyAvail"),this.browser.getLocalizedMessage("getAmountForThisSurvey",this.formatSurveyReward(t.sb)),t.url,this.browser.getLocalizedMessage("popup_answer_survey_alert_cta"),e,this.config.client==y.ibd?"assets/images/alert.png":"assets/images/answer.svg");this.add(n)}}addToQueue(t){this.add(t)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(oe),o.LFG(Dt),o.LFG(ne),o.LFG(Ht),o.LFG(Ft),o.LFG(zt),o.LFG(Jt),o.LFG(se),o.LFG($t))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ce=(()=>{class t{constructor(t,e){this.api=t,this.console=e,this.TYPE_MAP=(new Map).set(xt.Urls,"ext.urls").set(xt.PrePurchaseProducts,"ext.products.prepurchase").set(xt.PostPurchaseProducts,"ext.products.postpurchase").set(xt.OrderHistoryProducts,"ext.products.orderhistory"),this.VERSION_MAP=(new Map).set(xt.Urls,1).set(xt.PrePurchaseProducts,2).set(xt.PostPurchaseProducts,2).set(xt.OrderHistoryProducts,3),this._deliveryStream=null}get deliveryStream(){return this._deliveryStream}set deliveryStream(t){t&&void 0!==t&&(this._deliveryStream=t)}init(){return(0,h.mG)(this,void 0,void 0,function*(){let t=Date.now();if(!this.client||this.tokenExpiration<=t){let e=yield this.api.getToken();if(!(e&&0===e.status&&e.data&&e.data.firehose))return void(this.client=null);{let n=e.data.firehose;this.client=new Lt.u({region:n.region,credentials:{sessionToken:n.token,accessKeyId:n.key_id,secretAccessKey:n.key}}),this.tokenExpiration=t+1e3*n.expiresIn,this.deliveryStream=n.stream}}})}log(t,e){return(0,h.mG)(this,void 0,void 0,function*(){if(yield this.init(),this.client){e.v=this.VERSION_MAP.get(t);let o=new _t(this.TYPE_MAP.get(t),e);const r=JSON.stringify(o),s=Buffer.from(r);var n=new Gt.o({DeliveryStreamName:this.deliveryStream,Record:{Data:s}});try{yield this.client.send(n)}catch(i){throw this.console.error("Error sending data to Firehose:",i),i}}else this.console.debug("No firehose, so no log. Presumably because there is no token, because the user is logged out or because logging is not enabled for this client or location.")})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Bt),o.LFG(Ft))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),le=(()=>{class t{constructor(t,e,n,i,o,r){this.apiSvc=t,this.config=e,this.tab=n,this.consoleSvc=i,this.exceptionHandler=o,this.storage=r,this.siteMap=new vt,this._onSiteDetected=new u.x,this.onSiteDetected=this._onSiteDetected.asObservable(),this._hash=null}getHash(){return(0,h.mG)(this,void 0,void 0,function*(){return this._hash||(this._hash=yield this.storage.siteMapHash.get()),this._hash})}init(){this.config.subscribeConfigChange(Q.SiteMapHash,t=>{this.tryUpdateHash(t)}),this.tab.tabNavComplete.subscribe(t=>(0,h.mG)(this,void 0,void 0,function*(){if(t){let e=this.siteMap.get(t.url);e&&(e.tab=t,this._onSiteDetected.next(e))}})),this.fetch()}fetch(t){return(0,h.mG)(this,void 0,void 0,function*(){try{let t=yield this.getHash();if(t){let e=yield this.apiSvc.fetchSiteMapJson(t);this.siteMap.load(e,t)}else this.consoleSvc.debug("No valid sitemap hash")}catch(t){this.exceptionHandler.handleError(t)}})}tryUpdateHash(t){this._hash!==t&&(this._hash=t,this.fetch())}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Bt),o.LFG(Dt),o.LFG(oe),o.LFG(Ft),o.LFG(zt),o.LFG($t))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var de=(()=>(function(t){t[t.url=0]="url",t[t.prePurchase=1]="prePurchase",t[t.postPurchase=2]="postPurchase",t[t.orderHistory=3]="orderHistory"}(de||(de={})),de))(),he=(()=>(function(t){t[t.prePurchase=1]="prePurchase",t[t.postPurchase=2]="postPurchase",t[t.orderHistory=4]="orderHistory"}(he||(he={})),he))();let ue=(()=>{class t{constructor(t,e,n,i,o,r,s,a,c,l,d,h){this.member=t,this.browser=e,this.storage=n,this.firehose=i,this.consoleSvc=o,this.configSvc=r,this.siteMapSvc=s,this.contentInjectionSvc=a,this.fileSystemSvc=c,this.network=l,this.api=d,this.exceptionHandler=h,this.URL_BATCH_SIZE=10,this.URL_BATCH_LIMIT=100,this.forceLoadLocal=!1,this.urls=[]}get dataCollectionEnabledForMember(){return this.member.isLoggedIn&&(this.member.member.preferences&j.dataCollectionOptOut)!=j.dataCollectionOptOut}init(){return(0,h.mG)(this,void 0,void 0,function*(){let t=t=>{this.dataCollectionEnabled=(t&M.DATA_INSIGHTS)==M.DATA_INSIGHTS,this.consoleSvc.debug("setDataCollectionEnabled flags:"+t+" dataCollectionEnable:"+this.dataCollectionEnabled)},e=yield this.storage.flags.get();t(e),this.siteMapSvc.onSiteDetected.subscribe(t=>{this.onSiteDetected(t)}),this.configSvc.subscribeConfigChange(Q.Flags,e=>{t(e)})})}checkSetting(t,e){return e&&e.settings&&(e.settings&t)==t}isProductPage(t,e){let n=!1;return t&&e&&e.pages&&e.pageMatch?(n=Object.keys(e.pages).includes(e.pageMatch)&&(e.pages[e.pageMatch]&t)==t,n):n}loadJson(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=null;const n=yield this.storage.dataInsights.get();let i="data-insights/data-insights-all-merchants.json";if(this.forceLoadLocal)e=yield this.fileSystemSvc.getFileText(i);else if(n&&n.value&&!n.expired)e=n.value;else try{e=yield this.network.getText(t),yield this.storage.dataInsights.setValue(e)}catch(o){e=n&&n.value?n.value:yield this.fileSystemSvc.getFileText(i)}return e})}doContentInjection(t){return(0,h.mG)(this,void 0,void 0,function*(){this.consoleSvc.debug("setupLogProducts() , siteData",t);const e=this.configSvc.cdnHost,n=yield this.loadJson(`${e}/json/extension/data-insights-all-merchants.min.json?v=${this.api.cacheBuster}`);let i,o;try{if(i=JSON.parse(n)[t.id],"string"==typeof i&&(i=JSON.parse(i)),this.consoleSvc.debug(`for url: ${t.tab.url}  --  selectedMerchantConfig:`,i),i){let e=Object.keys(i);if(e.includes(t.pageMatch))o=i[t.pageMatch];else{const n=t.pageMatch.endsWith("/")?t.pageMatch.substring(0,t.pageMatch.length-1):t.pageMatch+"/";e.includes(n)&&(o=i[n])}}else this.consoleSvc.debug(`Could not find a selectedMerchantConfig match for siteData.id ${t.id}`);if(o){this.consoleSvc.debug("DI: Injecting runDataInsightsWhenReady()",o);const e="data-insights/data-insights-factory.js";yield this.contentInjectionSvc.injectScriptFile(t.tab.tabId,e),this.contentInjectionSvc.injectScript(t.tab.tabId,`\n          try{\n            var diResult = new Prdg.DataInsightsFactory();\n            diResult.runDataInsightsWhenReady(${JSON.stringify(t)},\n                  ${JSON.stringify(o)},\n                  'coreonSiteDetected',\n                  ${this.configSvc.client},\n                  ${this.consoleSvc.getLevel()>=f.Debug},\n                  ${JSON.stringify(i)}\n                  );\n          }catch(ex){ }\n        `)}else this.consoleSvc.debug(`selectedMerchantConfig could not find a match for key ${t.pageMatch}`)}catch(r){this.exceptionHandler.handleError(r,!0)}})}logProducts(t){return(0,h.mG)(this,void 0,void 0,function*(){this.consoleSvc.debug("logProducts dataInsightResults:",JSON.parse(JSON.stringify(t))),t.exception&&this.consoleSvc.error("logProducts error dataInsightResults:",JSON.parse(JSON.stringify(t.exception)));try{let e=t;e=this.cleanOutExtraDataForFirehose(e);let n,i=this.browser.api.runtime.getManifest().version,o=yield this.storage.extId.get(),r=new Ct(e,i,o,this.member.member.id,this.configSvc.client);switch(e.pageType){case he.prePurchase:n=xt.PrePurchaseProducts;break;case he.postPurchase:n=xt.PostPurchaseProducts;break;case he.orderHistory:n=xt.OrderHistoryProducts}yield this.firehose.log(n,r)}catch(e){this.consoleSvc.error("logProducts exception:",e)}})}cleanOutExtraDataForFirehose(t){return t.source&&delete t.source,t.clientID&&delete t.clientID,t}logUrl(t){return(0,h.mG)(this,void 0,void 0,function*(){let e=new yt(t),n=!1;if(this.consoleSvc.info("Queueing URL for log:",e),this.urls.push(e),this.urls.length&&this.urls.length%this.URL_BATCH_SIZE==0)try{let t=this.browser.api.runtime.getManifest().version,e=yield this.storage.extId.get(),i=new Ct(this.urls,t,e,this.member.member.id,this.configSvc.client);this.consoleSvc.info("Pushing URL logs:",i),yield this.firehose.log(xt.Urls,i),n=!0}catch(i){this.consoleSvc.error("Failed to log URLs:",i)}finally{(n||this.urls.length>this.URL_BATCH_LIMIT)&&(this.urls=[])}})}onSiteDetected(t){return(0,h.mG)(this,void 0,void 0,function*(){this.dataCollectionEnabled&&this.dataCollectionEnabledForMember&&(this.consoleSvc.debug("onSiteDetected:",t),this.shouldLog(de.url,t)&&this.logUrl(t),this.shouldDoContentInjection(t)&&this.doContentInjection(t))})}shouldLog(t,e){switch(t){case de.url:return this.checkSetting(bt.LogUrls,e);case de.prePurchase:return this.checkSetting(bt.LogPrePurchase,e)&&this.isProductPage(he.prePurchase,e);case de.postPurchase:return this.checkSetting(bt.LogPostPurchase,e)&&this.isProductPage(he.postPurchase,e);case de.orderHistory:return this.checkSetting(bt.LogOrderHistory,e)&&this.isProductPage(he.orderHistory,e);default:return!1}}shouldDoContentInjection(t){return this.shouldLog(de.prePurchase,t)||this.shouldLog(de.postPurchase,t)||this.shouldLog(de.orderHistory,t)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(ne),o.LFG(Ht),o.LFG($t),o.LFG(ce),o.LFG(Ft),o.LFG(Dt),o.LFG(le),o.LFG(se),o.LFG(re),o.LFG(jt),o.LFG(Bt),o.LFG(zt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ge=(()=>{class t{constructor(t,e,n,i,o,r,s,a,c,l,d,h,g,p,m,f){this.api=t,this.config=e,this.console=n,this.tabs=i,this.member=o,this.browser=r,this.storage=s,this.merchant=a,this.lifecycle=c,this.browserEvents=l,this.contentInjection=d,this.notifications=h,this.dataInsights=g,this.exceptions=p,this.gofer=m,this.location=f,this._brandServiceFunctionCalled=new u.x,this.brandServiceFunctionCalled=this._brandServiceFunctionCalled.asObservable(),window.reflection=this}init(){this.browserEvents.onRuntimeMessage.subscribe(t=>{this.onRuntimeMessage.apply(this,t)}),this.gofer.onReflect.subscribe(t=>{this.onReflect(t)})}sendBackgroundMessage(t){return new Promise(e=>{this.browser.api.runtime.sendMessage(t,t=>{e(t)})})}onReflect(t){let e=window.reflection;t.target.forEach(t=>{e=e[t]}),e.apply(null,t.args)}onRuntimeMessage(t,e,n){let i=m[t.type];this[i.charAt(0).toLowerCase()+i.slice(1)](t,n)}processAccountResponse(t,e){return(0,h.mG)(this,void 0,void 0,function*(){if(e.value.isPopup&&0===t.status){let t=(yield this.tabs.getActiveTabState()).tabId;this.contentInjection.injectLoginOccurred(t)}return t})}parseHostSiteMessage(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){t.messageSrc===this.config.brand&&(t.messageContent?(yield e.set(t.messageContent),(yield this.storage.extId.get())&&(yield this.storage.extHash.get())&&(yield n(t.messageContent))):this.exceptions.handleError(new st(`messageContent missing from host site message: ${JSON.stringify(t)}`)))})}parseCampaignMessage(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.parseHostSiteMessage(t,this.storage.campaign,t=>{this.api.postCampaignData(t)})})}parseReferralMessage(t){return(0,h.mG)(this,void 0,void 0,function*(){this.config.isFlagEnabled(M.MKT_REFERRALS)&&(yield this.parseHostSiteMessage(t,this.storage.referral,t=>{this.api.postReferralData(t)}))})}dataInsightsResults(t,e){return(0,h.mG)(this,void 0,void 0,function*(){t.value.clientID===this.config.client&&this.dataInsights.logProducts(t.value),e()})}activate(t,e){return(0,h.mG)(this,void 0,void 0,function*(){if(!t.value.merchantId)throw"merchantId (number) missing in message value.";if(void 0===t.value.urlType)throw"urlType (MerchantUrlType) missing in message value.";if(!t.value.pageId)throw"pageId (PageIds) missing in message value.";{let n=t.value.tabId?this.tabs.getTabState(t.value.tabId):yield this.tabs.getActiveTabState();yield this.tabs.activate(n,t.value.merchantId,t.value.urlType,t.value.pageId,t.value.redirectContext),e()}})}callBrandServiceFunction(t,e){this._brandServiceFunctionCalled.next(t.value),e()}closeSettings(t,e){return(0,h.mG)(this,void 0,void 0,function*(){yield this.tabs.closeSettings(),e()})}constructActivateString(t,e){e(this.merchant.constructActivateString(t.value))}constructRewardString(t,e){e(this.merchant.constructRewardString(t.value))}dismissActivation(t,e){this.tabs.setTabActivationDismissed(t.value.tabId),e()}executeCallback(t,e){return(0,h.mG)(this,void 0,void 0,function*(){yield this.lifecycle.executeCallback(),e()})}executeReflect(t,e){try{if(t.value&&t.value.class&&t.value.member){this.console.cachedLogPile=[],this.console.shouldCacheLogs=!0;let n=null;n=t.value.params?"messagingSvc"===t.value.class?this[t.value.member](...t.value.params):t.value.member2&&""!==t.value.member2?this[t.value.class][t.value.member][t.value.member2](...t.value.params):this[t.value.class][t.value.member](...t.value.params):"messagingSvc"===t.value.class?this[t.value.member]:this[t.value.class][t.value.member],e({results:n,logs:this.console.cachedLogPile}),this.console.cachedLogPile=[],this.console.shouldCacheLogs=!1}}catch(n){e(`Call Failed! ${n.message} ${n.stack}`)}}executeReflectCmd(t,e){return(0,h.mG)(this,void 0,void 0,function*(){try{if(t.value.cmd){this.console.cachedLogPile=[],this.console.shouldCacheLogs=!0;let n=null;const i=t.value.cmd,o=i.lastIndexOf(")")===i.length-1,r=i.split(".");if(o){let t=i.substring(i.indexOf("(")+1,i.lastIndexOf(")"));if(t=`[${t}]`,t=t.replace(/([a-zA-Z0-9]+?):/gu,'"$1":'),t=t.replace(/'/gu,'"'),t=JSON.parse(t),"messagingSvc"===r[0]){const e=r[1].substring(0,r[1].indexOf("("));n=yield this[e](...t)}else if(r[2].indexOf("(")>0){const e=r[2].substring(0,r[2].indexOf("("));n=yield this[r[0]][r[1]][e](...t)}else{const e=r[1].substring(0,r[1].indexOf("("));n=yield this[r[0]][e](...t)}}else n="messagingSvc"===r[0]?yield this[r[1]]:yield this[r[0]][r[1]];e({results:n,logs:this.console.cachedLogPile}),this.console.cachedLogPile=[],this.console.shouldCacheLogs=!1}}catch(n){e(`Call Failed! ${n.message} ${n.stack}`)}})}getAllReflects(t,e){let n=[];Object.keys(this).map(t=>{const e={name:t,children:[]};Object.keys(this[t].__proto__).map(n=>{e.children.push({name:n+("function"==typeof this[t][n]?": f()":"")})}),n.push(e)});const i={name:"messagingSvc",children:[]};Object.keys(this.__proto__).map(t=>{i.children.push({name:t+("function"==typeof this[t]?": f()":"")})}),n.push(i),e(n)}getCdnHost(t,e){e(this.config.cdnHost)}getCurrencySymbol(t,e){e(this.location.getLocation(t.value.loc).currencySymbol)}getFilePath(t,e){e(this.browser.api.runtime.getURL(t.value))}getFeaturedOfferPlacement(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.api.getFeaturedOfferPlacement();e(t)})}getFeaturedMerchants(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let t=[],n=yield this.storage.featuredMerchants.get();if(n&&n.length)for(let e=0;e<n.length;e++){let i=yield this.merchant.fetchMerchantById(n[e],this.config.client);i&&i.reward&&i.img&&t.push(i)}e(t)})}getLocalizedString(t,e){e(this.browser.api.i18n.getMessage(...t.value))}getPopupData(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n,i;const o=t.value&&t.value.tabId||0;i=o?yield this.tabs.getTabState(o):yield this.tabs.getActiveTabState(),n=new z,n.tabId=i&&i.tabId||0,n.member=this.member.member,n.notifications=this.notifications.fetchValid(),i&&(yield this.tabs.verifyCurrentUrl(i),i.merchantState&&(n.merchant=i.merchantState.merchant,n.activationState=i.merchantState.activationState));let r=yield this.storage.prefs.get();n.prefs=r||{},n.flags=yield this.storage.flags.get(),this.console.info("Popup data:",n),e(n)})}getSerpMerchantMetasByUrls(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n=[];for(const e in t.value.urls)if(t.value.urls.hasOwnProperty(e)){const i=this.merchant.matchMerchantUrl(t.value.urls[e]);this.merchant.shouldShowSERP(i)?n.push(i):n.push(null)}e(n)})}getStorageItem(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n=yield this.storage.getLocal(t.value);e(n)})}injectContent(t,e){this.contentInjection.injectRequestedContent(t.value.type,t.value.tabId,t.value.data),e()}log(t,e){this.console[f[t.value.level]](t.value.message,t.value.extraInfo),e()}logCouponResults(t,e){return(0,h.mG)(this,void 0,void 0,function*(){yield this.api.postCouponLog(t.value),e()})}logImpression(t,e){return(0,h.mG)(this,void 0,void 0,function*(){this.tabs.getTabState(t.value)})}login(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n=yield this.member.login(t.value.email,t.value.password);this.processAccountResponse(n,t),e(n)})}navigateToFeaturedMerchant(t,e){return(0,h.mG)(this,void 0,void 0,function*(){if(!t.value)throw"NavigateToFeaturedMerchant missing merchantID";{const n=yield this.tabs.openNewTab(void 0,!0),i=yield this.merchant.fetchMerchantById(t.value,this.config.client),o=yield this.tabs.constructRedirectUrl(i,null,X.PopupFeaturedMerchantClick);this.tabs.navigate(o,n),e()}})}notificationClicked(t,e){this.notifications.notificationClicked(t.value),e()}notificationRemoveClicked(t,e){this.notifications.remove(t.value),e()}openGoTab(t,e){this.tabs.openGoTab(t.value),e()}openSettings(t,e){return(0,h.mG)(this,void 0,void 0,function*(){yield this.tabs.openSettings(),e()})}openSiteTab(t,e){this.tabs.openSiteTab(t.value),e()}refreshAccountBalance(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let t=yield this.member.refreshBalance();e(t)})}register(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n=yield this.member.register(t.value.email,t.value.password);this.processAccountResponse(n,t),e(n)})}resetCouponCoolDown(t,e){return(0,h.mG)(this,void 0,void 0,function*(){this.tabs.resetCouponCoolDown(t.value),e()})}sendDataFromHostToExt(t,e){return(0,h.mG)(this,void 0,void 0,function*(){if(t&&t.value)switch(t.value.messageType){case"cmpData":yield this.parseCampaignMessage(t.value);break;case"refData":yield this.parseReferralMessage(t.value);break;default:this.console.debug("Received unexpected messageType from host.",t)}e()})}sendPasswordReminder(t,e){return(0,h.mG)(this,void 0,void 0,function*(){yield this.member.sendPasswordReminder(t.value.email),e()})}setActivationConfirmed(t,e){this.tabs.setTabActivationConfirmed(t.value.tabId),e()}setActivationInjected(t,e){this.tabs.setTabActivationInjected(t.value.tabId),e()}setStorageItem(t,e){return(0,h.mG)(this,void 0,void 0,function*(){yield this.storage.setLocal(t.value.key,t.value.value),e()})}setTabShopperMarketingInjected(t,e){this.tabs.setTabShopperMarketingInjected(t.value.tabId),e()}showTutorial(t,e){this.lifecycle.showTutorial(!1),e()}updateMemberPrefs(t,e){return(0,h.mG)(this,void 0,void 0,function*(){let n=t.value;yield this.member.updateMemberPref(n),e()})}userClickedInPage(t,e){return(0,h.mG)(this,void 0,void 0,function*(){t.value.clientId===this.config.client&&this.tabs.updateUserClicked(t.value.tabId,!0),e()})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Bt),o.LFG(Dt),o.LFG(Ft),o.LFG(oe),o.LFG(ne),o.LFG(Ht),o.LFG($t),o.LFG(ee),o.LFG(Kt),o.LFG(Jt),o.LFG(se),o.LFG(ae),o.LFG(ue),o.LFG(zt),o.LFG(Wt),o.LFG(te))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),pe=(()=>{class t{constructor(t,e,n,i,o,r){this.apiSvc=t,this.config=e,this.browserEvents=n,this.consoleSvc=i,this.lifecycleEvents=o,this.storageSvc=r,this.memberId=0,this.extensionId=null,this.loggingSupported=!1,this.logForMember=!1,this.tabStorage={},this.tabToUidMap=new Map,this.lastRequestId={},this.lastTimeStamp=0,this.detailsTotalSize={},this.hasOversized={},this.supportedRequestTypes=["main_frame"],this.invalidTransitionQualifier="from_address_bar",this.invalidTransitionType="auto_bookmark"}get shouldLog(){return this.loggingSupported&&this.logForMember}init(){return(0,h.mG)(this,void 0,void 0,function*(){this.config.subscribeConfigChange(Q.Flags,t=>{this.loggingSupported=(t&M.ANSWER_LOGGING)==M.ANSWER_LOGGING}),this.lifecycleEvents.onAccountInfoChanged.subscribe(t=>(0,h.mG)(this,void 0,void 0,function*(){this.memberId=t.id,this.logForMember=t.id&&t.doSurveyLog,this.extensionId=yield this.storageSvc.extId.get()})),this.browserEvents.onStartSurveyLogging.subscribe(t=>{this.shouldLog&&this.startLogging(t)}),this.browserEvents.onUpdateSurveyLogging.subscribe(t=>{this.shouldLog&&this.updateTabStorageLog(t)}),this.browserEvents.onEndSurveyLogging.subscribe(t=>{this.shouldLog&&this.endLogging(t)}),this.browserEvents.onWebNavigationCommitted.subscribe(t=>{this.shouldLog&&this.breakLogging(t)}),this.browserEvents.onTabCreated.subscribe(t=>{this.shouldLog&&this.continueLoggingNewTab(t)}),this.extensionId=yield this.storageSvc.extId.get()})}startLogging(t){const e=t.tabId;if(!e||this.tabStorage.hasOwnProperty(e))return;this.consoleSvc.debug("startLogging",t),this.tabStorage[e]={},this.tabStorage[e].requests={};const n=`${this.memberId}-${Date.now()}-${this.extensionId}`;this.tabToUidMap.set(e,n),this.detailsTotalSize[n]=0,this.hasOversized[n]=!1,this.updateTabStorageLog({event:"onLoggingStart",details:t})}updateTabStorageLog(e){const{eventName:n,details:i}=e;if(!this.supportedRequestTypes.includes(i.type))return;const o=i.tabId,r=i.requestId;if(!o||!r||!this.tabStorage.hasOwnProperty(o))return;this.consoleSvc.debug("updateTabStorageLog: event - "+n,i),this.tabStorage[o].requests.hasOwnProperty(r)||(this.tabStorage[o].requests[r]=[]);const s=this.tabToUidMap.get(o);i.timeStamp!==this.lastTimeStamp&&(this.tabStorage[o].requests[r].push(e),this.lastTimeStamp=i.timeStamp,s&&(this.detailsTotalSize[s]+=JSON.stringify(i).length,this.lastRequestId[this.tabToUidMap.get(o)]=r)),s&&this.detailsTotalSize[s]>t.MAX_LOG_SIZE&&!this.hasOversized[s]&&(this.hasOversized[s]=!0,i.oversized=this.detailsTotalSize[s],this.endLogging(i))}endLogging(t){return(0,h.mG)(this,void 0,void 0,function*(){if(0===Object.keys(this.tabStorage).length)return void this.consoleSvc.debug("Nothing logged so nothing to see here.");const e=t.tabId,n=t.requestId,i=this.tabToUidMap.get(e);if(i&&e&&this.tabStorage.hasOwnProperty(e)){if(t.redacted&&!n){const n=this.tabStorage[e].requests[this.lastRequestId[i]];for(const e in n)n.hasOwnProperty(e)&&n[e]&&n[e].details&&n[e].details.url===t.url&&(n[e].details.url="REDACTED",n[e].details.transitionQualifiers=t.transitionQualifiers,n[e].details.transitionType=t.transitionType)}else this.tabStorage[e].requests.hasOwnProperty(n)||(this.tabStorage[e].requests[n]=[]),this.tabStorage[e].requests[n].push({event:"onLoggingEnd",details:t}),this.lastRequestId[i]=n;this.consoleSvc.debug("Logging ended by tab:"+e+", - Final tabStorage map: ",this.tabStorage),yield this.logCurrentData(i),this.tabToUidMap.forEach((t,e)=>{i===t&&delete this.tabStorage[e]})}})}logCurrentData(e){return(0,h.mG)(this,void 0,void 0,function*(){let n={},i=0;for(const o in this.tabStorage)if(this.tabToUidMap.get(Number(o))===e)for(const r in this.tabStorage[o].requests)if(this.tabStorage[o].requests.hasOwnProperty(r)){0===Object.getOwnPropertyNames(n).length&&(n[o]={},n[o].requests={}),n[o].requests[r]=this.tabStorage[o].requests[r],i++;const s=r===this.lastRequestId[e];if(i>=t.surveyLogBatchSize||s){const t=yield this.apiSvc.executeSurveyLog({uniqueID:e,surveyLog:JSON.stringify(n)});return n={},i=0,void this.consoleSvc.debug("Survey log post response:",t)}}})}breakLogging(t){if(t&&(t.transitionQualifiers&&t.transitionQualifiers.indexOf(this.invalidTransitionQualifier)>=0||t.transitionType&&t.transitionType===this.invalidTransitionType)){const e=t.tabId;e&&this.tabStorage.hasOwnProperty(e)&&(this.consoleSvc.debug("breakLogging",t),t.redacted=!0,this.endLogging(t))}}continueLoggingNewTab(t){const e=t.openerTabId;if(e&&this.tabStorage.hasOwnProperty(e)){const n=t.id;n&&!this.tabStorage.hasOwnProperty(n)&&(this.tabStorage[n]={},this.tabStorage[n].requests=[],this.tabToUidMap.set(n,this.tabToUidMap.get(e)),this.consoleSvc.debug("Start logging for new tabId:"+n+" opened by tabId: "+e))}}}return t.MAX_LOG_SIZE=1e6,t.surveyLogBatchSize=10,t.\u0275fac=function(e){return new(e||t)(o.LFG(Bt),o.LFG(Dt),o.LFG(Jt),o.LFG(Ft),o.LFG(Kt),o.LFG($t))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),me=(()=>{class t{constructor(t,e,n){this.tabs=t,this.member=e,this.browser=n,this.supportedSizes=[16,32,48,64,128],this.assetPath="assets/icons",this.animatingTabs={},this.pulseAnimation=new fe(["pulse-0.png","pulse-1.png","pulse-2.png","pulse-1.png","pulse-0.png","pulse+1.png","pulse+2.png","pulse+1.png","pulse-0.png"],[32,48,64,128],150,2),this.clientIconMap=(new Map).set(y.ibd,new ve("default.png","default.png","default.png")).set(y.mp,new ve("merchant.png","merchant-activated.png","non-merchant.png",this.pulseAnimation)).set(y.sb,new ve("merchant.png","merchant-activated.png","non-merchant.png",this.pulseAnimation)).set(y.tada,new ve("merchant.png","merchant.png","non-merchant.png")).set(y.upm,new ve("default.png","default.png","default.png"))}getPath(t,e=this.supportedSizes){let n={};for(const i of e)n[`${i}`]=`${this.assetPath}/${i}/${t}`;return n}setIcon(t,e,n=this.supportedSizes){return(0,h.mG)(this,void 0,void 0,function*(){if(yield this.tabs.checkTabExists(t))return yield this.browser.callbackDecorator("browserAction.setIcon",this.browser.api.browserAction.setIcon,[{path:this.getPath(e,n),tabId:t}])})}stopAnimation(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){clearInterval(t),delete this.animatingTabs[e],yield this.setIcon(e,n)})}animateIcon(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){let i=null;if(!this.animatingTabs[t]){this.animatingTabs[t]=!0;let o=0,r=1;i=setInterval(()=>(0,h.mG)(this,void 0,void 0,function*(){if(o>e.frames.length-1){if(!(r<e.maxLoopCount))return void(yield this.stopAnimation(i,t,n));o=0,r++}try{yield this.setIcon(t,e.frames[o],e.sizes),o++}catch(s){yield this.stopAnimation(i,t,n)}}),e.frameDuration)}})}setIconWithActivationState(t,e,n,i=!1){return(0,h.mG)(this,void 0,void 0,function*(){let o;const r=this.clientIconMap.get(t),s=i?r.animation:null;switch(n){case Z.NotActive:case Z.StandingDown:case Z.Activating:o=r.merchant;break;case Z.Activated:o=this.member.isLoggedIn?r.merchantActivated:r.merchant;break;default:o=r.nonMerchant}s?yield this.animateIcon(e,s,o):yield this.setIcon(e,o)})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(oe),o.LFG(ne),o.LFG(Ht))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class fe{constructor(t,e,n=100,i=2){this.frames=t,this.sizes=e,this.frameDuration=n,this.maxLoopCount=i}}class ve{constructor(t,e,n,i=null){this.merchant=t,this.merchantActivated=e,this.nonMerchant=n,this.animation=i}}let be=(()=>{class t{constructor(t,e,n,i){this.api=t,this.alarms=e,this.storage=n,this.browser=i,this.isEnabled=!0,this.periodInMinutes=10080}get isSupported(){return!(!this.browser.api.management||!this.browser.api.management.getAll)}log(){return(0,h.mG)(this,void 0,void 0,function*(){if(this.isEnabled&&this.isSupported){let t=(yield this.browser.callbackDecorator("management.getAll",this.browser.api.management.getAll,[],t=>t)).filter(t=>t.id!==this.browser.api.runtime.id&&t.enabled).map(t=>t.id),e=new lt(t);yield this.api.postPeerLog(e),this.storage.lastPeerLog.set(Date.now())}})}init(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield this.storage.extHash.get(),e=yield this.storage.extId.get();if(t&&e){yield this.alarms.registerAlarm("peer-log",{periodInMinutes:this.periodInMinutes},()=>(0,h.mG)(this,void 0,void 0,function*(){yield this.log()}));const t=yield this.storage.lastPeerLog.get();Date.now()>t+60*this.periodInMinutes*1e3&&(yield this.log())}else setTimeout(()=>(0,h.mG)(this,void 0,void 0,function*(){yield this.init()}),6e4)})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Bt),o.LFG(Yt),o.LFG($t),o.LFG(Ht))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),_e=(()=>{class t{constructor(t,e){this.browser=t,this.el=e}ngOnInit(){this.el.nativeElement.innerHTML=this.browser.getLocalizedMessage(this.l10n,this.substitutions)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ht),o.Y36(o.SBq))},t.\u0275dir=o.lG2({type:t,selectors:[["","l10n",""]],inputs:{l10n:"l10n",substitutions:"substitutions"}}),t})(),Ce=(()=>{class t{constructor(t,e){this.tabs=t,this.messaging=e,this.DEFAULT_POPUP_VIEW_KEY="default-popup-view",this._onInitialized=new u.x,this.onInitialized=this._onInitialized.asObservable(),this._onOpenSiteTab=new u.x,this.onOpenSiteTab=this._onOpenSiteTab.asObservable(),this._onOpenHowItWorks=new u.x,this.onOpenHowItWorks=this._onOpenHowItWorks.asObservable()}get accountPopoverMenu(){return this.ACCOUNT_POPOVER_MENU}get isMerchantContext(){return!!this._data.merchant}get flags(){return this.data.flags||0}get member(){const t=this._data?this._data.member:null;return t&&t.id?t:null}get data(){return this._data}get tabId(){return this._tabId||(this._tabId=this.data?this.data.tabId:0),this._tabId}init(){return(0,h.mG)(this,void 0,void 0,function*(){yield this.updateData(),this._onInitialized.next()})}updateData(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield this.sendBackgroundMessage(m.GetPopupData,{tabId:this.tabId});this._data=t})}sendBackgroundMessage(t,e){return(0,h.mG)(this,void 0,void 0,function*(){const n=new P(t,e);return yield this.messaging.sendBackgroundMessage(n)})}sendActivationMessage(){return(0,h.mG)(this,void 0,void 0,function*(){this.isMerchantContext&&(yield this.sendBackgroundMessage(m.Activate,{tabId:this.tabId,merchantId:this.data.merchant.id,pageId:X.PopupMerchantClick,urlType:C.Merchant}),yield this.updateData())})}getDefaultView(){return(0,h.mG)(this,void 0,void 0,function*(){let t=M.SHOP;if(!this.isMerchantContext){const e=yield this.sendBackgroundMessage(m.GetStorageItem,this.DEFAULT_POPUP_VIEW_KEY);e&&(t=e)}return t})}setAccountPopoverMenu(t){this.ACCOUNT_POPOVER_MENU=t}isFlagEnabled(t){return(this.flags&t)==t}isActivatedMerchantContext(){return this.isMerchantContext&&[Z.Activated,Z.Activating].includes(this.data.activationState)}openSiteTab(t,e){this._onOpenSiteTab.next({location:t,args:e})}openHowItWorks(){this._onOpenHowItWorks.next()}openTerms(){this.tabs.openProdegeTab("terms-of-use")}openPrivacy(){this.tabs.openProdegeTab("privacy-policy")}log(t,e,n){return(0,h.mG)(this,void 0,void 0,function*(){yield this.sendBackgroundMessage(m.Log,{level:e,message:t,extraInfo:n})})}refreshAccountBalance(){return(0,h.mG)(this,void 0,void 0,function*(){let t=null;const e=yield this.sendBackgroundMessage(m.RefreshAccountBalance);return e&&(this.member.lifetimeEarnings!==e.lifetimeEarnings&&(this._data.member.lifetimeEarnings=e.lifetimeEarnings),this.member.balance!==e.balance&&(this._data.member.balance=e.balance,t=e.balance)),t})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(oe),o.LFG(ge))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ye=(()=>(function(t){t[t.Login=0]="Login",t[t.Answer=1]="Answer",t[t.Merchant=2]="Merchant",t[t.PromoCodes=3]="PromoCodes",t[t.Registration=4]="Registration",t[t.FeaturedStores=5]="FeaturedStores"}(ye||(ye={})),ye))();let xe=(()=>{class t{constructor(t){this.el=t}ngOnInit(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield fetch(this.src),e=yield t.text();this.el.nativeElement.innerHTML=e})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(o.SBq))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-svg"]],inputs:{src:"src"},decls:0,vars:0,template:function(t,e){},styles:[""],encapsulation:2}),t})();function Me(t,e){1&t&&o._UZ(0,"p",2)}function Se(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",5),o.TgZ(1,"div",6),o._UZ(2,"div"),o.qZA(),o.TgZ(3,"div",7),o.TgZ(4,"b"),o._uU(5),o.qZA(),o.TgZ(6,"p"),o._uU(7),o.qZA(),o.qZA(),o.TgZ(8,"div",8),o.TgZ(9,"a",9),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(2).alertClicked(e.id)}),o._uU(10),o.qZA(),o.qZA(),o.TgZ(11,"div",10),o.TgZ(12,"shared-svg",11),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(2).dismissAlert(e.id)}),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit;o.xp6(5),o.Oqu(t.title),o.xp6(2),o.Oqu(t.text),o.xp6(3),o.Oqu(t.linkText)}}function Oe(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"a",12),o.NdJ("click",function(){return o.CHM(t),o.oxw(2).toggleAlertLimit()}),o._uU(1),o.qZA()}if(2&t){const t=o.oxw(2);o.xp6(1),o.Oqu(t.toggleAlertLimitText)}}function Pe(t,e){if(1&t&&(o.ynx(0),o.YNc(1,Se,13,3,"div",3),o.ALo(2,"slice"),o.YNc(3,Oe,2,1,"a",4),o.BQk()),2&t){const t=o.oxw();o.xp6(1),o.Q6J("ngForOf",t.shouldShowAllAlerts?t.alerts:o.Dn7(2,2,t.alerts,0,t.ALERT_LIMIT)),o.xp6(2),o.Q6J("ngIf",t.alerts.length>2)}}const we=function(t){return[t]};function Ae(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",17),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(2).surveyClicked(e)}),o._UZ(1,"div",18),o.TgZ(2,"div",19),o._UZ(3,"b",20),o.TgZ(4,"span"),o._uU(5),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw(2);o.xp6(1),o.Q6J("substitutions",o.VKq(3,we,n.formatReward(t))),o.xp6(2),o.Q6J("substitutions",o.VKq(5,we,t.loi)),o.xp6(2),o.hij("Survey #",t.srvId,"")}}function Ie(t,e){if(1&t){const t=o.EpF();o.ynx(0),o.TgZ(1,"div",13),o._UZ(2,"h1",14),o.TgZ(3,"a",15),o.NdJ("click",function(){return o.CHM(t),o.oxw().viewAll()}),o.qZA(),o.qZA(),o.YNc(4,Ae,6,7,"div",16),o.BQk()}if(2&t){const t=o.oxw();o.xp6(4),o.Q6J("ngForOf",t.surveys)}}let ke=(()=>{class t{constructor(t,e,n,i){this.tabs=t,this.popup=e,this.config=n,this.browser=i,this.SHOW_MORE_ALERTS="popup_answer_more_alerts",this.ALERT_LIMIT=2,this.alerts=[],this.surveys=[]}ngOnInit(){this.alerts=this.popup.data.notifications.filter(t=>t.type===ot.Survey),this.surveys=this.popup.member.surveys,this.toggleAlertLimitText=this.browser.getLocalizedMessage(this.SHOW_MORE_ALERTS)}processNotification(t,e){return(0,h.mG)(this,void 0,void 0,function*(){const n=this.alerts.findIndex(t=>t.id===e);this.alerts.splice(n,1),yield this.popup.sendBackgroundMessage(t,e),yield this.popup.updateData()})}alertClicked(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.processNotification(m.NotificationClicked,t)})}dismissAlert(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.processNotification(m.NotificationRemoveClicked,t)})}toggleAlertLimit(){this.shouldShowAllAlerts=!this.shouldShowAllAlerts,this.toggleAlertLimitText=this.browser.getLocalizedMessage(this.shouldShowAllAlerts?"popup_answer_less_alerts":this.SHOW_MORE_ALERTS)}viewAll(){this.popup.openSiteTab(Mt.Answer)}formatReward(t){return this.config.formatAccountBalance(t.sb)}surveyClicked(t){this.tabs.openNewTab(t.url,!0)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(oe),o.Y36(Ce),o.Y36(Dt),o.Y36(Ht))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-answer"]],decls:3,vars:3,consts:[["class","no-surveys","l10n","popup_answer_no_surveys",4,"ngIf"],[4,"ngIf"],["l10n","popup_answer_no_surveys",1,"no-surveys"],["class","alert",4,"ngFor","ngForOf"],["class","alert-limit-toggle",3,"click",4,"ngIf"],[1,"alert"],[1,"status"],[1,"text"],[1,"link"],[3,"click"],[1,"x"],["src","assets/redesign/icons/x.svg",3,"click"],[1,"alert-limit-toggle",3,"click"],[1,"title"],["l10n","popup_answer_title"],["l10n","popup_answer_view_all",3,"click"],["class","card survey",3,"click",4,"ngFor","ngForOf"],[1,"card","survey",3,"click"],["l10n","popup_answer_survey_reward",1,"reward",3,"substitutions"],[1,"info"],["l10n","popup_answer_survey_time",3,"substitutions"]],template:function(t,e){1&t&&(o.YNc(0,Me,1,0,"p",0),o.YNc(1,Pe,4,6,"ng-container",1),o.YNc(2,Ie,5,1,"ng-container",1)),2&t&&(o.Q6J("ngIf",!e.alerts.length&&!e.surveys.length),o.xp6(1),o.Q6J("ngIf",e.alerts.length),o.xp6(1),o.Q6J("ngIf",e.surveys.length))},directives:[d.O5,_e,d.sg,xe],pipes:[d.OU],styles:["[_nghost-%COMP%]{flex-grow:1}.no-surveys[_ngcontent-%COMP%]{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;flex-grow:1;text-align:center;font-size:14px;line-height:18px;margin-bottom:16px}.alert[_ngcontent-%COMP%]{padding:10px;display:flex;border-bottom:solid 1px var(--gray)}.alert[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{display:flex;align-items:center;padding-right:15px}.alert[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:5px}.alert[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex-grow:1}.alert[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:3px 0 0}.alert[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{display:flex;align-items:center;margin:0}.alert[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{padding:5px 20px;font-weight:bold}.alert[_ngcontent-%COMP%]   .x[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:10px}.alert[_ngcontent-%COMP%]   .x[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{cursor:pointer;fill:var(--default)}.alert-limit-toggle[_ngcontent-%COMP%]{display:block;margin-top:10px;margin-left:35px}.title[_ngcontent-%COMP%]{overflow:auto;margin-bottom:10px;margin-top:15px}.title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:normal;font-size:14px;margin:0;color:var(--default-darker);float:left}.title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:right}.survey[_ngcontent-%COMP%]{cursor:pointer}.survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-grow:1;flex-direction:column;justify-content:center;margin-left:10px;line-height:20px}.survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{display:block;font-size:14px}.survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--default-darker);font-size:12px}"]}),t})();class Te{constructor(){this.AuthType={Login:0,Registration:1}}init(t,e,n,i){let o;this.type=t,this._popup=e,this._browser=i,this._renderer=n,this.isDismissible=this._popup.isMerchantContext,this.usernamePlaceholder=this._browser.getLocalizedMessage("popup_auth_username_placeholder"),this.passwordPlaceholder=this._browser.getLocalizedMessage("popup_auth_password_placeholder"),t===this.AuthType.Login?(o="popup_auth_login_error",this.name="Login",this.runtimeMessageType=m.Login):(o="popup_auth_signup_error",this.name="Register",this.runtimeMessageType=m.Register),this.genericError=this._browser.getLocalizedMessage(o)}onUsernameChanged(t){this.username=t}onPasswordChanged(t){this.password=t}clear(){this.error=null,this.usernameError=!1}validateUsername(){let t=!0;return this.username||(this.error=this._browser.getLocalizedMessage("popup_auth_error_user_blank"),this.usernameError=!0,t=!1),t}validatePassword(){var t;let e=!0;const n=this._browser.getLocalizedMessage("restrictedPasswords");return this.password?(null===(t=this.password.match(/(?!^[0-9]*$)(?!^[a-zA-Z]*$)^([a-zA-Z0-9]{8,32})$/))||void 0===t?void 0:t.length)?n.split(",").find(t=>this.password.toLowerCase()===t)&&(this.error=this._browser.getLocalizedMessage("popup_auth_error_pass_insecure")):this.error=this._browser.getLocalizedMessage("popup_auth_error_pass_constraints"):this.error=this._browser.getLocalizedMessage("popup_auth_error_pass_blank"),this.error&&(this.passwordError=!0,e=!1),e}throwError(t,e){this.error=this.genericError,this._popup.log(`${this.name} failed`,t,e)}authenticate(t){return(0,h.mG)(this,void 0,void 0,function*(){let e;const n=Object.assign({email:this.username},t);try{e=yield this._popup.sendBackgroundMessage(this.runtimeMessageType,n),e&&0===e.status?(this._popup.isActivatedMerchantContext()&&(yield this._popup.sendActivationMessage()),yield this._popup.updateData(),this._renderer.renderDefaultView()):yield this.throwError(f.Debug,"response.status is not 0")}catch(i){yield this.throwError(f.Error,i)}})}dismiss(){this._renderer.renderDefaultView()}}const Ee=function(t){return{error:t}},Re=function(t){return{position:t}};function Le(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",1),o._UZ(1,"span",2),o.TgZ(2,"shared-svg",3),o.NdJ("click",function(){return o.CHM(t),o.oxw().hide()}),o.qZA(),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("ngClass",o.VKq(3,Ee,"error"===t.type))("ngStyle",o.VKq(5,Re,t.position)),o.xp6(1),o.Q6J("innerHtml",t.message,o.oJD)}}let Ge=(()=>{class t{constructor(){this.position="absolute"}ngOnInit(){}hide(){this.message=null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-alert"]],inputs:{type:"type",message:"message",position:"position"},decls:1,vars:1,consts:[["class","alert",3,"ngClass","ngStyle",4,"ngIf"],[1,"alert",3,"ngClass","ngStyle"],[3,"innerHtml"],["src","assets/redesign/icons/x.svg",3,"click"]],template:function(t,e){1&t&&o.YNc(0,Le,3,7,"div",0),2&t&&o.Q6J("ngIf",e.message)},directives:[d.O5,d.mk,d.PC,xe],styles:[".alert[_ngcontent-%COMP%]{width:100%;height:67px;position:absolute;top:0;left:0;display:flex;align-items:center;border-radius:4px;background:white;color:var(--default)}.alert[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex-grow:1;margin-left:20px;font-size:14px;padding-left:20px}.alert[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{cursor:pointer;width:14px;height:14px;margin-right:20px;fill:var(--default)}.alert.error[_ngcontent-%COMP%]{background:var(--error);color:#fff}.alert.error[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{fill:#fff}"]}),t})();const Ne=function(t){return{error:t}};let De=(()=>{class t{constructor(){this.type="text",this.changed=new o.vpe}ngOnInit(){}onChange(t){this.changed.next(t.target.value)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-form-field"]],inputs:{icon:"icon",type:"type",error:"error",placeholder:"placeholder"},outputs:{changed:"changed"},decls:4,vars:6,consts:[[1,"input",3,"ngClass"],[1,"icon"],[3,"src"],[3,"type","placeholder","change"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o._UZ(2,"img",2),o.qZA(),o.TgZ(3,"input",3),o.NdJ("change",function(t){return e.onChange(t)}),o.qZA(),o.qZA()),2&t&&(o.Q6J("ngClass",o.VKq(4,Ne,e.error)),o.xp6(2),o.Q6J("src",e.icon,o.LSH),o.xp6(1),o.Q6J("type",e.type)("placeholder",e.placeholder))},directives:[d.mk],styles:["[_ngcontent-%COMP%]:root{--gray: #AAAAAA;--light-gray: #DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#F5F5F5}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{color:#fff;background:var(--bg-gradient)}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]{border-right:solid 1px white}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;font-size:14px;line-height:18px;border-radius:4px;cursor:pointer;border:0}button.primary[_ngcontent-%COMP%]:focus, button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:none}button.primary[_ngcontent-%COMP%]:disabled, button.secondary[_ngcontent-%COMP%]:disabled{border:0;cursor:not-allowed}button.primary[_ngcontent-%COMP%]{background:var(--primary);padding:15px}button.primary[_ngcontent-%COMP%]:disabled{background:var(--primary-light);color:var(--primary)}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);color:var(--secondary)}button.login[_ngcontent-%COMP%]{align-self:center;display:block!important;position:absolute;right:16px;background-color:#fff;color:var(--primary);border-radius:50px;border:1px solid var(--primary);font-size:14px;list-style:16px;font-weight:700;text-align:center;min-width:130px;height:32px;cursor:pointer}.card[_ngcontent-%COMP%]{background:white;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:32px}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:normal}shared-register[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--default-dark);font-size:14px}shared-register[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:100%;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-register[_ngcontent-%COMP%]   a.login[_ngcontent-%COMP%]{text-decoration:underline}shared-login[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:normal;margin:0 0 15px;color:var(--default-dark);text-align:left}shared-login[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:-moz-fit-content;width:fit-content;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-merchant[_ngcontent-%COMP%]   .merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{font-weight:bold}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]{padding-bottom:10px}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]   .coupon-count[_ngcontent-%COMP%]{font-size:14px}shared-merchant[_ngcontent-%COMP%]   .no-coupons[_ngcontent-%COMP%]{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;background:var(--primary-light);flex-grow:1}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:110px;height:110px;border:1px solid var(--primary-light);border-radius:8px;margin-right:16px;text-transform:uppercase;flex-shrink:0}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{flex-basis:100%}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .tagline[_ngcontent-%COMP%]{background-color:var(--primary-light);color:#fff;font-size:12px;font-weight:600;line-height:24px;text-align:center;border-radius:0 0 8px 8px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:16px;line-height:24px;font-weight:bold;align-items:center;justify-content:center;display:flex;box-shadow:0 3.36667px 10.1px #8883}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:var(--tertiary-light);border:1px solid var(--tertiary);border-radius:20px;font-weight:bold;height:40px;width:100%;position:relative}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;background:var(--primary-light);border:1px solid var(--primary-light);border-radius:50px;color:var(--primary);height:40px;width:calc(100% - 30px)}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:-4px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .expiration[_ngcontent-%COMP%]{color:var(--text-inactivated);font-size:10px;font-weight:600}shared-answer[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{background:var(--error)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:white;border-radius:4px;color:var(--primary);border:solid 1px var(--primary)}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{background:var(--secondary-light);color:var(--secondary);width:130px;padding-top:15px;padding-bottom:15px;font-size:24px;font-weight:bold;text-align:center}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}shared-featured-stores[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .alert-title[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{border:dashed 1px var(--primary);background:var(--primary-light);color:var(--primary-dark)}shared-promo-codes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-bottom:15px}shared-promo-codes[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--secondary)}shared-alert[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}[_nghost-%COMP%]{display:block}.input[_ngcontent-%COMP%]{background:white;border:solid 1px var(--light-gray);border-radius:4px;display:flex;max-height:48px}.input[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{border-right:solid 1px var(--light-gray);padding:0 10px;margin-top:12px;margin-bottom:12px}.input[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:25px;height:25px}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex-grow:1;font-size:14px;border:none;outline:none;color:var(--default);margin-left:10px;margin-right:10px}.input.error[_ngcontent-%COMP%]{border-color:var(--error)}"]}),t})();function Fe(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"shared-svg",11),o.NdJ("click",function(){return o.CHM(t),o.oxw().dismiss()}),o.qZA()}}let Ue=(()=>{class t extends Te{constructor(t,e,n){super(),this.popup=t,this.browser=e,this.renderer=n}ngOnInit(){this.init(this.AuthType.Login,this.popup,this.renderer,this.browser)}submit(){return(0,h.mG)(this,void 0,void 0,function*(){this.clear(),this.passwordError=!1,this.validateUsername()&&(yield this.authenticate({password:this.password}))})}forgotPassword(){this.popup.openSiteTab(Mt.ForgotPassword)}register(){this.renderer.renderContext(ye.Registration)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ce),o.Y36(Ht),o.Y36(Mn))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-login"]],features:[o.qOj],decls:11,vars:6,consts:[["type","error",3,"message"],["src","assets/redesign/icons/x.svg",3,"click",4,"ngIf"],[3,"ngSubmit"],["l10n","popup_auth_log_in"],["icon","assets/redesign/icons/avatar.svg",3,"error","placeholder","changed"],["icon","assets/redesign/icons/locked.svg","type","password",3,"error","placeholder","changed"],["type","submit","l10n","popup_auth_log_in",1,"primary"],["l10n","popup_auth_forgot_password",1,"forgot",3,"click"],[1,"sign-up"],["l10n","popup_auth_no_account"],["l10n","popup_auth_sign_up",3,"click"],["src","assets/redesign/icons/x.svg",3,"click"]],template:function(t,e){1&t&&(o._UZ(0,"shared-alert",0),o.YNc(1,Fe,1,0,"shared-svg",1),o.TgZ(2,"form",2),o.NdJ("ngSubmit",function(){return e.submit()}),o._UZ(3,"h1",3),o.TgZ(4,"shared-form-field",4),o.NdJ("changed",function(t){return e.onUsernameChanged(t)}),o.qZA(),o.TgZ(5,"shared-form-field",5),o.NdJ("changed",function(t){return e.onPasswordChanged(t)}),o.qZA(),o._UZ(6,"button",6),o.TgZ(7,"a",7),o.NdJ("click",function(){return e.forgotPassword()}),o.qZA(),o.TgZ(8,"div",8),o._UZ(9,"span",9),o.TgZ(10,"a",10),o.NdJ("click",function(){return e.register()}),o.qZA(),o.qZA(),o.qZA()),2&t&&(o.Q6J("message",e.error),o.xp6(1),o.Q6J("ngIf",e.isDismissible),o.xp6(3),o.Q6J("error",e.usernameError)("placeholder",e.usernamePlaceholder),o.xp6(1),o.Q6J("error",e.passwordError)("placeholder",e.passwordPlaceholder))},directives:[Ge,d.O5,r._Y,r.JL,r.F,_e,De,xe],styles:['[_nghost-%COMP%]{display:flex;flex-grow:1;justify-content:center;position:relative}shared-svg[_ngcontent-%COMP%]{position:absolute;right:8px;font-size:20px;cursor:pointer}form[_ngcontent-%COMP%]{margin:75px 20px 20px;flex-grow:1;text-align:center}form[_ngcontent-%COMP%]   shared-form-field[_ngcontent-%COMP%]{margin-bottom:15px}form[_ngcontent-%COMP%]   .sign-up[_ngcontent-%COMP%]{font-size:14px;margin-top:15px}form[_ngcontent-%COMP%]   .sign-up[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:after{content:" "}']}),t})();function Ze(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"shared-svg",10),o.NdJ("click",function(){return o.CHM(t),o.oxw().dismiss()}),o.qZA()}}function qe(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"shared-form-field",11),o.NdJ("changed",function(e){return o.CHM(t),o.oxw().onPasswordChanged(e)}),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("error",t.passwordError)("placeholder",t.passwordPlaceholder)}}let He=(()=>{class t extends Te{constructor(t,e,n,i){super(),this.el=t,this.popup=e,this.browser=n,this.renderer=i}ngOnInit(){this.init(this.AuthType.Registration,this.popup,this.renderer,this.browser),this.heading=this.browser.getSanitizedLocalizedMessage("popup_auth_signup_heading"),this.passwordRequired=this.popup.isFlagEnabled(M.REQUIRE_REG_PWD),setTimeout(()=>{this.el.nativeElement.querySelector(".terms").onclick=()=>{this.popup.openTerms()},this.el.nativeElement.querySelector(".privacy").onclick=()=>{this.popup.openPrivacy()}})}submit(){return(0,h.mG)(this,void 0,void 0,function*(){if(this.clear(),this.validateUsername()&&(!this.passwordRequired||this.validatePassword())){const t=this.passwordRequired?{password:this.password}:null;yield this.authenticate(t)}})}login(){this.renderer.renderContext(ye.Login)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(o.SBq),o.Y36(Ce),o.Y36(Ht),o.Y36(Mn))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-register"]],features:[o.qOj],decls:10,vars:6,consts:[["type","error",3,"message"],["src","assets/redesign/icons/x.svg",3,"click",4,"ngIf"],[3,"ngSubmit"],[1,"heading",3,"innerHtml"],["l10n","popup_auth_signup_subheading"],["icon","assets/redesign/icons/avatar.svg",3,"error","placeholder","changed"],["icon","assets/redesign/icons/locked.svg","type","password",3,"error","placeholder","changed",4,"ngIf"],["type","submit","l10n","popup_auth_signup_submit",1,"primary"],["l10n","popup_auth_signup_already_member",1,"login",3,"click"],["l10n","popup_auth_signup_agreement",1,"agreement"],["src","assets/redesign/icons/x.svg",3,"click"],["icon","assets/redesign/icons/locked.svg","type","password",3,"error","placeholder","changed"]],template:function(t,e){1&t&&(o._UZ(0,"shared-alert",0),o.YNc(1,Ze,1,0,"shared-svg",1),o.TgZ(2,"form",2),o.NdJ("ngSubmit",function(){return e.submit()}),o._UZ(3,"div",3),o._UZ(4,"p",4),o.TgZ(5,"shared-form-field",5),o.NdJ("changed",function(t){return e.onUsernameChanged(t)}),o.qZA(),o.YNc(6,qe,1,2,"shared-form-field",6),o._UZ(7,"button",7),o.TgZ(8,"a",8),o.NdJ("click",function(){return e.login()}),o.qZA(),o._UZ(9,"div",9),o.qZA()),2&t&&(o.Q6J("message",e.error),o.xp6(1),o.Q6J("ngIf",e.isDismissible),o.xp6(2),o.Q6J("innerHtml",e.heading,o.oJD),o.xp6(2),o.Q6J("error",e.usernameError)("placeholder",e.usernamePlaceholder),o.xp6(1),o.Q6J("ngIf",e.passwordRequired))},directives:[Ge,d.O5,r._Y,r.JL,r.F,_e,De,xe],styles:['[_nghost-%COMP%]{display:flex;flex-grow:1;justify-content:center;position:relative;width:100%}shared-svg[_ngcontent-%COMP%]{position:absolute;right:8px;font-size:20px;cursor:pointer}form[_ngcontent-%COMP%]{margin:75px 20px 20px;flex-grow:1;text-align:center}form[_ngcontent-%COMP%]   shared-form-field[_ngcontent-%COMP%]{margin-bottom:15px}form[_ngcontent-%COMP%]   .agreement[_ngcontent-%COMP%]{margin-top:20px;color:var(--default-dark)}form[_ngcontent-%COMP%]   .agreement[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:after{content:" "}shared-alert[_ngcontent-%COMP%]{z-index:999}']}),t})();function ze(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",1),o.TgZ(1,"img",2),o.NdJ("click",function(){return o.CHM(t),o.oxw().openTab()}),o.qZA(),o.qZA()}if(2&t){const t=o.oxw();o.xp6(1),o.Q6J("src",t.featuredOfferPlacement.imageUrl,o.LSH)}}let je=(()=>{class t{constructor(t,e){this.popup=t,this.tabs=e}ngOnInit(){return(0,h.mG)(this,void 0,void 0,function*(){this.featuredOfferPlacement=yield this.popup.sendBackgroundMessage(m.GetFeaturedOfferPlacement),this.showFeaturedOfferPlacement=!!this.featuredOfferPlacement.imageUrl})}openTab(){return(0,h.mG)(this,void 0,void 0,function*(){this.tabs.openNewTab(this.featuredOfferPlacement.clickUrl,!0)})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ce),o.Y36(oe))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-featured-offer-placement"]],decls:1,vars:1,consts:[["class","offer",4,"ngIf"],[1,"offer"],[1,"center",3,"src","click"]],template:function(t,e){1&t&&o.YNc(0,ze,2,1,"div",0),2&t&&o.Q6J("ngIf",e.showFeaturedOfferPlacement)},directives:[d.O5],styles:["img[_ngcontent-%COMP%]{min-height:20px;min-width:20px;cursor:pointer;padding-bottom:15px}.center[_ngcontent-%COMP%]{display:block;margin-left:auto;margin-right:auto}"]}),t})();const Je=function(t,e){return[t,e]};function $e(t,e){if(1&t&&o._UZ(0,"span",5),2&t){const t=o.oxw();o.Q6J("l10n",t.reward.showUpTo?"popup_merchant_currency_per_up_to":"popup_merchant_currency_per")("substitutions",o.WLB(2,Je,t.reward.amount,t.currency))}}let Be=(()=>{class t{constructor(t,e,n,i,o){this.tabs=t,this.config=e,this.merchants=n,this.locations=i,this.sanitizer=o}ngOnInit(){this.reward=this.merchant.reward,this.showDescription=this.config.hasPseudoCurrency&&this.config.client!==y.mp&&!this.merchant.reward.isFlat,this.imageUrl=this.merchant.img,this.rewardString=this.sanitizer.sanitize(o.q3G.HTML,`${this.merchants.constructRewardString({reward:this.merchant.reward,clientId:this.config.client,locationId:this.merchant.loc})}`);const t=this.locations.getLocation(this.merchant.loc);this.currency=t.currencySymbol}openTab(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield this.tabs.constructRedirectUrl(this.merchant,null,X.PopupFeaturedMerchantClick);this.tabs.openNewTab(t,!0)})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(oe),o.Y36(Dt),o.Y36(ee),o.Y36(te),o.Y36(i.H7))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-featured-store"]],inputs:{merchant:"merchant"},decls:7,vars:3,consts:[[1,"card"],[1,"logo"],[3,"src","click"],[1,"info",3,"click"],[3,"l10n","substitutions",4,"ngIf"],[3,"l10n","substitutions"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"img",2),o.NdJ("click",function(){return e.openTab()}),o.qZA(),o.qZA(),o.TgZ(3,"div",3),o.NdJ("click",function(){return e.openTab()}),o.TgZ(4,"h2"),o._uU(5),o.qZA(),o.YNc(6,$e,1,5,"span",4),o.qZA(),o.qZA()),2&t&&(o.xp6(2),o.Q6J("src",e.imageUrl,o.LSH),o.xp6(3),o.Oqu(e.rewardString),o.xp6(1),o.Q6J("ngIf",e.showDescription))},directives:[d.O5,_e],styles:[".card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:129px;height:64px;display:flex;justify-content:center}.card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:pointer;align-self:center;max-height:60px;max-width:120px}.card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;margin-left:20px;justify-content:center;cursor:pointer;text-transform:capitalize}.card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:18px}.card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--primary);font-size:14px;font-weight:bold;margin:0}.card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--default-darker)}"]}),t})();function Ye(t,e){1&t&&o._UZ(0,"shared-featured-store",4),2&t&&o.Q6J("merchant",e.$implicit)}let We=(()=>{class t{constructor(t){this.popup=t,this.featuredMerchants=[]}ngOnInit(){return(0,h.mG)(this,void 0,void 0,function*(){this.featuredMerchants=yield this.popup.sendBackgroundMessage(m.GetFeaturedMerchants)})}viewAll(){this.popup.openSiteTab(Mt.Stores)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ce))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-featured-stores"]],decls:5,vars:1,consts:[[1,"title"],["l10n","popup_featured_stores"],["l10n","popup_featured_stores_view_all",3,"click"],[3,"merchant",4,"ngFor","ngForOf"],[3,"merchant"]],template:function(t,e){1&t&&(o._UZ(0,"shared-featured-offer-placement"),o.TgZ(1,"div",0),o._UZ(2,"h1",1),o.TgZ(3,"a",2),o.NdJ("click",function(){return e.viewAll()}),o.qZA(),o.qZA(),o.YNc(4,Ye,1,1,"shared-featured-store",3)),2&t&&(o.xp6(4),o.Q6J("ngForOf",e.featuredMerchants))},directives:[je,_e,d.sg,Be],styles:["[_nghost-%COMP%]{flex-grow:1}.title[_ngcontent-%COMP%]{overflow:auto;margin-bottom:10px}.title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:normal;font-size:14px;margin:0;color:var(--default-darker);float:left}.title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:right}"]}),t})();class Qe{static toggleFade(t,e){e.style.opacity="0",setTimeout(()=>{t.style.opacity="1",setTimeout(()=>{t.style.opacity="0",setTimeout(()=>{e.style.opacity="1"},500)},2e3)},500)}}const Ve=["code"],Ke=["copied"];function Xe(t,e){1&t&&(o.TgZ(0,"div",16),o._UZ(1,"div",17),o._UZ(2,"img",18),o.qZA())}function tn(t,e){if(1&t&&(o.TgZ(0,"div",19),o._UZ(1,"span",20),o._uU(2),o.qZA()),2&t){const t=o.oxw();o.xp6(2),o.hij(" ",t.expirationDate()," ")}}const en=function(t){return{peeled:t}},nn=function(t){return{right:t}};let on=(()=>{class t{constructor(t){this.browser=t,this.clicked=new o.vpe}ngOnInit(){}onClick(){return(0,h.mG)(this,void 0,void 0,function*(){$.copyTextToClipboard(this.coupon.code),this.peeled||this.clicked.next(),Qe.toggleFade(this.copied.nativeElement,this.code.nativeElement)})}discountValue(){return this.coupon.discountValue&&this.coupon.discountLabel?this.coupon.discountValue:`${this.browser.getLocalizedMessage("popup_merchant_coupon_callout_default_discount_value")}`}discountLabel(){return this.coupon.discountValue&&this.coupon.discountLabel?this.coupon.discountLabel:`${this.browser.getLocalizedMessage("popup_merchant_coupon_callout_default_discount_label")}`}expirationDate(){try{let t=Date.parse(this.coupon.expires);return new Intl.DateTimeFormat([],{dateStyle:"short"}).format(t)}catch(t){return""}}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ht))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-coupon"]],viewQuery:function(t,e){if(1&t&&(o.Gf(Ve,5,o.SBq),o.Gf(Ke,5,o.SBq)),2&t){let t;o.iGM(t=o.CRH())&&(e.code=t.first),o.iGM(t=o.CRH())&&(e.copied=t.first)}},inputs:{peeled:"peeled",coupon:"coupon"},outputs:{clicked:"clicked"},decls:20,vars:12,consts:[[1,"coupon","card"],[1,"callout"],[1,"discount"],[1,"value"],[1,"label"],["l10n","popup_merchant_coupon_callout_discount_tagline",1,"tagline"],[1,"info"],[1,"description"],[1,"button",3,"click"],[1,"text",3,"ngClass"],[1,"code",3,"ngClass"],["code",""],["l10n","copied",1,"copied"],["copied",""],["class","peel",4,"ngIf"],["class","expiration",4,"ngIf"],[1,"peel"],["l10n","popup_merchant_coupon_get_code"],["src","assets/redesign/images/coupon-peel.png"],[1,"expiration"],["l10n","popup_merchant_coupon_expiration_abbreviation"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"div",2),o.TgZ(3,"span",3),o._uU(4),o.qZA(),o.TgZ(5,"span",4),o._uU(6),o.qZA(),o.qZA(),o._UZ(7,"div",5),o.qZA(),o.TgZ(8,"div",6),o.TgZ(9,"span",7),o._uU(10),o.qZA(),o.TgZ(11,"div",8),o.NdJ("click",function(){return e.onClick()}),o.TgZ(12,"div",9),o.TgZ(13,"span",10,11),o._uU(15),o.qZA(),o._UZ(16,"span",12,13),o.qZA(),o.YNc(18,Xe,3,0,"div",14),o.qZA(),o.YNc(19,tn,3,1,"div",15),o.qZA(),o.qZA()),2&t&&(o.xp6(4),o.Oqu(e.discountValue()),o.xp6(2),o.Oqu(e.discountLabel()),o.xp6(4),o.Oqu(e.coupon.description),o.xp6(2),o.Q6J("ngClass",o.VKq(8,en,e.peeled)),o.xp6(1),o.Q6J("ngClass",o.VKq(10,nn,!e.peeled)),o.xp6(2),o.Oqu(e.coupon.code),o.xp6(3),o.Q6J("ngIf",!e.peeled),o.xp6(1),o.Q6J("ngIf",e.coupon.expires))},directives:[_e,d.mk,d.O5],styles:[".coupon[_ngcontent-%COMP%]{display:flex}.coupon.card[_ngcontent-%COMP%]{padding:8px}.coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]{color:var(--primary);font-size:24px;line-height:30px;font-weight:800;display:flex;flex-wrap:wrap;flex-basis:100%;align-content:center;align-items:center;text-align:center}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{flex-grow:1}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:14px}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{display:flex;height:46px;position:relative;margin-top:10px;margin-bottom:6px;cursor:pointer}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;transition:opacity 1s}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   span.right[_ngcontent-%COMP%]{right:10px}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .copied[_ngcontent-%COMP%]{opacity:0;text-transform:uppercase}.coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]{position:absolute;top:0;left:0;display:flex;flex-direction:row;width:100%}"]}),t})();const rn=function(t,e){return[t,e]};function sn(t,e){if(1&t&&o._UZ(0,"div",9),2&t){const t=o.oxw(2);o.Q6J("l10n",t.pseudoCurrencyPerMsg)("substitutions",o.WLB(2,rn,t.reward.amount,t.currency))}}function an(t,e){1&t&&o._UZ(0,"div",10)}const cn=function(t){return{activated:t}};function ln(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",5),o.TgZ(1,"button",6),o.NdJ("click",function(){return o.CHM(t),o.oxw().activate()}),o._uU(2),o.qZA(),o.YNc(3,sn,1,5,"div",7),o.YNc(4,an,1,0,"div",8),o.qZA()}if(2&t){const t=o.oxw();o.xp6(1),o.Q6J("ngClass",o.VKq(5,cn,t.activated))("disabled",t.member&&t.activated),o.xp6(1),o.Oqu(t.rewardString),o.xp6(1),o.Q6J("ngIf",t.pseudoCurrencyPerMsg),o.xp6(1),o.Q6J("ngIf",!t.member)}}function dn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"shared-coupon",14),o.NdJ("clicked",function(){return o.CHM(t),o.oxw(2).onCouponClicked()}),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw(2);o.Q6J("coupon",t)("peeled",n.activated)}}function hn(t,e){if(1&t&&(o.TgZ(0,"div",11),o._UZ(1,"div",12),o.YNc(2,dn,1,2,"shared-coupon",13),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.Q6J("l10n",1===t.coupons.length?"popup_merchant_coupon_count":"popup_merchant_coupon_count_plural")("substitutions",t.coupons.length.toString()),o.xp6(1),o.Q6J("ngForOf",t.coupons)}}function un(t,e){1&t&&(o.TgZ(0,"div",15),o._UZ(1,"div",16),o._UZ(2,"img",17),o.qZA())}let gn=(()=>{class t{constructor(t,e,n,i,o,r,s){this.popup=t,this.config=e,this.browser=n,this.renderer=i,this.merchants=o,this.locations=r,this.sanitizer=s,this.coupons=[]}get merchant(){return this.popup.data.merchant}get member(){return this.popup.member}ngOnInit(){if(this.reward=this.merchant.reward,this.coupons=this.merchant.coupons,this.hasPseudoCurrency=this.config.hasPseudoCurrency,this.imageUrl=this.merchant.img,this.name=this.merchant.name,this.currency=this.locations.getLocation(this.merchant.loc).currencySymbol,this.member&&this.hasPseudoCurrency&&!this.reward.isFlat){let t=this.reward.showUpTo?"popup_merchant_earn_currency_per_up_to":"popup_merchant_earn_currency_per";this.config.client===y.mp&&1===this.reward.amount&&(t+="_singular"),this.pseudoCurrencyPerMsg=t}this.updateActivationState()}updateActivationState(){return(0,h.mG)(this,void 0,void 0,function*(){this.popup.isActivatedMerchantContext()&&(this.activated=!0,this.peeled=!0);let t=this.merchants.constructActivateString({reward:this.merchant.reward,clientId:this.config.client,locationId:this.merchant.loc,activated:this.activated});this.rewardString=this.sanitizer.sanitize(o.q3G.HTML,t)})}activate(){return(0,h.mG)(this,void 0,void 0,function*(){this.popup.isActivatedMerchantContext()||(yield this.popup.sendActivationMessage(),yield this.updateActivationState()),this.popup.member||this.renderer.renderContext(ye.Registration)})}onCouponClicked(){return(0,h.mG)(this,void 0,void 0,function*(){this.activated||(yield this.activate())})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ce),o.Y36(Dt),o.Y36(Ht),o.Y36(Mn),o.Y36(ee),o.Y36(te),o.Y36(i.H7))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-merchant"]],decls:6,vars:5,consts:[[1,"merchant","card"],[3,"src","alt"],["class","info",4,"ngIf"],["class","coupons",4,"ngIf","ngIfElse"],["noCoupons",""],[1,"info"],[1,"secondary",3,"ngClass","disabled","click"],["class","reward",3,"l10n","substitutions",4,"ngIf"],["class","nonmember","l10n","popup_merchant_nonmember_offer",4,"ngIf"],[1,"reward",3,"l10n","substitutions"],["l10n","popup_merchant_nonmember_offer",1,"nonmember"],[1,"coupons"],[1,"coupon-count",3,"l10n","substitutions"],[3,"coupon","peeled","clicked",4,"ngFor","ngForOf"],[3,"coupon","peeled","clicked"],[1,"no-coupons"],["l10n","popup_merchant_no_coupons"],["src","assets/redesign/images/no-coupons.png"]],template:function(t,e){if(1&t&&(o.TgZ(0,"div",0),o._UZ(1,"img",1),o.YNc(2,ln,5,7,"div",2),o.qZA(),o.YNc(3,hn,3,3,"div",3),o.YNc(4,un,3,0,"ng-template",null,4,o.W1O)),2&t){const t=o.MAs(5);o.xp6(1),o.Q6J("src",e.imageUrl,o.LSH)("alt",e.name),o.xp6(1),o.Q6J("ngIf",e.reward.amount),o.xp6(1),o.Q6J("ngIf",e.coupons.length)("ngIfElse",t)}},directives:[d.O5,d.mk,_e,d.sg,on],styles:['[_nghost-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.merchant[_ngcontent-%COMP%]{border-radius:5px;padding:10px;margin-bottom:10px;justify-content:center}.merchant.card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:120px;align-self:center}.merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-grow:1;flex-direction:column;justify-content:center;margin-left:10px;font-size:14px}.merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px}.merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]:before{content:" "}.merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .nonmember[_ngcontent-%COMP%]{font-size:12px;font-weight:600;text-align:center}.coupons[_ngcontent-%COMP%]{padding-bottom:10px}.coupons[_ngcontent-%COMP%]   .coupon-count[_ngcontent-%COMP%]{font-size:14px}.no-coupons[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-align:center;font-size:16px;line-height:20px;margin-bottom:16px;font-weight:bold}']}),t})(),pn=(()=>{class t{constructor(){this._onShow=new u.x,this.onShow=this._onShow.asObservable(),this._onClose=new u.x,this.onClose=this._onClose.asObservable()}show(t,e){this._onShow.next({content:t,targetBounds:e})}close(){this._onClose.next()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),mn=(()=>{class t{constructor(t,e){this.svc=t,this.el=e}ngOnInit(){this.el.nativeElement.addEventListener("click",()=>{this.onClick()})}onClick(){this.svc.show(this.popover,this.el.nativeElement.getBoundingClientRect())}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pn),o.Y36(o.SBq))},t.\u0275dir=o.lG2({type:t,selectors:[["","popover",""]],inputs:{popover:"popover"}}),t})();const fn=["alertElement"],vn=["copiedElement"];function bn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",11),o.NdJ("click",function(){return o.CHM(t),o.oxw().alertClicked()}),o._UZ(1,"p",12,13),o._UZ(3,"p",14,15),o._UZ(5,"a",16),o.qZA()}if(2&t){const t=o.oxw();o.xp6(5),o.Q6J("innerHTML",t.collectionMessage,o.oJD)}}function _n(t,e){if(1&t&&o._UZ(0,"p",17),2&t){const t=o.oxw();o.Q6J("innerHtml",t.collectText,o.oJD)}}function Cn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",18),o._UZ(1,"p",19),o.TgZ(2,"a",20),o.NdJ("click",function(){return o.CHM(t),o.oxw().learnMore()}),o._uU(3,"Learn More"),o.qZA(),o.qZA()}}let yn=(()=>{class t{constructor(t,e,n,i,o){this.el=t,this.api=e,this.tabs=n,this.browser=i,this.popup=o,this.REDEEMED_OK=1,this.ALREADY_EXPIRED=2,this.ALREADY_REDEEMED=4,this.REDEMPTION_LIMIT_REACHED=1024,this.BENEFIT_EXTENSION=32768,this.REDEEMED_OK_XP_AWARDED=65536}ngOnInit(){this.placeholder=this.browser.getLocalizedMessage("popup_promo_enter_placeholder"),this.collectText=this.browser.getSanitizedLocalizedMessage("popup_promo_collect"),setTimeout(()=>{this.el.nativeElement.querySelector(".collect a").onclick=()=>{this.collect()}})}alertClicked(){this.url?this.tabs.openNewTab(this.url,!0):($.copyTextToClipboard(this.collectionMessage),Qe.toggleFade(this.copiedElement.nativeElement,this.alertElement.nativeElement))}redeem(){var t,e;return(0,h.mG)(this,void 0,void 0,function*(){if(this.error=null,this.code){let i=null;try{this.busy=!0,i=yield this.api.redeemPromoCode(this.code)}catch(n){this.error=this.browser.getLocalizedMessage("popup_error_generic")}finally{this.busy=!1}if(null===(t=i.data)||void 0===t?void 0:t.messageID){let t=(null===(e=i.data)||void 0===e?void 0:e.message)||this.constructRedemptionMessage(i.data);[this.REDEEMED_OK,this.BENEFIT_EXTENSION,this.REDEEMED_OK_XP_AWARDED].includes(i.data.messageID)?(this.alert=t,this.code=""):(this.error=t,[this.ALREADY_EXPIRED,this.REDEMPTION_LIMIT_REACHED,this.ALREADY_REDEEMED].includes(i.data.messageID)&&(this.code=""))}}else this.error=this.browser.getLocalizedMessage("popup_promo_enter_blank")})}constructRedemptionMessage(t){let e,n=!1;switch(t.messageID){case this.REDEEMED_OK:case this.BENEFIT_EXTENSION:case this.REDEEMED_OK_XP_AWARDED:e="popup_promo_congrats",n=!0;break;case this.ALREADY_EXPIRED:case this.REDEMPTION_LIMIT_REACHED:e="popup_promo_expired";break;case this.ALREADY_REDEEMED:e="popup_promo_already_redeemed";break;default:e="popup_promo_invalid"}return this.browser.getSanitizedLocalizedMessage(e,n?t.award:null)}collect(){var t,e;return(0,h.mG)(this,void 0,void 0,function*(){this.error=null;let n=yield this.api.checkPromoCode();if(0===(null==n?void 0:n.status)&&(null===(e=null===(t=null==n?void 0:n.data)||void 0===t?void 0:t.promoCode)||void 0===e?void 0:e.id)>-1&&n.data.promoCode.message){let t=n.data.promoCode;this.url=t.url,this.collectionMessage=t.message}else this.alert=this.browser.getSanitizedLocalizedMessage("popup_promo_no_code")})}learnMore(){this.popup.openSiteTab(Mt.PromoCodeInfo)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(o.SBq),o.Y36(Bt),o.Y36(oe),o.Y36(Ht),o.Y36(Ce))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-promo-codes"]],viewQuery:function(t,e){if(1&t&&(o.Gf(fn,5),o.Gf(vn,5)),2&t){let t;o.iGM(t=o.CRH())&&(e.alertElement=t.first),o.iGM(t=o.CRH())&&(e.copiedElement=t.first)}},decls:13,vars:9,consts:[["type","error","position","relative",3,"message"],["position","relative",3,"message"],["class","card",3,"click",4,"ngIf"],[3,"ngSubmit"],["l10n","popup_promo_enter"],[3,"popover"],["src","assets/redesign/icons/info.svg"],["name","code",3,"ngModel","placeholder","disabled","ngModelChange"],["l10n","popup_promo_redeem",1,"primary",3,"disabled"],["class","collect",3,"innerHtml",4,"ngIf"],["info",""],[1,"card",3,"click"],["l10n","copied",1,"copied"],["copiedElement",""],["l10n","popup_promo_alert",1,"alert-title"],["alertElement",""],[3,"innerHTML"],[1,"collect",3,"innerHtml"],[1,"info"],["l10n","popup_promo_info"],[3,"click"]],template:function(t,e){if(1&t&&(o._UZ(0,"shared-alert",0),o._UZ(1,"shared-alert",1),o.YNc(2,bn,6,1,"div",2),o.TgZ(3,"form",3),o.NdJ("ngSubmit",function(){return e.redeem()}),o.TgZ(4,"div"),o._UZ(5,"span",4),o.TgZ(6,"a",5),o._UZ(7,"img",6),o.qZA(),o.qZA(),o.TgZ(8,"input",7),o.NdJ("ngModelChange",function(t){return e.code=t}),o.qZA(),o._UZ(9,"button",8),o.qZA(),o.YNc(10,_n,1,1,"p",9),o.YNc(11,Cn,4,0,"ng-template",null,10,o.W1O)),2&t){const t=o.MAs(12);o.Q6J("message",e.error),o.xp6(1),o.Q6J("message",e.alert),o.xp6(1),o.Q6J("ngIf",e.collectionMessage),o.xp6(4),o.Q6J("popover",t),o.xp6(2),o.Q6J("ngModel",e.code)("placeholder",e.placeholder)("disabled",e.busy),o.xp6(1),o.Q6J("disabled",e.busy||!e.code),o.xp6(1),o.Q6J("ngIf",!e.collectionMessage)}},directives:[Ge,d.O5,r._Y,r.JL,r.F,_e,mn,r.Fj,r.JJ,r.On],styles:["[_nghost-%COMP%]{color:var(--default-dark);display:flex;flex-direction:column;flex-grow:1;position:relative;font-size:14px}.card[_ngcontent-%COMP%]{text-align:center;flex-direction:column;padding:15px 30px;border:solid 1px var(--light-gray);position:relative;cursor:pointer;margin-bottom:15px}.card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;text-transform:uppercase;margin:0 0 10px;font-weight:bold;transition:opacity 1s}.card[_ngcontent-%COMP%]   p.copied[_ngcontent-%COMP%]{opacity:0;position:absolute;width:calc(100% - 60px)}.card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;padding:15px;font-weight:bold}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:15px;align-items:center}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:4px}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-bottom:-2px}form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:14px;padding:15px;border:solid 1px var(--light-gray);border-radius:4px;outline:none;margin-top:10px;width:calc(100% - 30px)}.collect[_ngcontent-%COMP%]{text-align:center}.info[_ngcontent-%COMP%]{padding:15px;width:250px;font-size:14px;font-family:var(--font);color:var(--default);line-height:22px}.info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-weight:bold}shared-alert[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]{color:#639!important}"]}),t})();const xn=(new Map).set(ye.Login,Ue).set(ye.Answer,ke).set(ye.Merchant,gn).set(ye.PromoCodes,yn).set(ye.Registration,He).set(ye.FeaturedStores,We);let Mn=(()=>{class t{constructor(t){this.popup=t,this._onRenderBody=new u.x,this.onRenderBody=this._onRenderBody.asObservable()}get shouldShowHeaderControls(){return this.popup.member&&![ye.Login,ye.Registration].includes(this.context)}renderContext(t){this.context=t;const e=xn.get(t);this._onRenderBody.next(e)}renderBrandComponent(t){this.context=null,this._onRenderBody.next(t)}renderDefaultView(){return(0,h.mG)(this,void 0,void 0,function*(){this.popup.isMerchantContext?this.renderShop():this.popup.member?(yield this.popup.getDefaultView())===M.SHOP?this.renderShop():this.renderContext(ye.Answer):this.renderContext(ye.Registration)})}renderShop(){this.renderContext(this.popup.data.merchant?ye.Merchant:ye.FeaturedStores)}renderPromoCodes(){this.renderContext(ye.PromoCodes)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(Ce))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Sn=["arrow"],On=["content"],Pn=["contentContainer"];function wn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",3),o.NdJ("click",function(){return o.CHM(t),o.oxw().close()}),o.qZA()}}function An(t,e){1&t&&o._UZ(0,"div",4,5)}function In(t,e){1&t&&(o.TgZ(0,"div",6,7),o.GkF(2,null,8),o.qZA())}let kn=(()=>{class t{constructor(t,e,n){this.dom=t,this.svc=e,this.changeDetector=n,this.MARGIN=8}ngOnInit(){this.svc.onShow.subscribe(t=>{this.visible=!0,this.changeDetector.detectChanges(),setTimeout(()=>{const e=t.targetBounds,n=e.x+e.width/2,i=this.positionArrow(e,n);this.content.createEmbeddedView(t.content),this.positionContent(n,i),this.arrow.nativeElement.style.visibility="visible",this.contentContainer.nativeElement.style.visibility="visible"})}),this.svc.onClose.subscribe(()=>{this.close()})}positionArrow(t,e){let n=this.arrow.nativeElement.getBoundingClientRect();return this.arrow.nativeElement.style.left=e-n.width/2+"px",this.arrow.nativeElement.style.top=`${t.y+t.height+this.MARGIN}px`,this.arrow.nativeElement.getBoundingClientRect()}positionContent(t,e){const n=this.contentContainer.nativeElement.getBoundingClientRect();let i=t-n.width/2;const o=this.dom.body.getBoundingClientRect();i<0?i=this.MARGIN:i+n.width>o.width&&(i=o.width-n.width-this.MARGIN),this.contentContainer.nativeElement.style.left=`${i}px`,this.contentContainer.nativeElement.style.top=`${e.y+(e.height-1)}px`}close(){this.arrow.nativeElement.style.visibility="hidden",this.contentContainer.nativeElement.style.visibility="hidden",this.visible=!1}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(d.K0),o.Y36(pn),o.Y36(o.sBO))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-popover"]],viewQuery:function(t,e){if(1&t&&(o.Gf(Sn,5,o.SBq),o.Gf(On,5,o.s_b),o.Gf(Pn,5,o.SBq)),2&t){let t;o.iGM(t=o.CRH())&&(e.arrow=t.first),o.iGM(t=o.CRH())&&(e.content=t.first),o.iGM(t=o.CRH())&&(e.contentContainer=t.first)}},decls:3,vars:3,consts:[["class","overlay",3,"click",4,"ngIf"],["class","arrow",4,"ngIf"],["class","content",4,"ngIf"],[1,"overlay",3,"click"],[1,"arrow"],["arrow",""],[1,"content"],["contentContainer",""],["content",""]],template:function(t,e){1&t&&(o.YNc(0,wn,1,0,"div",0),o.YNc(1,An,2,0,"div",1),o.YNc(2,In,4,0,"div",2)),2&t&&(o.Q6J("ngIf",e.visible),o.xp6(1),o.Q6J("ngIf",e.visible),o.xp6(1),o.Q6J("ngIf",e.visible))},directives:[d.O5],styles:['[_nghost-%COMP%]{position:absolute;top:0;left:0}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100vw;height:100vh;background:black;opacity:.4}.arrow[_ngcontent-%COMP%]{width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:10px solid #DADADA;position:absolute;z-index:999999;visibility:hidden}.arrow[_ngcontent-%COMP%]:after{content:"";position:absolute;top:1.5px;left:-8.5px;width:0;height:0;border-left:9px solid transparent;border-right:9px solid transparent;border-bottom:9px solid white}.content[_ngcontent-%COMP%]{position:absolute;background:#FFFFFF;border:1px solid #DADADA;border-radius:4px;visibility:hidden}']}),t})();function Tn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"a",10),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw().openSiteTab(e.key)}),o.qZA()}2&t&&o.Q6J("l10n",e.$implicit.value)}let En=(()=>{class t{constructor(t,e,n,i){this.popup=t,this.config=e,this.popover=n,this.renderer=i}ngOnInit(){const t=this.popup.data.member;this.menu=this.popup.accountPopoverMenu,this.name=t.fName||t.uName,this.lifetimeEarned=this.config.formatAccountBalance(t.lifetimeEarnings),this.extensionName=this.config.extensionName}openSiteTab(t){this.popup.openSiteTab(t)}renderLogin(){this.renderer.renderContext(ye.Login),this.popover.close()}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ce),o.Y36(Dt),o.Y36(pn),o.Y36(Mn))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-account-popover"]],decls:14,vars:5,consts:[[1,"account-popover"],[1,"top"],[1,"greeting"],["l10n","popup_account_popover_greeting",3,"substitutions"],["l10n","popup_account_popover_not_you",3,"click"],[1,"earnings"],[1,"lifetime"],["l10n","popup_account_popover_lifetime_earned"],[1,"bottom"],[3,"l10n","click",4,"ngFor","ngForOf"],[3,"l10n","click"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"div",2),o._UZ(3,"span",3),o.TgZ(4,"a",4),o.NdJ("click",function(){return e.renderLogin()}),o.qZA(),o.qZA(),o.TgZ(5,"div",5),o.TgZ(6,"div",6),o._UZ(7,"span",7),o._UZ(8,"br"),o.TgZ(9,"b"),o._uU(10),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(11,"div",8),o.YNc(12,Tn,1,1,"a",9),o.ALo(13,"keyvalue"),o.qZA(),o.qZA()),2&t&&(o.xp6(3),o.Q6J("substitutions",e.name),o.xp6(7),o.Oqu(e.lifetimeEarned),o.xp6(2),o.Q6J("ngForOf",o.lcZ(13,3,e.menu)))},directives:[_e,d.sg],pipes:[d.Nd],styles:["[_ngcontent-%COMP%]:root{--gray: #AAAAAA;--light-gray: #DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#F5F5F5}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{color:#fff;background:var(--bg-gradient)}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]{border-right:solid 1px white}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;font-size:14px;line-height:18px;border-radius:4px;cursor:pointer;border:0}button.primary[_ngcontent-%COMP%]:focus, button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:none}button.primary[_ngcontent-%COMP%]:disabled, button.secondary[_ngcontent-%COMP%]:disabled{border:0;cursor:not-allowed}button.primary[_ngcontent-%COMP%]{background:var(--primary);padding:15px}button.primary[_ngcontent-%COMP%]:disabled{background:var(--primary-light);color:var(--primary)}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);color:var(--secondary)}button.login[_ngcontent-%COMP%]{align-self:center;display:block!important;position:absolute;right:16px;background-color:#fff;color:var(--primary);border-radius:50px;border:1px solid var(--primary);font-size:14px;list-style:16px;font-weight:700;text-align:center;min-width:130px;height:32px;cursor:pointer}.card[_ngcontent-%COMP%]{background:white;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:32px}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:normal}shared-register[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--default-dark);font-size:14px}shared-register[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:100%;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-register[_ngcontent-%COMP%]   a.login[_ngcontent-%COMP%]{text-decoration:underline}shared-login[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:normal;margin:0 0 15px;color:var(--default-dark);text-align:left}shared-login[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:-moz-fit-content;width:fit-content;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-merchant[_ngcontent-%COMP%]   .merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{font-weight:bold}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]{padding-bottom:10px}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]   .coupon-count[_ngcontent-%COMP%]{font-size:14px}shared-merchant[_ngcontent-%COMP%]   .no-coupons[_ngcontent-%COMP%]{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;background:var(--primary-light);flex-grow:1}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:110px;height:110px;border:1px solid var(--primary-light);border-radius:8px;margin-right:16px;text-transform:uppercase;flex-shrink:0}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{flex-basis:100%}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .tagline[_ngcontent-%COMP%]{background-color:var(--primary-light);color:#fff;font-size:12px;font-weight:600;line-height:24px;text-align:center;border-radius:0 0 8px 8px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:16px;line-height:24px;font-weight:bold;align-items:center;justify-content:center;display:flex;box-shadow:0 3.36667px 10.1px #8883}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:var(--tertiary-light);border:1px solid var(--tertiary);border-radius:20px;font-weight:bold;height:40px;width:100%;position:relative}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;background:var(--primary-light);border:1px solid var(--primary-light);border-radius:50px;color:var(--primary);height:40px;width:calc(100% - 30px)}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:-4px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .expiration[_ngcontent-%COMP%]{color:var(--text-inactivated);font-size:10px;font-weight:600}shared-answer[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{background:var(--error)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:white;border-radius:4px;color:var(--primary);border:solid 1px var(--primary)}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{background:var(--secondary-light);color:var(--secondary);width:130px;padding-top:15px;padding-bottom:15px;font-size:24px;font-weight:bold;text-align:center}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}shared-featured-stores[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .alert-title[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{border:dashed 1px var(--primary);background:var(--primary-light);color:var(--primary-dark)}shared-promo-codes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-bottom:15px}shared-promo-codes[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--secondary)}shared-alert[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}.account-popover[_ngcontent-%COMP%]{width:225px;font-size:14px;font-family:var(--font)}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{border-bottom:solid 1px var(--light-gray);display:flex;flex-direction:column;padding:10px}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .greeting[_ngcontent-%COMP%]{overflow:auto}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .greeting[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--default-darker);float:left}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .greeting[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{font-weight:700}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .greeting[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-weight:700;font-size:12px;float:right;color:var(--primary)}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .earnings[_ngcontent-%COMP%]{display:flex;margin-top:10px}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .earnings[_ngcontent-%COMP%]   .lifetime[_ngcontent-%COMP%]{color:var(--primary)}.account-popover[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   .earnings[_ngcontent-%COMP%]   .lifetime[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.account-popover[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{padding-bottom:15px}.account-popover[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-top:15px;margin-left:10px;color:var(--primary);display:block;max-width:125px}"]}),t})();const Rn=["balance"];function Ln(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",6),o.TgZ(1,"div",7),o.NdJ("click",function(){return o.CHM(t),o.oxw().openAccountStatement()}),o._UZ(2,"span",8),o.TgZ(3,"span",9,10),o._uU(5),o.qZA(),o.qZA(),o.TgZ(6,"a",11),o._UZ(7,"img",12),o.qZA(),o.TgZ(8,"a",13),o.NdJ("click",function(){return o.CHM(t),o.oxw().settings()}),o._UZ(9,"img",14),o.qZA(),o.qZA()}if(2&t){const t=o.oxw(),e=o.MAs(5);o.xp6(5),o.Oqu(t.balanceAmount),o.xp6(1),o.Q6J("popover",e)}}function Gn(t,e){1&t&&o._UZ(0,"shared-account-popover")}function Nn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",15),o.NdJ("click",function(){return o.CHM(t),o.oxw().renderLogin()}),o.qZA()}}let Dn=(()=>{class t{constructor(t,e,n,i){this.tabs=t,this.popup=e,this.config=n,this.renderer=i}ngOnInit(){return(0,h.mG)(this,void 0,void 0,function*(){this.init(),this.renderer.onRenderBody.subscribe(()=>{this.init()}),this.popup.member&&this.refreshAccountBalance()})}init(){const t=this.popup.member;t&&(this.balanceAmount=this.config.formatAccountBalance(t.balance),this.shouldShowControls=this.renderer.shouldShowHeaderControls)}refreshAccountBalance(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield this.popup.refreshAccountBalance();t&&(this.balance.nativeElement.classList.add("fade"),setTimeout(()=>{this.balanceAmount=this.config.formatAccountBalance(t),this.balance.nativeElement.classList.remove("fade")},500))})}openSite(){this.tabs.openSiteTab()}renderLogin(){this.renderer.renderContext(ye.Login)}settings(){return(0,h.mG)(this,void 0,void 0,function*(){yield this.popup.sendBackgroundMessage(m.OpenSettings)})}openAccountStatement(){this.popup.openSiteTab(Mt.Ledger)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(oe),o.Y36(Ce),o.Y36(Dt),o.Y36(Mn))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-account-info"]],viewQuery:function(t,e){if(1&t&&o.Gf(Rn,5),2&t){let t;o.iGM(t=o.CRH())&&(e.balance=t.first)}},decls:8,vars:2,consts:[[1,"header"],[1,"logo",3,"click"],["src","assets/redesign/images/logo.svg"],["class","right",4,"ngIf","ngIfElse"],["account",""],["login",""],[1,"right"],[1,"balance",3,"click"],["l10n","popup_member_balance"],[1,"amount"],["balance",""],[1,"icon",3,"popover"],["src","assets/redesign/icons/account.svg"],[1,"icon",3,"click"],["src","assets/redesign/icons/settings.svg"],["l10n","popup_auth_log_in",1,"login","right",3,"click"]],template:function(t,e){if(1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"a",1),o.NdJ("click",function(){return e.openSite()}),o._UZ(2,"img",2),o.qZA(),o.YNc(3,Ln,10,2,"div",3),o.qZA(),o.YNc(4,Gn,1,0,"ng-template",null,4,o.W1O),o.YNc(6,Nn,1,0,"ng-template",null,5,o.W1O)),2&t){const t=o.MAs(7);o.xp6(3),o.Q6J("ngIf",e.shouldShowControls)("ngIfElse",t)}},directives:[d.O5,_e,mn,En],styles:[".header[_ngcontent-%COMP%]{height:40px;padding:4px 0 4px 7px;display:flex}.header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{margin:5px;display:flex}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:row;justify-content:flex-end;align-items:center}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]{text-align:right;padding-right:11px;padding-top:5px;margin-right:20px;cursor:pointer}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:12px}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]   span.amount[_ngcontent-%COMP%]{font-size:14px;font-weight:bold;transition:opacity .5s;opacity:1}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]   span.amount.fade[_ngcontent-%COMP%]{opacity:0}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;margin-right:20px}"]}),t})();const Fn=function(t){return{selected:t}};function Un(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",2),o.NdJ("click",function(){const e=o.CHM(t).index;return o.oxw().onClick(e)}),o.TgZ(1,"span"),o._uU(2),o.qZA(),o._UZ(3,"shared-svg",3),o.qZA()}if(2&t){const t=e.$implicit,n=e.index,i=o.oxw();o.Q6J("ngClass",o.VKq(2,Fn,i.selectedIndex===n)),o.xp6(2),o.Oqu(t)}}let Zn=(()=>{class t{constructor(){this.items=[],this.select=new o.vpe}ngOnInit(){}onClick(t){this.selectedIndex=t,this.select.emit(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-select-list"]],inputs:{items:"items",selectedIndex:"selectedIndex"},outputs:{select:"select"},decls:2,vars:1,consts:[[1,"list"],["class","item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"item",3,"ngClass","click"],["src","assets/redesign/icons/check.svg"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.YNc(1,Un,4,4,"div",1),o.qZA()),2&t&&(o.xp6(1),o.Q6J("ngForOf",e.items))},directives:[d.sg,d.mk,xe],styles:[".list[_ngcontent-%COMP%]{width:130px}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;padding:10px;cursor:pointer}.list[_ngcontent-%COMP%]   .item.selected[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--primary)}.list[_ngcontent-%COMP%]   .item.selected[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{display:block}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:hover{background:#EBF5F8}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{color:#757575}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;flex-grow:1}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   shared-svg[_ngcontent-%COMP%]{display:none}"]}),t})();function qn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",2),o.TgZ(1,"div",3),o.TgZ(2,"div",4),o.TgZ(3,"span"),o._uU(4),o.qZA(),o._UZ(5,"img",5),o.qZA(),o.TgZ(6,"form",6),o.NdJ("ngSubmit",function(){return o.CHM(t),o.oxw().search()}),o.TgZ(7,"input",7),o.NdJ("ngModelChange",function(e){return o.CHM(t),o.oxw().query=e}),o.qZA(),o.TgZ(8,"a",8),o.NdJ("click",function(){return o.CHM(t),o.oxw().search()}),o._UZ(9,"img",9),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=o.oxw(),e=o.MAs(2);o.xp6(2),o.Q6J("popover",e),o.xp6(2),o.Oqu(t.popoverItems[t.selectedPopoverIndex]),o.xp6(3),o.Q6J("ngModel",t.query)("placeholder",t.placeholder)}}function Hn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"shared-select-list",10),o.NdJ("select",function(e){return o.CHM(t),o.oxw().onPopoverSelect(e)}),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("items",t.popoverItems)("selectedIndex",t.selectedPopoverIndex)}}let zn=(()=>{class t{constructor(t,e){this.popup=t,this.browser=e,this.browserMap=(new Map).set("firefox",101).set("edge",102).set("safari",104).set("chrome",105),this.popoverItems=[],this.selectedPopoverIndex=1}get placeholder(){return this.browser.getLocalizedMessage("popup_search_placeholder_"+(0===this.selectedPopoverIndex?"web":"shop"))}ngOnInit(){this.visible=this.popup.isFlagEnabled(M.UX_POPUP_SEARCH),this.popoverItems=[this.browser.getLocalizedMessage("popup_search_web"),this.browser.getLocalizedMessage("popup_nav_shop")]}search(){if(this.query)if(0===this.selectedPopoverIndex){const t=this.browserMap.get(this.browser.name);this.popup.openSiteTab(Mt.WebSearch,[t,this.query])}else this.popup.openSiteTab(Mt.ShopSearch,[this.query])}onPopoverSelect(t){this.selectedPopoverIndex=t}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ce),o.Y36(Ht))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-search"]],decls:3,vars:1,consts:[["class","search-container",4,"ngIf"],["popover",""],[1,"search-container"],[1,"search"],[1,"popover",3,"popover"],["src","assets/redesign/icons/search-chevron-down.svg"],[3,"ngSubmit"],["name","query",3,"ngModel","placeholder","ngModelChange"],[3,"click"],["src","assets/redesign/icons/search.svg"],[3,"items","selectedIndex","select"]],template:function(t,e){1&t&&(o.YNc(0,qn,10,4,"div",0),o.YNc(1,Hn,1,2,"ng-template",null,1,o.W1O)),2&t&&o.Q6J("ngIf",e.visible)},directives:[d.O5,mn,r._Y,r.JL,r.F,r.Fj,r.JJ,r.On,Zn],styles:["[_ngcontent-%COMP%]:root{--gray: #AAAAAA;--light-gray: #DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#F5F5F5}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{color:#fff;background:var(--bg-gradient)}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]{border-right:solid 1px white}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;font-size:14px;line-height:18px;border-radius:4px;cursor:pointer;border:0}button.primary[_ngcontent-%COMP%]:focus, button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:none}button.primary[_ngcontent-%COMP%]:disabled, button.secondary[_ngcontent-%COMP%]:disabled{border:0;cursor:not-allowed}button.primary[_ngcontent-%COMP%]{background:var(--primary);padding:15px}button.primary[_ngcontent-%COMP%]:disabled{background:var(--primary-light);color:var(--primary)}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);color:var(--secondary)}button.login[_ngcontent-%COMP%]{align-self:center;display:block!important;position:absolute;right:16px;background-color:#fff;color:var(--primary);border-radius:50px;border:1px solid var(--primary);font-size:14px;list-style:16px;font-weight:700;text-align:center;min-width:130px;height:32px;cursor:pointer}.card[_ngcontent-%COMP%]{background:white;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:32px}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:normal}shared-register[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--default-dark);font-size:14px}shared-register[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:100%;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-register[_ngcontent-%COMP%]   a.login[_ngcontent-%COMP%]{text-decoration:underline}shared-login[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:normal;margin:0 0 15px;color:var(--default-dark);text-align:left}shared-login[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:-moz-fit-content;width:fit-content;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-merchant[_ngcontent-%COMP%]   .merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{font-weight:bold}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]{padding-bottom:10px}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]   .coupon-count[_ngcontent-%COMP%]{font-size:14px}shared-merchant[_ngcontent-%COMP%]   .no-coupons[_ngcontent-%COMP%]{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;background:var(--primary-light);flex-grow:1}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:110px;height:110px;border:1px solid var(--primary-light);border-radius:8px;margin-right:16px;text-transform:uppercase;flex-shrink:0}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{flex-basis:100%}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .tagline[_ngcontent-%COMP%]{background-color:var(--primary-light);color:#fff;font-size:12px;font-weight:600;line-height:24px;text-align:center;border-radius:0 0 8px 8px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:16px;line-height:24px;font-weight:bold;align-items:center;justify-content:center;display:flex;box-shadow:0 3.36667px 10.1px #8883}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:var(--tertiary-light);border:1px solid var(--tertiary);border-radius:20px;font-weight:bold;height:40px;width:100%;position:relative}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;background:var(--primary-light);border:1px solid var(--primary-light);border-radius:50px;color:var(--primary);height:40px;width:calc(100% - 30px)}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:-4px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .expiration[_ngcontent-%COMP%]{color:var(--text-inactivated);font-size:10px;font-weight:600}shared-answer[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{background:var(--error)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:white;border-radius:4px;color:var(--primary);border:solid 1px var(--primary)}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{background:var(--secondary-light);color:var(--secondary);width:130px;padding-top:15px;padding-bottom:15px;font-size:24px;font-weight:bold;text-align:center}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}shared-featured-stores[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .alert-title[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{border:dashed 1px var(--primary);background:var(--primary-light);color:var(--primary-dark)}shared-promo-codes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-bottom:15px}shared-promo-codes[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--secondary)}shared-alert[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}.search-container[_ngcontent-%COMP%]{padding:10px;background:white}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{background:white;border:1px solid var(--light-gray);border-radius:4px;display:flex;cursor:pointer}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .popover[_ngcontent-%COMP%]{display:flex;align-items:center;border-right:solid 1px var(--light-gray);padding-left:10px;padding-right:10px}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .popover[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-transform:uppercase;margin-right:5px;display:flex;align-items:center}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .popover[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:5px}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;align-items:center;flex-grow:1}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px;margin:0;background:none;border:none;outline:none;display:flex;flex-grow:1}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--light-gray);font-weight:normal}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;margin-right:10px}.search-container[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:20px}"]}),t})();const jn=function(t){return{single:t}};function Jn(t,e){if(1&t&&(o.TgZ(0,"div",4),o._uU(1),o.qZA()),2&t){const t=o.oxw();o.Q6J("ngClass",o.VKq(2,jn,t.count<10)),o.xp6(1),o.Oqu(t.count)}}const $n=function(t){return{selected:t}};let Bn=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-nav-item"]],inputs:{icon:"icon",count:"count",message:"message",selected:"selected"},decls:4,vars:6,consts:[[1,"nav-item",3,"ngClass"],[3,"src"],[3,"l10n"],["class","count",3,"ngClass",4,"ngIf"],[1,"count",3,"ngClass"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o._UZ(1,"shared-svg",1),o._UZ(2,"span",2),o.YNc(3,Jn,2,4,"div",3),o.qZA()),2&t&&(o.Q6J("ngClass",o.VKq(4,$n,e.selected)),o.xp6(1),o.Q6J("src",e.icon),o.xp6(1),o.Q6J("l10n",e.message),o.xp6(1),o.Q6J("ngIf",e.count))},directives:[d.mk,xe,_e,d.O5],styles:[".nav-item{display:flex;height:34px;align-items:stretch;border-bottom:solid 6px white;padding-left:20px;padding-right:20px;cursor:pointer;position:relative;justify-items:center;justify-content:center}.nav-item:hover svg,.nav-item.selected svg{fill:var(--primary)}.nav-item:hover span,.nav-item.selected span{color:var(--primary)}.nav-item.selected{border-bottom:solid 6px var(--primary)}.nav-item shared-svg{display:flex;align-items:flex-end;padding-bottom:4px}.nav-item shared-svg svg{height:16px;width:auto;margin-right:6px;fill:var(--default)}.nav-item span{display:flex;align-items:flex-end;font-weight:bold;padding-bottom:4px}.nav-item .count{background:var(--error);color:#fff;border-radius:10px;align-self:flex-start;font-size:12px;font-weight:bold;text-align:center;padding:2px 4px}.nav-item .count.single{padding-left:7px;padding-right:7px}\n"],encapsulation:2}),t})();function Yn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"shared-nav-item",3),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(2).navigate(e.flag)}),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw(2);o.Q6J("icon",t.icon)("count",t.count)("message",t.message)("selected",t.flag===n.selected)}}function Wn(t,e){if(1&t&&(o.TgZ(0,"div",1),o.YNc(1,Yn,1,4,"shared-nav-item",2),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.Q6J("ngForOf",t.items)}}let Qn=(()=>{class t{constructor(t,e){this.popup=t,this.renderer=e,this.items=[]}ngOnInit(){return(0,h.mG)(this,void 0,void 0,function*(){let t=t=>this.popup.isFlagEnabled(t);t(M.SHOP)&&this.items.push({flag:M.SHOP,icon:"assets/redesign/icons/shop.svg",message:"popup_nav_shop"}),t(M.ANSWER)&&this.items.push({flag:M.ANSWER,icon:"assets/redesign/icons/answer.svg",count:this.popup.data.notifications.length,message:"popup_nav_answer"}),t(M.MKT_PROMO_CODES)&&this.items.push({flag:M.MKT_PROMO_CODES,icon:"assets/redesign/icons/promos.svg",message:"popup_nav_promos"}),this.selected=yield this.popup.getDefaultView()})}navigate(t){switch(this.selected=t,t){case M.SHOP:this.renderer.renderShop();break;case M.ANSWER:this.renderer.renderContext(ye.Answer);break;case M.MKT_PROMO_CODES:this.renderer.renderPromoCodes()}}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ce),o.Y36(Mn))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-nav"]],decls:1,vars:1,consts:[["class","nav",4,"ngIf"],[1,"nav"],[3,"icon","count","message","selected","click",4,"ngFor","ngForOf"],[3,"icon","count","message","selected","click"]],template:function(t,e){1&t&&o.YNc(0,Wn,2,1,"div",0),2&t&&o.Q6J("ngIf",e.items.length>1)},directives:[d.O5,d.sg,Bn],styles:["[_ngcontent-%COMP%]:root{--gray: #AAAAAA;--light-gray: #DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#F5F5F5}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{color:#fff;background:var(--bg-gradient)}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]{border-right:solid 1px white}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;font-size:14px;line-height:18px;border-radius:4px;cursor:pointer;border:0}button.primary[_ngcontent-%COMP%]:focus, button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:none}button.primary[_ngcontent-%COMP%]:disabled, button.secondary[_ngcontent-%COMP%]:disabled{border:0;cursor:not-allowed}button.primary[_ngcontent-%COMP%]{background:var(--primary);padding:15px}button.primary[_ngcontent-%COMP%]:disabled{background:var(--primary-light);color:var(--primary)}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);color:var(--secondary)}button.login[_ngcontent-%COMP%]{align-self:center;display:block!important;position:absolute;right:16px;background-color:#fff;color:var(--primary);border-radius:50px;border:1px solid var(--primary);font-size:14px;list-style:16px;font-weight:700;text-align:center;min-width:130px;height:32px;cursor:pointer}.card[_ngcontent-%COMP%]{background:white;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:32px}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:normal}shared-register[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--default-dark);font-size:14px}shared-register[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:100%;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-register[_ngcontent-%COMP%]   a.login[_ngcontent-%COMP%]{text-decoration:underline}shared-login[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:normal;margin:0 0 15px;color:var(--default-dark);text-align:left}shared-login[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:-moz-fit-content;width:fit-content;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-merchant[_ngcontent-%COMP%]   .merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{font-weight:bold}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]{padding-bottom:10px}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]   .coupon-count[_ngcontent-%COMP%]{font-size:14px}shared-merchant[_ngcontent-%COMP%]   .no-coupons[_ngcontent-%COMP%]{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;background:var(--primary-light);flex-grow:1}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:110px;height:110px;border:1px solid var(--primary-light);border-radius:8px;margin-right:16px;text-transform:uppercase;flex-shrink:0}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{flex-basis:100%}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .tagline[_ngcontent-%COMP%]{background-color:var(--primary-light);color:#fff;font-size:12px;font-weight:600;line-height:24px;text-align:center;border-radius:0 0 8px 8px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:16px;line-height:24px;font-weight:bold;align-items:center;justify-content:center;display:flex;box-shadow:0 3.36667px 10.1px #8883}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:var(--tertiary-light);border:1px solid var(--tertiary);border-radius:20px;font-weight:bold;height:40px;width:100%;position:relative}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;background:var(--primary-light);border:1px solid var(--primary-light);border-radius:50px;color:var(--primary);height:40px;width:calc(100% - 30px)}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:-4px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .expiration[_ngcontent-%COMP%]{color:var(--text-inactivated);font-size:10px;font-weight:600}shared-answer[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{background:var(--error)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:white;border-radius:4px;color:var(--primary);border:solid 1px var(--primary)}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{background:var(--secondary-light);color:var(--secondary);width:130px;padding-top:15px;padding-bottom:15px;font-size:24px;font-weight:bold;text-align:center}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}shared-featured-stores[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .alert-title[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{border:dashed 1px var(--primary);background:var(--primary-light);color:var(--primary-dark)}shared-promo-codes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-bottom:15px}shared-promo-codes[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--secondary)}shared-alert[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}.nav[_ngcontent-%COMP%]{border-top:1px solid var(--light-gray);border-bottom:1px solid var(--light-gray);display:flex;justify-content:space-evenly;background:white}.nav[_ngcontent-%COMP%]   shared-nav-item[_ngcontent-%COMP%]{flex:1 1 0}"]}),t})();function Vn(t,e){1&t&&o._UZ(0,"shared-search")}function Kn(t,e){1&t&&o._UZ(0,"shared-nav")}let Xn=(()=>{class t{constructor(t){this.renderer=t}ngOnInit(){this.renderer.onRenderBody.subscribe(()=>{this.shouldShowControls=this.renderer.shouldShowHeaderControls})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Mn))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-header"]],decls:3,vars:2,consts:[[4,"ngIf"]],template:function(t,e){1&t&&(o._UZ(0,"shared-account-info"),o.YNc(1,Vn,1,0,"shared-search",0),o.YNc(2,Kn,1,0,"shared-nav",0)),2&t&&(o.xp6(1),o.Q6J("ngIf",e.shouldShowControls),o.xp6(1),o.Q6J("ngIf",e.shouldShowControls))},directives:[Dn,d.O5,zn,Qn],styles:[""]}),t})();const ti=["body"];function ei(t,e){1&t&&(o.TgZ(0,"div",1),o._UZ(1,"shared-header"),o.TgZ(2,"div",2),o.GkF(3,null,3),o.qZA(),o.qZA())}let ni=(()=>{class t{constructor(t,e,n,i){this.popup=t,this.renderer=e,this.changeDetector=n,this.factoryResolver=i}ngOnInit(){return(0,h.mG)(this,void 0,void 0,function*(){this.subscribeOnRenderBody(),this.popup.onInitialized.subscribe(()=>{this.initialized=!0,this.changeDetector.detectChanges(),this.renderer.renderDefaultView()}),yield this.popup.init()})}subscribeOnRenderBody(){this.renderer.onRenderBody.subscribe(t=>{this.body.clear();const e=this.factoryResolver.resolveComponentFactory(t);this.body.createComponent(e)})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Ce),o.Y36(Mn),o.Y36(o.sBO),o.Y36(o._Vd))},t.\u0275cmp=o.Xpm({type:t,selectors:[["popup-base"]],viewQuery:function(t,e){if(1&t&&o.Gf(ti,5,o.s_b),2&t){let t;o.iGM(t=o.CRH())&&(e.body=t.first)}},decls:2,vars:1,consts:[["class","popup",4,"ngIf"],[1,"popup"],[1,"body"],["body",""]],template:function(t,e){1&t&&(o.YNc(0,ei,5,0,"div",0),o._UZ(1,"shared-popover")),2&t&&o.Q6J("ngIf",e.initialized)},directives:[d.O5,kn,Xn],styles:[":root{--gray: #AAAAAA;--light-gray: #DADADA}.popup{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#F5F5F5}.popup .header{color:#fff;background:var(--bg-gradient)}.popup .header .balance{border-right:solid 1px white}.popup .body{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a{color:var(--primary);cursor:pointer}input,button{font-family:var(--font)}button.primary,button.secondary{color:#fff;font-weight:700;font-size:14px;line-height:18px;border-radius:4px;cursor:pointer;border:0}button.primary:focus,button.secondary:focus{border:0;outline:none}button.primary:disabled,button.secondary:disabled{border:0;cursor:not-allowed}button.primary{background:var(--primary);padding:15px}button.primary:disabled{background:var(--primary-light);color:var(--primary)}button.secondary{background:var(--secondary);padding:10px}button.secondary:disabled{background:var(--secondary-light);color:var(--secondary)}button.login{align-self:center;display:block!important;position:absolute;right:16px;background-color:#fff;color:var(--primary);border-radius:50px;border:1px solid var(--primary);font-size:14px;list-style:16px;font-weight:700;text-align:center;min-width:130px;height:32px;cursor:pointer}.card{background:white;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}shared-register .heading{color:var(--default-dark)}shared-register .heading h1{margin:0;font-size:32px}shared-register .heading h2{margin:0;font-size:24px;font-weight:normal}shared-register p{color:var(--default-dark);font-size:14px}shared-register button{margin-bottom:10px;width:100%;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-register a.login{text-decoration:underline}shared-login h1{font-size:20px;font-weight:normal;margin:0 0 15px;color:var(--default-dark);text-align:left}shared-login button{margin-bottom:10px;width:-moz-fit-content;width:fit-content;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-merchant .merchant .info .reward{font-weight:bold}shared-merchant .coupons{padding-bottom:10px}shared-merchant .coupons .coupon-count{font-size:14px}shared-merchant .no-coupons{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;background:var(--primary-light);flex-grow:1}shared-coupon .coupon .callout{display:flex;flex-direction:column;width:110px;height:110px;border:1px solid var(--primary-light);border-radius:8px;margin-right:16px;text-transform:uppercase;flex-shrink:0}shared-coupon .coupon .callout .discount .value,shared-coupon .coupon .callout .discount .label{flex-basis:100%}shared-coupon .coupon .callout .tagline{background-color:var(--primary-light);color:#fff;font-size:12px;font-weight:600;line-height:24px;text-align:center;border-radius:0 0 8px 8px}shared-coupon .info .button .text,shared-coupon .info .button .peel div{font-size:16px;line-height:24px;font-weight:bold;align-items:center;justify-content:center;display:flex;box-shadow:0 3.36667px 10.1px #8883}shared-coupon .info .button .text{background:var(--tertiary-light);border:1px solid var(--tertiary);border-radius:20px;font-weight:bold;height:40px;width:100%;position:relative}shared-coupon .info .button .peel div{display:flex;background:var(--primary-light);border:1px solid var(--primary-light);border-radius:50px;color:var(--primary);height:40px;width:calc(100% - 30px)}shared-coupon .info .button .peel img{margin-left:-4px}shared-coupon .info .expiration{color:var(--text-inactivated);font-size:10px;font-weight:600}shared-answer .title a{color:var(--primary)}shared-answer .alert .status div{background:var(--error)}shared-answer .alert .link a{background:white;border-radius:4px;color:var(--primary);border:solid 1px var(--primary)}shared-answer .survey .reward{background:var(--secondary-light);color:var(--secondary);width:130px;padding-top:15px;padding-bottom:15px;font-size:24px;font-weight:bold;text-align:center}shared-answer .survey .info b{color:var(--secondary)}shared-featured-stores .title a{color:var(--primary)}shared-promo-codes .card .alert-title{color:var(--primary)}shared-promo-codes .card a{border:dashed 1px var(--primary);background:var(--primary-light);color:var(--primary-dark)}shared-promo-codes form input{margin-bottom:15px}shared-promo-codes .info a{color:var(--secondary)}shared-alert b{color:var(--secondary)}\n"],encapsulation:2}),t})();const ii=function(t){return{on:t}};let oi=(()=>{class t{constructor(){this.change=new o.vpe}ngOnInit(){}toggle(){this.on=!this.on,this.change.next(this.on)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-switch"]],inputs:{on:"on"},outputs:{change:"change"},decls:3,vars:3,consts:[[1,"switch",3,"ngClass","click"],[1,"track"],[1,"indicator"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.NdJ("click",function(){return e.toggle()}),o._UZ(1,"div",1),o._UZ(2,"div",2),o.qZA()),2&t&&o.Q6J("ngClass",o.VKq(1,ii,e.on))},directives:[d.mk],styles:["[_ngcontent-%COMP%]:root{--gray: #AAAAAA;--light-gray: #DADADA}.popup[_ngcontent-%COMP%]{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#F5F5F5}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{color:#fff;background:var(--bg-gradient)}.popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .balance[_ngcontent-%COMP%]{border-right:solid 1px white}.popup[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a[_ngcontent-%COMP%]{color:var(--primary);cursor:pointer}input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{font-family:var(--font)}button.primary[_ngcontent-%COMP%], button.secondary[_ngcontent-%COMP%]{color:#fff;font-weight:700;font-size:14px;line-height:18px;border-radius:4px;cursor:pointer;border:0}button.primary[_ngcontent-%COMP%]:focus, button.secondary[_ngcontent-%COMP%]:focus{border:0;outline:none}button.primary[_ngcontent-%COMP%]:disabled, button.secondary[_ngcontent-%COMP%]:disabled{border:0;cursor:not-allowed}button.primary[_ngcontent-%COMP%]{background:var(--primary);padding:15px}button.primary[_ngcontent-%COMP%]:disabled{background:var(--primary-light);color:var(--primary)}button.secondary[_ngcontent-%COMP%]{background:var(--secondary);padding:10px}button.secondary[_ngcontent-%COMP%]:disabled{background:var(--secondary-light);color:var(--secondary)}button.login[_ngcontent-%COMP%]{align-self:center;display:block!important;position:absolute;right:16px;background-color:#fff;color:var(--primary);border-radius:50px;border:1px solid var(--primary);font-size:14px;list-style:16px;font-weight:700;text-align:center;min-width:130px;height:32px;cursor:pointer}.card[_ngcontent-%COMP%]{background:white;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{color:var(--default-dark)}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:32px}shared-register[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:normal}shared-register[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--default-dark);font-size:14px}shared-register[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:100%;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-register[_ngcontent-%COMP%]   a.login[_ngcontent-%COMP%]{text-decoration:underline}shared-login[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:normal;margin:0 0 15px;color:var(--default-dark);text-align:left}shared-login[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:10px;width:-moz-fit-content;width:fit-content;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-merchant[_ngcontent-%COMP%]   .merchant[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{font-weight:bold}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]{padding-bottom:10px}shared-merchant[_ngcontent-%COMP%]   .coupons[_ngcontent-%COMP%]   .coupon-count[_ngcontent-%COMP%]{font-size:14px}shared-merchant[_ngcontent-%COMP%]   .no-coupons[_ngcontent-%COMP%]{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;background:var(--primary-light);flex-grow:1}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:110px;height:110px;border:1px solid var(--primary-light);border-radius:8px;margin-right:16px;text-transform:uppercase;flex-shrink:0}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{flex-basis:100%}shared-coupon[_ngcontent-%COMP%]   .coupon[_ngcontent-%COMP%]   .callout[_ngcontent-%COMP%]   .tagline[_ngcontent-%COMP%]{background-color:var(--primary-light);color:#fff;font-size:12px;font-weight:600;line-height:24px;text-align:center;border-radius:0 0 8px 8px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:16px;line-height:24px;font-weight:bold;align-items:center;justify-content:center;display:flex;box-shadow:0 3.36667px 10.1px #8883}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:var(--tertiary-light);border:1px solid var(--tertiary);border-radius:20px;font-weight:bold;height:40px;width:100%;position:relative}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;background:var(--primary-light);border:1px solid var(--primary-light);border-radius:50px;color:var(--primary);height:40px;width:calc(100% - 30px)}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .peel[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:-4px}shared-coupon[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .expiration[_ngcontent-%COMP%]{color:var(--text-inactivated);font-size:10px;font-weight:600}shared-answer[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{background:var(--error)}shared-answer[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:white;border-radius:4px;color:var(--primary);border:solid 1px var(--primary)}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .reward[_ngcontent-%COMP%]{background:var(--secondary-light);color:var(--secondary);width:130px;padding-top:15px;padding-bottom:15px;font-size:24px;font-weight:bold;text-align:center}shared-answer[_ngcontent-%COMP%]   .survey[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}shared-featured-stores[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .alert-title[_ngcontent-%COMP%]{color:var(--primary)}shared-promo-codes[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{border:dashed 1px var(--primary);background:var(--primary-light);color:var(--primary-dark)}shared-promo-codes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-bottom:15px}shared-promo-codes[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--secondary)}shared-alert[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--secondary)}.switch[_ngcontent-%COMP%]{height:20px;width:40px;position:relative;display:flex;align-items:center;cursor:pointer}.switch[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{background-color:var(--light-gray);width:40px;height:12px;border-radius:8px;transition:background-color .25s}.switch[_ngcontent-%COMP%]   .indicator[_ngcontent-%COMP%]{position:absolute;top:0;left:0;background:white;width:20px;height:20px;border-radius:10px;box-shadow:0 1px 2px #0000003d;transition:left .25s}.switch.on[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{background-color:var(--secondary)}.switch.on[_ngcontent-%COMP%]   .indicator[_ngcontent-%COMP%]{left:calc(100% - 20px)}"]}),t})();const ri=["bottom"];function si(t,e){1&t&&o._UZ(0,"div",15)}function ai(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",16),o._UZ(1,"span",17),o.TgZ(2,"shared-switch",18),o.NdJ("change",function(){o.CHM(t);const e=o.oxw();return e.onPrefChanged(e.MemberPreference.surveyAlertOptOut)}),o.qZA(),o.TgZ(3,"a",19),o._UZ(4,"shared-svg",20),o.qZA(),o.qZA()}if(2&t){const t=o.oxw(),e=o.MAs(18);o.xp6(2),o.Q6J("on",t.surveyAlerts),o.xp6(1),o.Q6J("popover",e)}}const ci=function(t){return{selected:t}};function li(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",25),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(2).setDefaultView(e.flag)}),o._uU(1),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw(2);o.Q6J("ngClass",o.VKq(2,ci,n.defaultView===t.flag)),o.xp6(1),o.Oqu(t.text)}}function di(t,e){if(1&t&&(o.TgZ(0,"div",21),o._UZ(1,"span",22),o.TgZ(2,"div",23),o.YNc(3,li,2,4,"div",24),o.qZA(),o.qZA()),2&t){const t=o.oxw();o.xp6(3),o.Q6J("ngForOf",t.views)}}function hi(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",16),o._UZ(1,"span",26),o.TgZ(2,"shared-switch",18),o.NdJ("change",function(){o.CHM(t);const e=o.oxw();return e.onPrefChanged(e.MemberPreference.dataCollectionOptOut)}),o.qZA(),o.TgZ(3,"a",19),o._UZ(4,"shared-svg",20),o.qZA(),o.qZA()}if(2&t){const t=o.oxw(),e=o.MAs(20);o.xp6(2),o.Q6J("on",t.allowDataCollection),o.xp6(1),o.Q6J("popover",e)}}function ui(t,e){if(1&t){const t=o.EpF();o.ynx(0),o.TgZ(1,"div",16),o.TgZ(2,"a",27),o.NdJ("click",function(){return o.CHM(t),o.oxw().collectionNotice()}),o.qZA(),o.qZA(),o.TgZ(3,"div",16),o.TgZ(4,"a",28),o.NdJ("click",function(){return o.CHM(t),o.oxw().financialNotice()}),o.qZA(),o.qZA(),o.TgZ(5,"div",16),o.TgZ(6,"a",29),o.NdJ("click",function(){return o.CHM(t),o.oxw().accessibility()}),o.qZA(),o.qZA(),o.TgZ(7,"div",16),o.TgZ(8,"a",30),o.NdJ("click",function(){return o.CHM(t),o.oxw().doNotSell()}),o.qZA(),o.qZA(),o.BQk()}}function gi(t,e){1&t&&o._UZ(0,"div",31)}function pi(t,e){1&t&&o._UZ(0,"div",32)}let mi=(()=>{class t{constructor(t,e,n){this.tabs=t,this.popup=e,this.browser=n,this.MemberPreference=j,this.ccpaCountryCodes=[Ot.US,Ot.CA],this.views=[],this.defaultView=M.SHOP,this.shouldShowDataCollection=!1}ngOnInit(){return(0,h.mG)(this,void 0,void 0,function*(){this.popup.onInitialized.subscribe(()=>{this.onInitialized()}),yield this.popup.init(),document.title=this.browser.getLocalizedMessage("popup_settings_title"),this.brand=window.__brandCode,this.settingTextHide=this.browser.getSanitizedLocalizedMessage("popup_settings_hide"),this.settingTextByUsing=this.browser.getSanitizedLocalizedMessage("popup_settings_by_using"),this.views=[{flag:M.SHOP,text:this.browser.getLocalizedMessage("popup_nav_shop")},{flag:M.ANSWER,text:this.browser.getLocalizedMessage("popup_nav_answer")}],this.defaultView=yield this.popup.getDefaultView(),this.bottom.nativeElement.querySelector(".terms").onclick=()=>{this.popup.openTerms()},this.bottom.nativeElement.querySelector(".privacy").onclick=()=>{this.popup.openPrivacy()}})}getPref(t){return(this.prefs&t)==t}onInitialized(){const t=this.popup.data;let e=t=>this.popup.isFlagEnabled(t);this.prefs=t.member.preferences,this.isAnswer=e(M.ANSWER),this.surveyAlerts=!this.getPref(j.surveyAlertOptOut),this.shouldShowCCPA=this.ccpaCountryCodes.includes(t.member.location),this.allowDataCollection=!this.getPref(j.dataCollectionOptOut),this.shouldShowDefaultView=e(M.ANSWER)&&e(M.SHOP),this.shouldShowDataCollection=e(M.DATA_INSIGHTS)}close(){return(0,h.mG)(this,void 0,void 0,function*(){yield this.popup.sendBackgroundMessage(m.CloseSettings)})}onPrefChanged(t){return(0,h.mG)(this,void 0,void 0,function*(){yield this.popup.sendBackgroundMessage(m.UpdateMemberPrefs,t),this.prefs^=t})}setDefaultView(t){return(0,h.mG)(this,void 0,void 0,function*(){this.defaultView=t,yield this.popup.sendBackgroundMessage(m.SetStorageItem,{key:this.popup.DEFAULT_POPUP_VIEW_KEY,value:t})})}collectionNotice(){this.tabs.openProdegeTab("collection-notice")}financialNotice(){this.tabs.openProdegeTab("financial-incentives-notice")}accessibility(){this.tabs.openProdegeTab("accessibility-statement")}doNotSell(){this.tabs.openProdegeTab("do-not-sell")}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(oe),o.Y36(Ce),o.Y36(Ht))},t.\u0275cmp=o.Xpm({type:t,selectors:[["shared-settings"]],viewQuery:function(t,e){if(1&t&&o.Gf(ri,5),2&t){let t;o.iGM(t=o.CRH())&&(e.bottom=t.first)}},decls:22,vars:9,consts:[[1,"head"],["src","assets/redesign/images/logo-large.png"],[1,"close",3,"click"],["l10n","close"],["src","assets/redesign/icons/x.svg"],[1,"options"],["class","title","l10n","popup_settings",4,"ngIf"],["class","option",4,"ngIf"],["class","option bottom",4,"ngIf"],["l10n","popup_privacy",1,"title"],[4,"ngIf"],[1,"bottom",3,"innerHTML"],["bottom",""],["surveyAlertsInfo",""],["dataCollectionInfo",""],["l10n","popup_settings",1,"title"],[1,"option"],["l10n","popup_settings_survey_alerts"],[3,"on","change"],[3,"popover"],["src","assets/redesign/icons/info.svg"],[1,"option","bottom"],["l10n","popup_settings_default_view"],[1,"pill-select"],["class","pill",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"pill",3,"ngClass","click"],["l10n","popup_settings_allow_data_collection"],["l10n","popup_settings_collection_notice",3,"click"],["l10n","popup_settings_financial_notice",3,"click"],["l10n","popup_settings_accessibility",3,"click"],["l10n","popup_settings_do_not_sell",3,"click"],["l10n","popup_settings_survey_alerts_info",1,"info"],["l10n","popup_settings_allow_data_collection_info",1,"info"]],template:function(t,e){1&t&&(o.TgZ(0,"div"),o.TgZ(1,"div",0),o._UZ(2,"img",1),o.TgZ(3,"div",2),o.NdJ("click",function(){return e.close()}),o._UZ(4,"span",3),o._UZ(5,"shared-svg",4),o.qZA(),o.qZA(),o.TgZ(6,"div",5),o.YNc(7,si,1,0,"div",6),o.TgZ(8,"section"),o.YNc(9,ai,5,2,"div",7),o.YNc(10,di,4,1,"div",8),o.qZA(),o._UZ(11,"div",9),o.TgZ(12,"section"),o.YNc(13,hi,5,2,"div",7),o.YNc(14,ui,9,0,"ng-container",10),o.qZA(),o._UZ(15,"section",11,12),o.qZA(),o.qZA(),o.YNc(17,gi,1,0,"ng-template",null,13,o.W1O),o.YNc(19,pi,1,0,"ng-template",null,14,o.W1O),o._UZ(21,"shared-popover")),2&t&&(o.Gre("settings ",e.brand,""),o.xp6(7),o.Q6J("ngIf",e.isAnswer||e.shouldShowDefaultView),o.xp6(2),o.Q6J("ngIf",e.isAnswer),o.xp6(1),o.Q6J("ngIf",e.shouldShowDefaultView),o.xp6(3),o.Q6J("ngIf",e.shouldShowDataCollection),o.xp6(1),o.Q6J("ngIf",e.shouldShowCCPA),o.xp6(1),o.Q6J("innerHTML",e.settingTextByUsing,o.oJD))},directives:[_e,xe,d.O5,kn,oi,mn,d.sg,d.mk],styles:[":root{--gray: #AAAAAA;--light-gray: #DADADA}.popup{width:400px;height:550px;display:flex;flex-direction:column;white-space:pre-line;font-size:12px;font-family:var(--font);background:#F5F5F5}.popup .header{color:#fff;background:var(--bg-gradient)}.popup .header .balance{border-right:solid 1px white}.popup .body{padding:10px;flex-grow:1;overflow:auto;overflow-x:hidden;display:flex}a{color:var(--primary);cursor:pointer}input,button{font-family:var(--font)}button.primary,button.secondary{color:#fff;font-weight:700;font-size:14px;line-height:18px;border-radius:4px;cursor:pointer;border:0}button.primary:focus,button.secondary:focus{border:0;outline:none}button.primary:disabled,button.secondary:disabled{border:0;cursor:not-allowed}button.primary{background:var(--primary);padding:15px}button.primary:disabled{background:var(--primary-light);color:var(--primary)}button.secondary{background:var(--secondary);padding:10px}button.secondary:disabled{background:var(--secondary-light);color:var(--secondary)}button.login{align-self:center;display:block!important;position:absolute;right:16px;background-color:#fff;color:var(--primary);border-radius:50px;border:1px solid var(--primary);font-size:14px;list-style:16px;font-weight:700;text-align:center;min-width:130px;height:32px;cursor:pointer}.card{background:white;border:solid 1px var(--light-gray);border-radius:20px;padding:10px 20px;margin-top:5px;display:flex;color:var(--default-dark)}shared-register .heading{color:var(--default-dark)}shared-register .heading h1{margin:0;font-size:32px}shared-register .heading h2{margin:0;font-size:24px;font-weight:normal}shared-register p{color:var(--default-dark);font-size:14px}shared-register button{margin-bottom:10px;width:100%;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-register a.login{text-decoration:underline}shared-login h1{font-size:20px;font-weight:normal;margin:0 0 15px;color:var(--default-dark);text-align:left}shared-login button{margin-bottom:10px;width:-moz-fit-content;width:fit-content;padding-left:40px;padding-right:40px;margin-left:auto;margin-right:auto;display:block}shared-merchant .merchant .info .reward{font-weight:bold}shared-merchant .coupons{padding-bottom:10px}shared-merchant .coupons .coupon-count{font-size:14px}shared-merchant .no-coupons{padding:40px 0;display:flex;flex-direction:column;justify-content:start;align-items:center;background:var(--primary-light);flex-grow:1}shared-coupon .coupon .callout{display:flex;flex-direction:column;width:110px;height:110px;border:1px solid var(--primary-light);border-radius:8px;margin-right:16px;text-transform:uppercase;flex-shrink:0}shared-coupon .coupon .callout .discount .value,shared-coupon .coupon .callout .discount .label{flex-basis:100%}shared-coupon .coupon .callout .tagline{background-color:var(--primary-light);color:#fff;font-size:12px;font-weight:600;line-height:24px;text-align:center;border-radius:0 0 8px 8px}shared-coupon .info .button .text,shared-coupon .info .button .peel div{font-size:16px;line-height:24px;font-weight:bold;align-items:center;justify-content:center;display:flex;box-shadow:0 3.36667px 10.1px #8883}shared-coupon .info .button .text{background:var(--tertiary-light);border:1px solid var(--tertiary);border-radius:20px;font-weight:bold;height:40px;width:100%;position:relative}shared-coupon .info .button .peel div{display:flex;background:var(--primary-light);border:1px solid var(--primary-light);border-radius:50px;color:var(--primary);height:40px;width:calc(100% - 30px)}shared-coupon .info .button .peel img{margin-left:-4px}shared-coupon .info .expiration{color:var(--text-inactivated);font-size:10px;font-weight:600}shared-answer .title a{color:var(--primary)}shared-answer .alert .status div{background:var(--error)}shared-answer .alert .link a{background:white;border-radius:4px;color:var(--primary);border:solid 1px var(--primary)}shared-answer .survey .reward{background:var(--secondary-light);color:var(--secondary);width:130px;padding-top:15px;padding-bottom:15px;font-size:24px;font-weight:bold;text-align:center}shared-answer .survey .info b{color:var(--secondary)}shared-featured-stores .title a{color:var(--primary)}shared-promo-codes .card .alert-title{color:var(--primary)}shared-promo-codes .card a{border:dashed 1px var(--primary);background:var(--primary-light);color:var(--primary-dark)}shared-promo-codes form input{margin-bottom:15px}shared-promo-codes .info a{color:var(--secondary)}shared-alert b{color:var(--secondary)}a{color:var(--primary);text-decoration:underline;cursor:pointer}.settings{font-family:var(--font);font-size:14px;height:100vh;background:#F1F1F1;color:var(--default)}.settings .head{padding:15px;background:white;border-bottom:solid 1px var(--light-gray);text-align:center;position:relative}.settings .head .close{float:right;padding:15px;display:flex;position:absolute;height:calc(100% - 30px);right:0;top:0;margin-right:35px;cursor:pointer}.settings .head .close span{display:flex;align-items:center;font-weight:bold;color:var(--gray)}.settings .head .close shared-svg{margin-left:15px;fill:var(--gray);display:flex;align-items:center}.settings .options{margin-top:20px;margin-left:auto;margin-right:auto;background:white;border:solid 1px var(--gray);box-shadow:3px 4px 4px #0000000d;width:450px;padding-bottom:30px}.settings .options .title{border-bottom:solid 1px var(--gray);padding:30px 30px 10px;font-weight:bold;margin-bottom:20px}.settings .options section{padding-left:30px;padding-right:30px}.settings .options section .option{display:flex}.settings .options section .option:not(:last-child){margin-bottom:10px}.settings .options section .option span{flex-grow:1;display:flex;align-items:center}.settings .options section .option span.setting-hide a{margin-left:5px}.settings .options section .option shared-switch{margin-right:30px}.settings .options section .option shared-svg{fill:var(--gray)}.settings .options section .option .pill-select{display:inline;padding:3px;border-radius:35px;background:#F1F1F1;display:flex}.settings .options section .option .pill-select .pill{padding:5px 20px;background:#fafafa;border-radius:35px;font-size:12px;font-weight:700;cursor:pointer}.settings .options section .option .pill-select .pill.selected{background:var(--primary);color:#fff}.settings .options section .option .pill-select .pill:not(:last-child){margin-right:3px}.settings .options .bottom{margin-top:20px}.info{padding:20px;width:150px}\n"],encapsulation:2}),t})(),fi=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[d.ez,r.u5]]}),t})();var vi=n(6304);let bi=(()=>{class t{constructor(t,e){this.tabs=t,this.popup=e,this.ACCOUNT_POPOVER_MENU=(new Map).set(Mt.Profile,"popup_account_popover_my_account").set(Mt.RewardsStore,"popup_account_popover_redeem").set(Mt.AccountSummary,"popup_account_popover_my_activity").set(Mt.Referrals,"popup_account_popover_refer_a_friend").set(Mt.Tutorial,"popup_account_popover_how_does_it_work")}ngOnInit(){this.popup.onOpenSiteTab.subscribe(t=>{this.openSiteTab(t.location,t.args)}),this.popup.onOpenHowItWorks.subscribe(()=>(0,h.mG)(this,void 0,void 0,function*(){yield this.popup.sendBackgroundMessage(m.ShowTutorial)})),this.popup.setAccountPopoverMenu(this.ACCOUNT_POPOVER_MENU)}openSiteTab(t,e){let n=null,i=!0;switch(t){case Mt.WebSearch:n=`?t=w&p=1&f=${e[0]}&q=${e[1]}`;break;case Mt.ShopSearch:n=`shop/search?shq=${e[0]}`;break;case Mt.Stores:n="shop/allstores/?view=list&amp;utm_source=SwagButton&amp;utm_medium=directlink&amp;utm_campaign=view_all_stores";break;case Mt.Ledger:case Mt.AccountSummary:n="account/summary?visited=true";break;case Mt.RewardsStore:n="rewards-store";break;case Mt.Referrals:n="account/referrals";break;case Mt.ForgotPassword:n="p/login";break;case Mt.Tutorial:this.popup.openHowItWorks(),i=!1;break;case Mt.Answer:n="surveys";break;case Mt.Profile:n="profile";break;case Mt.PromoCodeInfo:n="g/l/x3hxsp"}this.tabs.openSiteTab(n)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(oe),o.Y36(Ce))},t.\u0275cmp=o.Xpm({type:t,selectors:[["brand-popup"]],decls:1,vars:0,consts:[[1,"sb"]],template:function(t,e){1&t&&o._UZ(0,"popup-base",0)},directives:[ni],styles:[""],encapsulation:2}),t})(),_i=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[fi,d.ez,r.u5]]}),t})(),Ci=(()=>{class t{constructor(){}preInit(){return(0,h.mG)(this,void 0,void 0,function*(){})}postInit(){return(0,h.mG)(this,void 0,void 0,function*(){})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),yi=(()=>{class t{constructor(t,e,n,i,o,r,s,a,c,l,d,h,u,g,p,m,f,v,b,_){this.browserEvents=t,this.tabSvc=e,this.browser=n,this.alarmSvc=i,this.configSvc=o,this.memberSvc=r,this.storageSvc=s,this.merchantSvc=a,this.messagingSvc=c,this.lifecycleEventsSvc=l,this.contentInjectionSvc=d,this.affiliateNetworkSvc=h,this.surveyLogSvc=u,this.peerLogging=g,this.notifications=p,this.browserAction=m,this.siteMapSvc=f,this.cookies=v,this.brand=b,this.dataInsightsSvc=_}ngOnInit(){var t=this;return(0,vi.Z)(function*(){let e="UNKNOWN_BRAND_AND_VERSION";t.browser&&t.browser.api?e=t.browser.api.runtime.getManifest().version:chrome&&chrome.runtime&&(e=chrome.runtime.getManifest().version),kt.t.install({token:"a77f9aa3cfae4bc59cd1f05c818671ab",application:window.__trackJsApplication,version:t.configSvc.brand+e}),yield t.brand.preInit(),t.browserEvents.init(),t.storageSvc.init(),t.contentInjectionSvc.init(),t.notifications.init(),t.cookies.init(),t.messagingSvc.init(),t.merchantSvc.init(),t.affiliateNetworkSvc.init(),t.memberSvc.init(),t.tabSvc.init(),t.cookies.init(),t.surveyLogSvc.init(),t.siteMapSvc.init(),t.dataInsightsSvc.init(),t.configSvc.init(),t.alarmSvc.init(),t.lifecycleEventsSvc.init(),t.peerLogging.init(),yield t.brand.postInit(),t.tabSvc.tabNavComplete.subscribe(function(){var e=(0,vi.Z)(function*(e){(yield t.tabSvc.checkTabExists(e.tabId))&&t.browserAction.setIconWithActivationState(t.configSvc.client,e.tabId,e&&e.merchantState?e.merchantState.activationState:null,e.shouldAnimateIcon)});return function(t){return e.apply(this,arguments)}}());const n=yield t.storageSvc.extId.get(),i=yield t.storageSvc.member.get();kt.t.configure({sessionId:null==n?"NO_EXT_ID":String(n),userId:null==i?"NO_MEMBER_ID":String(i.id)});const o=yield t.storageSvc.flags.get();t.configSvc.configure(o)})()}ngOnDestroy(){var t=this;return(0,vi.Z)(function*(){let e=t.tabSvc.getAllTabStates();for(let n=0;n<e.length;n++){let i=e[n];if(i.merchantState){let e=i.merchantState.session;e&&(yield t.tabSvc.postMerchantSessionLog(e))}}})()}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Jt),o.Y36(oe),o.Y36(Ht),o.Y36(Yt),o.Y36(Dt),o.Y36(ne),o.Y36($t),o.Y36(ee),o.Y36(ge),o.Y36(Kt),o.Y36(se),o.Y36(Xt),o.Y36(pe),o.Y36(be),o.Y36(ae),o.Y36(me),o.Y36(le),o.Y36(Vt),o.Y36(Ci),o.Y36(ue))},t.\u0275cmp=o.Xpm({type:t,selectors:[["background"]],decls:0,vars:0,template:function(t,e){},styles:[""]}),t})(),xi=(()=>{class t{constructor(t){this.messaging=t}ngOnInit(){let t=new P(m.ExecuteCallback);this.messaging.sendBackgroundMessage(t)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(ge))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-popup"]],decls:1,vars:0,template:function(t,e){1&t&&o._UZ(0,"brand-popup")},directives:[bi],styles:["div[_ngcontent-%COMP%]{padding:10px}.error[_ngcontent-%COMP%]{color:darkred}"]}),t})(),Mi=(()=>{class t{constructor(t){this.messagingSvc=t,this.className="",this.memberName="",this.member2Name="",this.paramsArray="",this.cmd="",this.allMembers=[],this.options={},this.results={},this.logs={},this.error={}}ngOnInit(){var t=this;return(0,vi.Z)(function*(){let e=new P(m.GetAllReflects);t.allMembers=yield t.messagingSvc.sendBackgroundMessage(e),t.paramsArray="[]"})()}onClickSubmit(){var t=this;return(0,vi.Z)(function*(){try{const e=new P(m.ExecuteReflect,{class:t.className,member:t.memberName,member2:t.member2Name,params:t.paramsArray?JSON.parse(t.paramsArray):""}),n=yield t.messagingSvc.sendBackgroundMessage(e);"string"==typeof n.results&&0===n.results.indexOf("Call Failed!")?t.error=n.results:(t.results=n.results,t.error={}),t.logs=n.logs}catch(e){t.error=e.stack}})()}onClickCmdSubmit(t){var e=this;return(0,vi.Z)(function*(){try{const n=new P(m.ExecuteReflectCmd,{cmd:e.truncateCmd(t.cmd)}),i=yield e.messagingSvc.sendBackgroundMessage(n);"string"==typeof i.results&&0===i.results.indexOf("Call Failed!")?e.error=i.results:(e.results=i.results,e.error={}),e.logs=i.logs}catch(n){e.error=n.stack}})()}truncateCmd(t){try{let e=t.replace(/\n/gu,"");return e.substring(e.lastIndexOf(";")+1)}catch(e){return null}}onEvent(t){if(t.node&&!t.node.isRoot&&t.node.parent&&t.node.parent.data){const e=t.node.data.name.includes(": f()");this.className=t.node.parent.data.name;const n=t.node.data.name;this.memberName=e?n.substring(0,n.indexOf(": f()")):n,this.paramsArray=e?"[]":"",this.cmd+=`;\n${this.className}.${this.memberName}${e?"()":""}`}}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(ge))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-reflect"]],viewQuery:function(t,e){if(1&t&&o.Gf(a.qr,5),2&t){let t;o.iGM(t=o.CRH())&&(e.tree=t.first)}},decls:52,vars:18,consts:[["id","reflect"],["id","reflect-all-members"],["id","reflect-all-members-list","hidden",""],[3,"nodes","activate"],["id","reflect-main"],["id","reflect-form-container"],["id","reflect-form",3,"ngSubmit"],["typeCallingInfo","ngForm"],["id","class-name-input","type","text","name","class","placeholder","class","autofocus","",3,"ngModel","ngModelChange"],["id","member-name-input","type","text","name","member","placeholder","member",3,"ngModel","ngModelChange"],["id","member2-name-input","type","text","name","member2","placeholder","member2",3,"ngModel","ngModelChange"],["id","params-array-input","name","params","placeholder","params",3,"ngModel","ngModelChange"],["id","form-submit","type","submit","value","submit"],["id","reflect-cmd-form",3,"ngSubmit"],["id","cmd-input","type","text","name","cmd","placeholder","cmd","autofocus","",3,"ngModel","ngModelChange"],["id","cmd-form-submit","type","submit","value","submit"],["id","reflect-info"],["id","reflect-return"],["id","return-results"],["id","reflect-logs"],["id","log-results"],["id","reflect-error"],["id","error-results"]],template:function(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"p",2),o._uU(3),o.ALo(4,"json"),o.qZA(),o.TgZ(5,"h1"),o._uU(6,"All members available:"),o.qZA(),o.TgZ(7,"tree-root",3),o.NdJ("activate",function(t){return e.onEvent(t)}),o.qZA(),o.qZA(),o.TgZ(8,"div",4),o.TgZ(9,"div",5),o.TgZ(10,"form",6,7),o.NdJ("ngSubmit",function(){return e.onClickSubmit()}),o._uU(12," Class Name: "),o.TgZ(13,"input",8),o.NdJ("ngModelChange",function(t){return e.className=t}),o.qZA(),o._UZ(14,"br"),o._uU(15," Member Name: "),o.TgZ(16,"input",9),o.NdJ("ngModelChange",function(t){return e.memberName=t}),o.qZA(),o._UZ(17,"br"),o._uU(18," Member2 Name: "),o.TgZ(19,"input",10),o.NdJ("ngModelChange",function(t){return e.member2Name=t}),o.qZA(),o._UZ(20,"br"),o._uU(21," Parameters (array): "),o.TgZ(22,"textarea",11),o.NdJ("ngModelChange",function(t){return e.paramsArray=t}),o.qZA(),o._UZ(23,"br"),o._UZ(24,"br"),o._UZ(25,"input",12),o.qZA(),o.TgZ(26,"form",13,7),o.NdJ("ngSubmit",function(){o.CHM(t);const n=o.MAs(11);return e.onClickCmdSubmit(n.value)}),o._uU(28," Command: "),o.TgZ(29,"textarea",14),o.NdJ("ngModelChange",function(t){return e.cmd=t}),o.qZA(),o._UZ(30,"br"),o._UZ(31,"br"),o._UZ(32,"input",15),o.qZA(),o.qZA(),o.TgZ(33,"div",16),o.TgZ(34,"div",17),o.TgZ(35,"h1"),o._uU(36,"return:"),o.qZA(),o.TgZ(37,"pre",18),o._uU(38),o.ALo(39,"json"),o.qZA(),o.qZA(),o.TgZ(40,"div",19),o.TgZ(41,"h1"),o._uU(42,"logs:"),o.qZA(),o.TgZ(43,"pre",20),o._uU(44),o.ALo(45,"json"),o.qZA(),o.qZA(),o.TgZ(46,"div",21),o.TgZ(47,"h1"),o._uU(48,"error:"),o.qZA(),o.TgZ(49,"pre",22),o._uU(50),o.ALo(51,"json"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()}2&t&&(o.xp6(3),o.Oqu(o.lcZ(4,10,e.allMembers)),o.xp6(4),o.Q6J("nodes",e.allMembers),o.xp6(6),o.Q6J("ngModel",e.className),o.xp6(3),o.Q6J("ngModel",e.memberName),o.xp6(3),o.Q6J("ngModel",e.member2Name),o.xp6(3),o.Q6J("ngModel",e.paramsArray),o.xp6(7),o.Q6J("ngModel",e.cmd),o.xp6(9),o.Oqu(o.lcZ(39,12,e.results)),o.xp6(6),o.Oqu(o.lcZ(45,14,e.logs)),o.xp6(6),o.Oqu(o.lcZ(51,16,e.error)))},directives:[a.qr,r._Y,r.JL,r.F,r.Fj,r.JJ,r.On],pipes:[d.Ts],styles:["pre[_ngcontent-%COMP%]{font-size:12px;overflow-x:scroll}div[_ngcontent-%COMP%]{resize:both;overflow:auto;border:1px solid;padding:.7%;margin:.7%}#reflect[_ngcontent-%COMP%]{min-width:1000px;display:flex;flex-direction:row}#reflect-all-members[_ngcontent-%COMP%]{width:17%;height:88vh}#reflect-main[_ngcontent-%COMP%]{width:83%}#reflect-form-container[_ngcontent-%COMP%]{display:flex}#reflect-form[_ngcontent-%COMP%]{margin-right:25px;padding-right:25px;border-right:2px solid}#reflect-info[_ngcontent-%COMP%]{display:flex;flex-direction:row}#reflect-error[_ngcontent-%COMP%], #reflect-logs[_ngcontent-%COMP%], #reflect-return[_ngcontent-%COMP%]{width:32%}input[_ngcontent-%COMP%]{width:250px}textarea[_ngcontent-%COMP%]{width:350px;height:120px}"]}),t})(),Si=(()=>{class t{constructor(t){this.router=t}canActivate(t,e){const n=t.queryParams.page;return this.router.navigate(n&&"popup"!==n?["/"+n]:["/popup"]),!1}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(c.F0))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Oi=[{path:"background",component:yi},{path:"reflect",component:Mi},{path:"popup",component:xi},{path:"settings",component:mi},{path:"**",component:xi,canActivate:[Si]}];let Pi=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[c.Bz.forRoot(Oi,{relativeLinkResolution:"legacy"})],c.Bz]}),t})(),wi=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t,bootstrap:[l]}),t.\u0275inj=o.cJS({providers:[zt,Ft,Si],imports:[[i.b2,r.u5,Pi,s.JF,_i,p,Nt,a.xc.forRoot()]]}),t})();(0,o.G48)(),i.q6().bootstrapModule(wi).catch(t=>console.log(t))}},t=>{"use strict";t.O(0,["vendor"],()=>t(t.s=36)),t.O()}]);